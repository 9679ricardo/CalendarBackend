∑x
ZE:\visual\ricardo\Backend-C#\CalendarBackend\CalendarBackend\Controllers\AuthController.cs
	namespace 	
CalendarBackend
 
. 
Controllers %
{		 
[

 
Route

 

(


 
$str

 
)

 
]

 
[ 
ApiController 
] 
public 

class 
AuthController 
:  !

Controller" ,
{ 
readonly 

INrUsuario 
mUsuario $
;$ %
readonly 
ICreateHash 
mCreateHash (
;( )
readonly 
ITokenCreate 
mTokenCreate *
;* +
readonly 
IValidarUsuario  
	mVUsuario! *
;* +
public 
AuthController 
( 

INrUsuario (
mUsuario) 1
,1 2
ICreateHash3 >
mCreateHash? J
,J K
ITokenCreateL X
mTokenCreateY e
,e f
IValidarUsuariog v
	mVUsuario	w Ä
)
Ä Å
{ 	
this 
. 
mUsuario 
= 
mUsuario $
;$ %
this 
. 
mCreateHash 
= 
mCreateHash *
;* +
this 
. 
mTokenCreate 
= 
mTokenCreate  ,
;, -
this 
. 
	mVUsuario 
= 
	mVUsuario &
;& '
} 	
[ 	
HttpPost	 
( 
$str 
) 
] 
public 
async 
Task 
< 
ActionResult &
<& '
UsuarioRegister' 6
>6 7
>7 8
Register9 A
(A B
UsuarioRegisterB Q
requestR Y
)Y Z
{ 	
try 
{ 
var   
validar   
=   
	mVUsuario   '
.  ' (
ValidarUsuario  ( 6
(  6 7
request  7 >
)  > ?
;  ? @
if!! 
(!! 
!!! 
validar!! 
.!! 
Ok!! 
)!!  
return!!! '

StatusCode!!( 2
(!!2 3
$num!!3 6
,!!6 7
validar!!8 ?
)!!? @
;!!@ A
var## 
	respuesta## 
=## 
await##  %
mUsuario##& .
.##. /
NR_Buscar_CorreoS##/ @
(##@ A
request##A H
.##H I
Email##I N
)##N O
;##O P
if$$ 
($$ 
!$$ 
	respuesta$$ 
.$$ 
Ok$$ !
)$$! "
return$$# )

StatusCode$$* 4
($$4 5
$num$$5 8
,$$8 9
	respuesta$$: C
)$$C D
;$$D E
string&& 
hsp&& 
=&& 
mCreateHash&& (
.&&( )!
CreatePasswordEncrypt&&) >
(&&> ?
request&&? F
.&&F G
Password&&G O
)&&O P
;&&P Q
if'' 
('' 
string'' 
.'' 
IsNullOrEmpty'' (
(''( )
hsp'') ,
)'', -
)''- .
return''/ 5

StatusCode''6 @
(''@ A
$num''A D
,''D E
new''F I
{''J K
ok''L N
=''O P
false''Q V
,''V W
msg''X [
=''\ ]
$str	''^ õ
}
''ú ù
)
''ù û
;
''û ü
request)) 
.)) 
Password))  
=))! "
hsp))# &
;))& '
var** 
uid** 
=** 
await** 
mUsuario**  (
.**( ) 
NR_Registrar_Usuario**) =
(**= >
request**> E
)**E F
;**F G
if++ 
(++ 
uid++ 
<=++ 
$num++ 
)++ 
return++ $

StatusCode++% /
(++/ 0
$num++0 3
,++3 4
new++5 8
{++9 :
ok++; =
=++> ?
false++@ E
,++E F
msg++G J
=++K L
$str	++M ä
}
++ã å
)
++å ç
;
++ç é
var-- 
token-- 
=-- 
mTokenCreate-- (
.--( )
TokenCreate--) 4
(--4 5
uid--5 8
,--8 9
request--: A
.--A B
Name--B F
)--F G
;--G H
if.. 
(.. 
string.. 
... 
IsNullOrEmpty.. (
(..( )
token..) .
)... /
)../ 0
return..1 7

StatusCode..8 B
(..B C
$num..C F
,..F G
new..H K
{..L M
ok..N P
=..Q R
false..S X
,..X Y
msg..Z ]
=..^ _
$str	..` û
}
..ü †
)
..† °
;
..° ¢
return00 

StatusCode00 !
(00! "
$num00" %
,00% &
new00' *
{00+ ,
ok00- /
=000 1
true002 6
,006 7
uid008 ;
,00; <
name00= A
=00B C
request00D K
.00K L
Name00L P
,00P Q
token00R W
,00W X
request00Y `
.00` a
Email00a f
}00g h
)00h i
;00i j
}11 
catch22 
(22 
	Exception22 
)22 
{33 
return44 

StatusCode44 !
(44! "
$num44" %
,44% &
new44' *
{44+ ,
ok44- /
=440 1
false442 7
,447 8
msg449 <
=44= >
$str44? |
}44} ~
)44~ 
;	44 Ä
}55 
}66 	
[88 	
HttpPost88	 
(88 
$str88 
)88 
]88 
public99 
async99 
Task99 
<99 
ActionResult99 &
<99& '
UsuarioLogin99' 3
>993 4
>994 5
Login996 ;
(99; <
UsuarioLogin99< H
request99I P
)99P Q
{:: 	
try;; 
{<< 
var== 
validar== 
=== 
	mVUsuario== '
.==' (
ValidarLogin==( 4
(==4 5
request==5 <
)==< =
;=== >
if>> 
(>> 
!>> 
validar>> 
.>> 
Ok>> 
)>>  
return>>! '

StatusCode>>( 2
(>>2 3
$num>>3 6
,>>6 7
validar>>8 ?
)>>? @
;>>@ A
var@@ 
login@@ 
=@@ 
await@@ !
mUsuario@@" *
.@@* +
NR_Login@@+ 3
(@@3 4
request@@4 ;
.@@; <
Email@@< A
)@@A B
;@@B C
ifAA 
(AA 
loginAA 
==AA 
nullAA !
)AA! "
returnAA# )

StatusCodeAA* 4
(AA4 5
$numAA5 8
,AA8 9
newAA: =
{AA> ?
okAA@ B
=AAC D
falseAAE J
,AAJ K
msgAAL O
=AAP Q
$strAAR l
}AAm n
)AAn o
;AAo p
ifBB 
(BB 
loginBB 
.BB 
PasswordBB "
==BB# %
nullBB& *
)BB* +
returnBB, 2

StatusCodeBB3 =
(BB= >
$numBB> A
,BBA B
newBBC F
{BBG H
okBBI K
=BBL M
falseBBN S
,BBS T
msgBBU X
=BBY Z
$strBB[ u
}BBv w
)BBw x
;BBx y
stringDD 
hspDD 
=DD 
mCreateHashDD (
.DD( )
PasswordDecryptDD) 8
(DD8 9
loginDD9 >
.DD> ?
PasswordDD? G
)DDG H
;DDH I
ifEE 
(EE 
!EE 
hspEE 
.EE 
EqualsEE 
(EE  
requestEE  '
.EE' (
PasswordEE( 0
)EE0 1
)EE1 2
returnEE3 9

StatusCodeEE: D
(EED E
$numEEE H
,EEH I
newEEJ M
{EEN O
okEEP R
=EES T
falseEEU Z
,EEZ [
msgEE\ _
=EE` a
$strEEb |
}EE} ~
)EE~ 
;	EE Ä
varGG 
tokenGG 
=GG 
mTokenCreateGG (
.GG( )
TokenCreateGG) 4
(GG4 5
loginGG5 :
.GG: ;
uidGG; >
,GG> ?
loginGG@ E
.GGE F
NameGGF J
)GGJ K
;GGK L
ifHH 
(HH 
stringHH 
.HH 
IsNullOrEmptyHH (
(HH( )
tokenHH) .
)HH. /
)HH/ 0
returnHH1 7

StatusCodeHH8 B
(HHB C
$numHHC F
,HHF G
newHHH K
{HHL M
okHHN P
=HHQ R
falseHHS X
,HHX Y
msgHHZ ]
=HH^ _
$str	HH` û
}
HHü †
)
HH† °
;
HH° ¢
returnJJ 

StatusCodeJJ !
(JJ! "
$numJJ" %
,JJ% &
newJJ' *
{JJ+ ,
okJJ- /
=JJ0 1
trueJJ2 6
,JJ6 7
loginJJ8 =
.JJ= >
uidJJ> A
,JJA B
nameJJC G
=JJH I
loginJJJ O
.JJO P
NameJJP T
,JJT U
tokenJJV [
,JJ[ \
requestJJ] d
.JJd e
EmailJJe j
}JJk l
)JJl m
;JJm n
}KK 
catchLL 
{MM 
returnNN 

StatusCodeNN !
(NN! "
$numNN" %
,NN% &
newNN' *
{NN+ ,
okNN- /
=NN0 1
falseNN2 7
,NN7 8
msgNN9 <
=NN= >
$strNN? |
}NN} ~
)NN~ 
;	NN Ä
}OO 
}QQ 	
[SS 	
	AuthorizeSS	 
]SS 
[TT 	
HttpPostTT	 
(TT 
$strTT 
)TT  
]TT  !
publicUU 
ActionResultUU 
<UU 
stringUU "
>UU" #
RenewUU$ )
(UU) *
stringUU* 0
tokenUU1 6
)UU6 7
{VV 	
tryWW 
{XX 
ifYY 
(YY 
HttpContextYY 
.YY  
UserYY  $
.YY$ %
IdentityYY% -
isYY. 0
notYY1 4
ClaimsIdentityYY5 C
identityYYD L
)YYL M
returnYYN T

StatusCodeYYU _
(YY_ `
$numYY` c
,YYc d
newYYe h
{YYi j
okYYk m
=YYn o
falseYYp u
,YYu v
msgYYw z
=YY{ |
$str	YY} ∫
}
YYª º
)
YYº Ω
;
YYΩ æ
ClaimsIdentZZ 
renewZZ !
=ZZ" #
mTokenCreateZZ$ 0
.ZZ0 1
ValidarTokenZZ1 =
(ZZ= >
tokenZZ> C
,ZZC D
identityZZE M
.ZZM N
ClaimsZZN T
)ZZT U
;ZZU V
if[[ 
([[ 
renew[[ 
==[[ 
null[[ !
)[[! "
return[[# )

StatusCode[[* 4
([[4 5
$num[[5 8
,[[8 9
new[[: =
{[[> ?
ok[[@ B
=[[C D
false[[E J
,[[J K
msg[[L O
=[[P Q
$str[[R c
}[[d e
)[[e f
;[[f g
if\\ 
(\\ 
string\\ 
.\\ 
IsNullOrEmpty\\ (
(\\( )
renew\\) .
.\\. /
Token\\/ 4
)\\4 5
)\\5 6
return\\7 =

StatusCode\\> H
(\\H I
$num\\I L
,\\L M
new\\N Q
{\\R S
ok\\T V
=\\W X
false\\Y ^
,\\^ _
msg\\` c
=\\d e
$str\\f w
}\\x y
)\\y z
;\\z {
return^^ 

StatusCode^^ !
(^^! "
$num^^" %
,^^% &
new^^' *
{^^+ ,
ok^^- /
=^^0 1
true^^2 6
,^^6 7
uid^^8 ;
=^^< =
renew^^> C
.^^C D

Id_Usuario^^D N
,^^N O
name^^P T
=^^U V
renew^^W \
.^^\ ]
Names^^] b
,^^b c
token^^d i
=^^j k
renew^^l q
.^^q r
Token^^r w
}^^x y
)^^y z
;^^z {
}__ 
catch`` 
{aa 
returnbb 

StatusCodebb !
(bb! "
$numbb" %
,bb% &
newbb' *
{bb+ ,
okbb- /
=bb0 1
falsebb2 7
,bb7 8
msgbb9 <
=bb= >
$strbb? P
}bbQ R
)bbR S
;bbS T
}cc 
}dd 	
[ff 	
	Authorizeff	 
]ff 
[gg 	
HttpPostgg	 
(gg 
$strgg 
)gg 
]gg 
publichh 
asynchh 
Taskhh 
<hh 
ActionResulthh &
<hh& '
Eventohh' -
>hh- .
>hh. /
GetAsUsuariohh0 <
(hh< =
stringhh= C
emailhhD I
)hhI J
{ii 	
tryjj 
{kk 
varll 
loginll 
=ll 
awaitll !
mUsuarioll" *
.ll* +
NR_Loginll+ 3
(ll3 4
emailll4 9
)ll9 :
;ll: ;
ifmm 
(mm 
loginmm 
==mm 
nullmm !
)mm! "
returnmm# )

StatusCodemm* 4
(mm4 5
$nummm5 8
,mm8 9
newmm: =
{mm> ?
okmm@ B
=mmC D
falsemmE J
,mmJ K
msgmmL O
=mmP Q
$strmmR x
}mmy z
)mmz {
;mm{ |
ifnn 
(nn 
stringnn 
.nn 
IsNullOrEmptynn (
(nn( )
loginnn) .
.nn. /
Emailnn/ 4
)nn4 5
)nn5 6
returnnn7 =

StatusCodenn> H
(nnH I
$numnnI L
,nnL M
newnnN Q
{nnR S
oknnT V
=nnW X
falsennY ^
,nn^ _
msgnn` c
=nnd e
$str	nnf å
}
nnç é
)
nné è
;
nnè ê
returnpp 

StatusCodepp !
(pp! "
$numpp" %
,pp% &
newpp' *
{pp+ ,
okpp- /
=pp0 1
truepp2 6
,pp6 7
loginpp8 =
.pp= >
Emailpp> C
,ppC D
idppE G
=ppH I
loginppJ O
.ppO P
uidppP S
,ppS T
loginppU Z
.ppZ [
Namepp[ _
}pp` a
)ppa b
;ppb c
}rr 
catchss 
(ss 
	Exceptionss 
)ss 
{tt 
returnuu 

StatusCodeuu !
(uu! "
$numuu" %
,uu% &
newuu' *
{uu+ ,
okuu- /
=uu0 1
falseuu2 7
,uu7 8
msguu9 <
=uu= >
$struu? |
}uu} ~
)uu~ 
;	uu Ä
}vv 
}ww 	
}xx 
}yy ∫Œ
\E:\visual\ricardo\Backend-C#\CalendarBackend\CalendarBackend\Controllers\EventoController.cs
	namespace 	
CalendarBackend
 
. 
Controllers %
{		 
[

 
	Authorize

 
]

 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
EventoController !
:" #

Controller$ .
{ 
private 
readonly 
IValidarEvento '
mVEvento( 0
;0 1
private 
readonly 
	INrEvento "
mEvento# *
;* +
readonly 
ITokenCreate 
mTokenCreate *
;* +
public 
EventoController 
(  
IValidarEvento  .
mVEvento/ 7
,7 8
	INrEvento9 B
mEventoC J
,J K
ITokenCreateL X
mTokenCreateY e
)e f
{ 	
this 
. 
mVEvento 
= 
mVEvento $
;$ %
this 
. 
mEvento 
= 
mEvento "
;" #
this 
. 
mTokenCreate 
= 
mTokenCreate  ,
;, -
} 	
[ 	
HttpGet	 
( 
$str 
) 
] 
public 
async 
Task 
< 
ActionResult &
<& '

EventoPart' 1
>1 2
>2 3 
GetAllEventosUsuario4 H
(H I
)I J
{ 	
try 
{ 
if 
( 
HttpContext 
.  
User  $
.$ %
Identity% -
is. 0
not1 4
ClaimsIdentity5 C
identityD L
)L M
returnN T

StatusCodeU _
(_ `
$num` c
,c d
newe h
{i j
okk m
=n o
falsep u
,u v
msgw z
={ |
$str	} ∫
}
ª º
)
º Ω
;
Ω æ
ClaimsIdent 
user  
=! "
mTokenCreate# /
./ 0
GetUser0 7
(7 8
identity8 @
.@ A
ClaimsA G
)G H
;H I
if   
(   
user   
.   

Id_Usuario   #
<=  $ &
$num  ' (
)  ( )

StatusCode  * 4
(  4 5
$num  5 8
,  8 9
new  : =
{  > ?
ok  @ B
=  C D
false  E J
,  J K
msg  L O
=  P Q
$str	  R è
}
  ê ë
)
  ë í
;
  í ì
var"" 
list"" 
="" 
await""  
mEvento""! (
.""( )+
INR_Mostar_Todos_Evento_Usuario"") H
(""H I
user""I M
.""M N

Id_Usuario""N X
)""X Y
;""Y Z
return$$ 

StatusCode$$ !
($$! "
$num$$" %
,$$% &
new$$' *
{$$+ ,
ok$$- /
=$$0 1
true$$2 6
,$$6 7
eventos$$8 ?
=$$@ A
list$$B F
}$$G H
)$$H I
;$$I J
}%% 
catch&& 
(&& 
	Exception&& 
)&& 
{'' 
return(( 

StatusCode(( !
(((! "
$num((" %
,((% &
new((' *
{((+ ,
ok((- /
=((0 1
false((2 7
,((7 8
msg((9 <
=((= >
$str((? |
}((} ~
)((~ 
;	(( Ä
})) 
}** 	
[,, 	
HttpPost,,	 
(,, 
$str,, 
),, 
],, 
public-- 
async-- 
Task-- 
<-- 
ActionResult-- &
<--& '
EventoRegister--' 5
>--5 6
>--6 7
Create--8 >
(--> ?
[--? @
FromBody--@ H
]--H I
EventoRegister--J X
Request--Y `
)--` a
{.. 	
try// 
{00 
if11 
(11 
HttpContext11 
.11  
User11  $
.11$ %
Identity11% -
is11. 0
not111 4
ClaimsIdentity115 C
identity11D L
)11L M
return11N T

StatusCode11U _
(11_ `
$num11` c
,11c d
new11e h
{11i j
ok11k m
=11n o
false11p u
,11u v
msg11w z
=11{ |
$str	11} ∫
}
11ª º
)
11º Ω
;
11Ω æ
ClaimsIdent22 
user22  
=22! "
mTokenCreate22# /
.22/ 0
GetUser220 7
(227 8
identity228 @
.22@ A
Claims22A G
)22G H
;22H I
if33 
(33 
user33 
.33 

Id_Usuario33 #
<=33$ &
$num33' (
)33( )
return33* 0

StatusCode331 ;
(33; <
$num33< ?
,33? @
new33A D
{33E F
ok33G I
=33J K
false33L Q
,33Q R
msg33S V
=33W X
$str	33Y ñ
}
33ó ò
)
33ò ô
;
33ô ö
var55 
even55 
=55 
mEvento55 "
.55" #
RegisterDataSn55# 1
(551 2
user552 6
,556 7
Request558 ?
)55? @
;55@ A
var77 
validar77 
=77 
mVEvento77 &
.77& '
ValidarEvento77' 4
(774 5
even775 9
)779 :
;77: ;
if88 
(88 
!88 
validar88 
.88 
Ok88 
)88  
return88! '

StatusCode88( 2
(882 3
$num883 6
,886 7
validar888 ?
)88? @
;88@ A
int:: 
lastlast_insert:: #
=::$ %
await::& +
mEvento::, 3
.::3 4 
INR_Registrar_Evento::4 H
(::H I
even::I M
)::M N
;::N O
if;; 
(;; 
lastlast_insert;; #
<=;;$ &
$num;;' (
);;( )
return;;* 0

StatusCode;;1 ;
(;;; <
$num;;< ?
,;;? @
new;;A D
{;;E F
ok;;G I
=;;J K
false;;L Q
,;;Q R
msg;;S V
=;;W X
$str	;;Y ñ
}
;;ó ò
)
;;ò ô
;
;;ô ö
even<< 
.<< 
Id<< 
=<< 
lastlast_insert<< )
;<<) *
int>> 
relac>> 
=>> 
await>> !
mEvento>>" )
.>>) *)
INR_Registrar_Evento_Relacion>>* G
(>>G H
lastlast_insert>>H W
,>>W X
user>>Y ]
.>>] ^

Id_Usuario>>^ h
)>>h i
;>>i j
if?? 
(?? 
relac?? 
<=?? 
$num?? 
)?? 
return??  &

StatusCode??' 1
(??1 2
$num??2 5
,??5 6
new??7 :
{??; <
ok??= ?
=??@ A
false??B G
,??G H
msg??I L
=??M N
$str	??O é
}
??è ê
)
??ê ë
;
??ë í
returnAA 

StatusCodeAA !
(AA! "
$numAA" %
,AA% &
newAA' *
{AA+ ,
okAA- /
=AA0 1
trueAA2 6
,AA6 7
eventoAA8 >
=AA? @
evenAAA E
}AAF G
)AAG H
;AAH I
}BB 
catchCC 
(CC 
	ExceptionCC 
)CC 
{DD 
returnEE 

StatusCodeEE !
(EE! "
$numEE" %
,EE% &
newEE' *
{EE+ ,
okEE- /
=EE0 1
falseEE2 7
,EE7 8
msgEE9 <
=EE= >
$strEE? |
}EE} ~
)EE~ 
;	EE Ä
}FF 
}GG 	
[II 	
HttpPutII	 
(II 
$strII 
)II 
]II 
publicJJ 
asyncJJ 
TaskJJ 
<JJ 
ActionResultJJ &
<JJ& '
EventoUpdateJJ' 3
>JJ3 4
>JJ4 5
UpdateJJ6 <
(JJ< =
[JJ= >
FromBodyJJ> F
]JJF G
EventoUpdateJJH T
RequestJJU \
)JJ\ ]
{KK 	
tryLL 
{MM 
ifNN 
(NN 
HttpContextNN 
.NN  
UserNN  $
.NN$ %
IdentityNN% -
isNN. 0
notNN1 4
ClaimsIdentityNN5 C
identityNND L
)NNL M
returnNNN T

StatusCodeNNU _
(NN_ `
$numNN` c
,NNc d
newNNe h
{NNi j
okNNk m
=NNn o
falseNNp u
,NNu v
msgNNw z
=NN{ |
$str	NN} ∫
}
NNª º
)
NNº Ω
;
NNΩ æ
ClaimsIdentOO 
userOO  
=OO! "
mTokenCreateOO# /
.OO/ 0
GetUserOO0 7
(OO7 8
identityOO8 @
.OO@ A
ClaimsOOA G
)OOG H
;OOH I
ifPP 
(PP 
userPP 
.PP 

Id_UsuarioPP #
<=PP$ &
$numPP' (
)PP( )
returnPP* 0

StatusCodePP1 ;
(PP; <
$numPP< ?
,PP? @
newPPA D
{PPE F
okPPG I
=PPJ K
falsePPL Q
,PPQ R
msgPPS V
=PPW X
$str	PPY ñ
}
PPó ò
)
PPò ô
;
PPô ö
varRR 
envRR 
=RR 
mEventoRR !
.RR! "

UpdateDataRR" ,
(RR, -
userRR- 1
,RR1 2
RequestRR3 :
)RR: ;
;RR; <
varTT 
validarTT 
=TT 
mVEventoTT &
.TT& '
ValidarEventoTT' 4
(TT4 5
envTT5 8
)TT8 9
;TT9 :
ifUU 
(UU 
!UU 
validarUU 
.UU 
OkUU 
)UU  
returnUU! '

StatusCodeUU( 2
(UU2 3
$numUU3 6
,UU6 7
validarUU8 ?
)UU? @
;UU@ A
varVV 
valVV 
=VV 
mVEventoVV "
.VV" #
ValidarEventoIdVV# 2
(VV2 3
RequestVV3 :
.VV: ;
IdVV; =
)VV= >
;VV> ?
ifWW 
(WW 
!WW 
valWW 
.WW 
OkWW 
)WW 
returnWW #

StatusCodeWW$ .
(WW. /
$numWW/ 2
,WW2 3
valWW4 7
)WW7 8
;WW8 9
EventoYY 

DbProductoYY !
=YY" #
awaitYY$ )
mEventoYY* 1
.YY1 2
INR_Buscar_EventoYY2 C
(YYC D
RequestYYD K
.YYK L
IdYYL N
)YYN O
;YYO P
ifZZ 
(ZZ 

DbProductoZZ 
==ZZ !
nullZZ" &
)ZZ& '
returnZZ( .

StatusCodeZZ/ 9
(ZZ9 :
$numZZ: =
,ZZ= >
newZZ? B
{ZZC D
okZZE G
=ZZH I
falseZZJ O
,ZZO P
RequestZZQ X
.ZZX Y
IdZZY [
,ZZ[ \
msgZZ] `
=ZZa b
$str	ZZc Ç
}
ZZÉ Ñ
)
ZZÑ Ö
;
ZZÖ Ü
if[[ 
([[ 

DbProducto[[ 
.[[ 
Id[[ !
<=[[" $
$num[[% &
)[[& '
return[[( .

StatusCode[[/ 9
([[9 :
$num[[: =
,[[= >
new[[? B
{[[C D
ok[[E G
=[[H I
false[[J O
,[[O P
Request[[Q X
.[[X Y
Id[[Y [
,[[[ \
msg[[] `
=[[a b
$str	[[c Ç
}
[[É Ñ
)
[[Ñ Ö
;
[[Ö Ü
if]] 
(]] 

DbProducto]] 
.]] 
UserUid]] &
!=]]' )
user]]* .
.]]. /

Id_Usuario]]/ 9
)]]9 :
return]]; A

StatusCode]]B L
(]]L M
$num]]M P
,]]P Q
new]]R U
{]]V W
ok]]X Z
=]][ \
false]]] b
,]]b c
Request]]d k
.]]k l
Id]]l n
,]]n o
msg]]p s
=]]t u
$str	]]v °
}
]]¢ £
)
]]£ §
;
]]§ •
if^^ 
(^^ 

DbProducto^^ 
.^^ 
IdCre^^ #
!=^^$ &
user^^' +
.^^+ ,

Id_Usuario^^, 6
)^^6 7
return^^8 >

StatusCode^^? I
(^^I J
$num^^J M
,^^M N
new^^O R
{^^S T
ok^^U W
=^^X Y
false^^Z _
,^^_ `
Request^^a h
.^^h i
Id^^i k
,^^k l
msg^^m p
=^^q r
$str	^^s û
}
^^ü †
)
^^† °
;
^^° ¢
env`` 
.`` 
UserUid`` 
=`` 
user`` "
.``" #

Id_Usuario``# -
;``- .
envaa 
.aa 
Useraa 
=aa 
useraa 
.aa  
Namesaa  %
;aa% &
varcc 
upcc 
=cc 
awaitcc 
mEventocc &
.cc& '
INR_Editar_Eventocc' 8
(cc8 9
envcc9 <
)cc< =
;cc= >
ifdd 
(dd 
!dd 
updd 
.dd 
Okdd 
)dd 
returndd "

StatusCodedd# -
(dd- .
$numdd. 1
,dd1 2
updd3 5
)dd5 6
;dd6 7
returnff 

StatusCodeff !
(ff! "
$numff" %
,ff% &
newff' *
{ff+ ,
okff- /
=ff0 1
trueff2 6
,ff6 7
eventoff8 >
=ff? @
envffA D
}ffE F
)ffF G
;ffG H
}gg 
catchhh 
(hh 
	Exceptionhh 
)hh 
{ii 
returnjj 

StatusCodejj !
(jj! "
$numjj" %
,jj% &
newjj' *
{jj+ ,
okjj- /
=jj0 1
falsejj2 7
,jj7 8
msgjj9 <
=jj= >
$strjj? |
}jj} ~
)jj~ 
;	jj Ä
}kk 
}ll 	
[nn 	

HttpDeletenn	 
(nn 
$strnn 
)nn 
]nn 
publicoo 
asyncoo 
Taskoo 
<oo 
ActionResultoo &
<oo& '
Eventooo' -
>oo- .
>oo. /
Deleteoo0 6
(oo6 7
intoo7 :
Idoo; =
)oo= >
{pp 	
tryqq 
{rr 
ifss 
(ss 
HttpContextss 
.ss  
Userss  $
.ss$ %
Identityss% -
isss. 0
notss1 4
ClaimsIdentityss5 C
identityssD L
)ssL M
returnssN T

StatusCodessU _
(ss_ `
$numss` c
,ssc d
newsse h
{ssi j
okssk m
=ssn o
falsessp u
,ssu v
msgssw z
=ss{ |
$str	ss} ∫
}
ssª º
)
ssº Ω
;
ssΩ æ
ClaimsIdenttt 
usertt  
=tt! "
mTokenCreatett# /
.tt/ 0
GetUsertt0 7
(tt7 8
identitytt8 @
.tt@ A
ClaimsttA G
)ttG H
;ttH I
ifuu 
(uu 
useruu 
.uu 

Id_Usuariouu #
<=uu$ &
$numuu' (
)uu( )
returnuu* 0

StatusCodeuu1 ;
(uu; <
$numuu< ?
,uu? @
newuuA D
{uuE F
okuuG I
=uuJ K
falseuuL Q
,uuQ R
msguuS V
=uuW X
$str	uuY ñ
}
uuó ò
)
uuò ô
;
uuô ö
varww 
valww 
=ww 
mVEventoww "
.ww" #
ValidarEventoIdww# 2
(ww2 3
Idww3 5
)ww5 6
;ww6 7
ifxx 
(xx 
!xx 
valxx 
.xx 
Okxx 
)xx 
returnxx #

StatusCodexx$ .
(xx. /
$numxx/ 2
,xx2 3
valxx4 7
)xx7 8
;xx8 9
Eventozz 

DbProductozz !
=zz" #
awaitzz$ )
mEventozz* 1
.zz1 2
INR_Buscar_Eventozz2 C
(zzC D
IdzzD F
)zzF G
;zzG H
if{{ 
({{ 

DbProducto{{ 
=={{ !
null{{" &
){{& '
return{{( .

StatusCode{{/ 9
({{9 :
$num{{: =
,{{= >
new{{? B
{{{C D
ok{{E G
={{H I
false{{J O
,{{O P
msg{{Q T
={{U V
$str{{W v
}{{w x
){{x y
;{{y z
if|| 
(|| 

DbProducto|| 
.|| 
Id|| !
<=||" $
$num||% &
)||& '
return||( .

StatusCode||/ 9
(||9 :
$num||: =
,||= >
new||? B
{||C D
ok||E G
=||H I
false||J O
,||O P
msg||Q T
=||U V
$str||W v
}||w x
)||x y
;||y z
if~~ 
(~~ 

DbProducto~~ 
.~~ 
UserUid~~ &
!=~~' )
user~~* .
.~~. /

Id_Usuario~~/ 9
)~~9 :
return~~; A

StatusCode~~B L
(~~L M
$num~~M P
,~~P Q
new~~R U
{~~V W
ok~~X Z
=~~[ \
false~~] b
,~~b c
msg~~d g
=~~h i
$str	~~j ó
}
~~ò ô
)
~~ô ö
;
~~ö õ
if 
( 

DbProducto 
. 
IdCre $
!=% '
user( ,
., -

Id_Usuario- 7
)7 8
return9 ?

StatusCode@ J
(J K
$numK N
,N O
newP S
{T U
okV X
=Y Z
false[ `
,` a
msgc f
=g h
$str	i ñ
}
ó ò
)
ò ô
;
ô ö
await
ÅÅ 
mEvento
ÅÅ 
.
ÅÅ '
INR_Eliminar_Notificacion
ÅÅ 7
(
ÅÅ7 8
user
ÅÅ8 <
.
ÅÅ< =

Id_Usuario
ÅÅ= G
)
ÅÅG H
;
ÅÅH I
var
ÉÉ 
delR
ÉÉ 
=
ÉÉ 
await
ÉÉ  
mEvento
ÉÉ! (
.
ÉÉ( ))
INR_Eliminar_Evento_Usuario
ÉÉ) D
(
ÉÉD E
Id
ÉÉE G
)
ÉÉG H
;
ÉÉH I
if
ÑÑ 
(
ÑÑ 
!
ÑÑ 
delR
ÑÑ 
.
ÑÑ 
Ok
ÑÑ 
)
ÑÑ 
return
ÑÑ $

StatusCode
ÑÑ% /
(
ÑÑ/ 0
$num
ÑÑ0 3
,
ÑÑ3 4
delR
ÑÑ5 9
)
ÑÑ9 :
;
ÑÑ: ;
var
ÜÜ 
del
ÜÜ 
=
ÜÜ 
await
ÜÜ 
mEvento
ÜÜ  '
.
ÜÜ' (!
INR_Eliminar_Evento
ÜÜ( ;
(
ÜÜ; <
Id
ÜÜ< >
,
ÜÜ> ?
user
ÜÜ@ D
.
ÜÜD E

Id_Usuario
ÜÜE O
)
ÜÜO P
;
ÜÜP Q
if
áá 
(
áá 
!
áá 
del
áá 
.
áá 
Ok
áá 
)
áá 
return
áá #

StatusCode
áá$ .
(
áá. /
$num
áá/ 2
,
áá2 3
del
áá4 7
)
áá7 8
;
áá8 9
return
ââ 

StatusCode
ââ !
(
ââ! "
$num
ââ" %
,
ââ% &
new
ââ' *
{
ââ+ ,
ok
ââ- /
=
ââ0 1
true
ââ2 6
}
ââ7 8
)
ââ8 9
;
ââ9 :
}
ää 
catch
ãã 
(
ãã 
	Exception
ãã 
)
ãã 
{
åå 
return
çç 

StatusCode
çç !
(
çç! "
$num
çç" %
,
çç% &
new
çç' *
{
çç+ ,
ok
çç- /
=
çç0 1
false
çç2 7
,
çç7 8
msg
çç9 <
=
çç= >
$str
çç? |
}
çç} ~
)
çç~ 
;çç Ä
}
éé 
}
èè 	
[
ëë 	
HttpPut
ëë	 
(
ëë 
$str
ëë  
)
ëë  !
]
ëë! "
public
íí 
async
íí 
Task
íí 
<
íí 
ActionResult
íí &
<
íí& '
Notificacion
íí' 3
>
íí3 4
>
íí4 5
DeleteRe
íí6 >
(
íí> ?
[
íí? @
FromBody
íí@ H
]
ííH I
Relacion
ííJ R
Request
ííS Z
)
ííZ [
{
ìì 	
try
îî 
{
ïï 
if
ññ 
(
ññ 
HttpContext
ññ 
.
ññ  
User
ññ  $
.
ññ$ %
Identity
ññ% -
is
ññ. 0
not
ññ1 4
ClaimsIdentity
ññ5 C
identity
ññD L
)
ññL M
return
ññN T

StatusCode
ññU _
(
ññ_ `
$num
ññ` c
,
ññc d
new
ññe h
{
ññi j
ok
ññk m
=
ññn o
false
ññp u
,
ññu v
msg
ññw z
=
ññ{ |
$strññ} ∫
}ññª º
)ññº Ω
;ññΩ æ
ClaimsIdent
óó 
user
óó  
=
óó! "
mTokenCreate
óó# /
.
óó/ 0
GetUser
óó0 7
(
óó7 8
identity
óó8 @
.
óó@ A
Claims
óóA G
)
óóG H
;
óóH I
if
òò 
(
òò 
user
òò 
.
òò 

Id_Usuario
òò #
<=
òò$ &
$num
òò' (
)
òò( )
return
òò* 0

StatusCode
òò1 ;
(
òò; <
$num
òò< ?
,
òò? @
new
òòA D
{
òòE F
ok
òòG I
=
òòJ K
false
òòL Q
,
òòQ R
msg
òòS V
=
òòW X
$stròòY ñ
}òòó ò
)òòò ô
;òòô ö
Evento
öö 

DbProducto
öö !
=
öö" #
await
öö$ )
mEvento
öö* 1
.
öö1 2
INR_Buscar_Evento
öö2 C
(
ööC D
Request
ööD K
.
ööK L
Id_Nota
ööL S
)
ööS T
;
ööT U
if
õõ 
(
õõ 

DbProducto
õõ 
==
õõ !
null
õõ" &
)
õõ& '
return
õõ( .

StatusCode
õõ/ 9
(
õõ9 :
$num
õõ: =
,
õõ= >
new
õõ? B
{
õõC D
ok
õõE G
=
õõH I
false
õõJ O
,
õõO P
Request
õõQ X
.
õõX Y
Id_Nota
õõY `
,
õõ` a
msg
õõb e
=
õõf g
$strõõh á
}õõà â
)õõâ ä
;õõä ã
if
úú 
(
úú 

DbProducto
úú 
.
úú 
Id
úú !
<=
úú" $
$num
úú% &
)
úú& '
return
úú( .

StatusCode
úú/ 9
(
úú9 :
$num
úú: =
,
úú= >
new
úú? B
{
úúC D
ok
úúE G
=
úúH I
false
úúJ O
,
úúO P
Request
úúQ X
.
úúX Y
Id_Nota
úúY `
,
úú` a
msg
úúb e
=
úúf g
$strúúh á
}úúà â
)úúâ ä
;úúä ã
if
ûû 
(
ûû 

DbProducto
ûû 
.
ûû 
UserUid
ûû &
!=
ûû' )
user
ûû* .
.
ûû. /

Id_Usuario
ûû/ 9
)
ûû9 :
return
ûû; A

StatusCode
ûûB L
(
ûûL M
$num
ûûM P
,
ûûP Q
new
ûûR U
{
ûûV W
ok
ûûX Z
=
ûû[ \
false
ûû] b
,
ûûb c
Request
ûûd k
.
ûûk l
Id_User
ûûl s
,
ûûs t
msg
ûûu x
=
ûûy z
$strûû{ ¶
}ûûß ®
)ûû® ©
;ûû© ™
if
üü 
(
üü 

DbProducto
üü 
.
üü 
IdCre
üü $
!=
üü% '
user
üü( ,
.
üü, -

Id_Usuario
üü- 7
)
üü7 8
return
üü9 ?

StatusCode
üü@ J
(
üüJ K
$num
üüK N
,
üüN O
new
üüP S
{
üüT U
ok
üüV X
=
üüY Z
false
üü[ `
,
üü` a
Request
üüb i
.
üüi j
Id_User
üüj q
,
üüq r
msg
üüs v
=
üüw x
$strüüy §
}üü• ¶
)üü¶ ß
;üüß ®
var
°° 
delR
°° 
=
°° 
await
°°  
mEvento
°°! (
.
°°( )2
$INR_Eliminar_Evento_Usuario_Relacion
°°) M
(
°°M N

DbProducto
°°N X
.
°°X Y
Id
°°Y [
,
°°[ \
Request
°°] d
.
°°d e
Id_User
°°e l
)
°°l m
;
°°m n
if
¢¢ 
(
¢¢ 
!
¢¢ 
delR
¢¢ 
.
¢¢ 
Ok
¢¢ 
)
¢¢ 
return
¢¢ $

StatusCode
¢¢% /
(
¢¢/ 0
$num
¢¢0 3
,
¢¢3 4
delR
¢¢5 9
)
¢¢9 :
;
¢¢: ;
return
§§ 

StatusCode
§§ !
(
§§! "
$num
§§" %
,
§§% &
new
§§' *
{
§§+ ,
ok
§§- /
=
§§0 1
true
§§2 6
}
§§7 8
)
§§8 9
;
§§9 :
}
•• 
catch
¶¶ 
(
¶¶ 
	Exception
¶¶ 
)
¶¶ 
{
ßß 
return
®® 

StatusCode
®® !
(
®®! "
$num
®®" %
,
®®% &
new
®®' *
{
®®+ ,
ok
®®- /
=
®®0 1
false
®®2 7
,
®®7 8
msg
®®9 <
=
®®= >
$str
®®? |
}
®®} ~
)
®®~ 
;®® Ä
}
©© 
}
™™ 	
}
´´ 
}¨¨ ©
ZE:\visual\ricardo\Backend-C#\CalendarBackend\CalendarBackend\Controllers\HomeController.cs
	namespace 	
CalendarBackend
 
. 
Controllers %
{ 
public 

class 
HomeController 
:  !

Controller" ,
{ 
public 
IActionResult 
Index "
(" #
)# $
{ 	
return		 
View		 
(		 
)		 
;		 
}

 	
} 
} ®r
bE:\visual\ricardo\Backend-C#\CalendarBackend\CalendarBackend\Controllers\NotificationController.cs
	namespace 	
CalendarBackend
 
. 
Controllers %
{ 
public 

class "
NotificationController '
:( )

Controller* 4
{		 
private

 
readonly

 
	INrEvento

 "
mEvento

# *
;

* +
readonly 
ITokenCreate 
mTokenCreate *
;* +
private 
readonly 
INrNotificacion (
mNotificacion) 6
;6 7
private 
readonly 

ISendEmail #

mSendEmail$ .
;. /
public "
NotificationController %
(% &
	INrEvento& /
mEvento0 7
,7 8
ITokenCreate9 E
mTokenCreateF R
,R S
INrNotificacionT c
mNotificaciond q
,q r

ISendEmails }

mSendEmail	~ à
)
à â
{ 	
this 
. 
mEvento 
= 
mEvento "
;" #
this 
. 
mTokenCreate 
= 
mTokenCreate  ,
;, -
this 
. 
mNotificacion 
=  
mNotificacion! .
;. /
this 
. 

mSendEmail 
= 

mSendEmail (
;( )
} 	
[ 	
HttpGet	 
( 
$str  
)  !
]! "
public 
async 
Task 
< 
ActionResult &
<& '
Evento' -
>- .
>. /%
GetAllNotificationUsuario0 I
(I J
)J K
{ 	
try 
{ 
if 
( 
HttpContext 
.  
User  $
.$ %
Identity% -
is. 0
not1 4
ClaimsIdentity5 C
identityD L
)L M
returnN T

StatusCodeU _
(_ `
$num` c
,c d
newe h
{i j
okk m
=n o
falsep u
,u v
msgw z
={ |
$str	} ∫
}
ª º
)
º Ω
;
Ω æ
ClaimsIdent 
user  
=! "
mTokenCreate# /
./ 0
GetUser0 7
(7 8
identity8 @
.@ A
ClaimsA G
)G H
;H I
if 
( 
user 
. 

Id_Usuario #
<=$ &
$num' (
)( )

StatusCode* 4
(4 5
$num5 8
,8 9
new: =
{> ?
ok@ B
=C D
falseE J
,J K
msgL O
=P Q
$str	R è
}
ê ë
)
ë í
;
í ì
var 
list 
= 
await  
mNotificacion! .
.. /1
%INR_Mostar_Todos_Notificacion_Usuario/ T
(T U
userU Y
.Y Z

Id_UsuarioZ d
)d e
;e f
return!! 

StatusCode!! !
(!!! "
$num!!" %
,!!% &
new!!' *
{!!+ ,
ok!!- /
=!!0 1
true!!2 6
,!!6 7
notifications!!8 E
=!!F G
list!!H L
}!!M N
)!!N O
;!!O P
}"" 
catch## 
(## 
	Exception## 
)## 
{$$ 
return%% 

StatusCode%% !
(%%! "
$num%%" %
,%%% &
new%%' *
{%%+ ,
ok%%- /
=%%0 1
false%%2 7
,%%7 8
msg%%9 <
=%%= >
$str%%? |
}%%} ~
)%%~ 
;	%% Ä
}&& 
}'' 	
[)) 	
HttpPost))	 
()) 
$str)) (
)))( )
]))) *
public** 
async** 
Task** 
<** 
ActionResult** &
<**& '
Notificacion**' 3
>**3 4
>**4 5
Create**6 <
(**< =
[**= >
FromBody**> F
]**F G
NotificacionDelete**H Z
Request**[ b
)**b c
{++ 	
try,, 
{-- 
if.. 
(.. 
HttpContext.. 
...  
User..  $
...$ %
Identity..% -
is... 0
not..1 4
ClaimsIdentity..5 C
identity..D L
)..L M
return..N T

StatusCode..U _
(.._ `
$num..` c
,..c d
new..e h
{..i j
ok..k m
=..n o
false..p u
,..u v
msg..w z
=..{ |
$str	..} ∫
}
..ª º
)
..º Ω
;
..Ω æ
ClaimsIdent// 
user//  
=//! "
mTokenCreate//# /
./// 0
GetUser//0 7
(//7 8
identity//8 @
.//@ A
Claims//A G
)//G H
;//H I
if00 
(00 
user00 
.00 

Id_Usuario00 #
<=00$ &
$num00' (
)00( )
return00* 0

StatusCode001 ;
(00; <
$num00< ?
,00? @
new00A D
{00E F
ok00G I
=00J K
false00L Q
,00Q R
msg00S V
=00W X
$str	00Y ñ
}
00ó ò
)
00ò ô
;
00ô ö
Evento22 

DbProducto22 !
=22" #
await22$ )
mEvento22* 1
.221 2
INR_Buscar_Evento222 C
(22C D
Request22D K
.22K L
Id_Nota22L S
)22S T
;22T U
if33 
(33 

DbProducto33 
==33 !
null33" &
)33& '
return33( .

StatusCode33/ 9
(339 :
$num33: =
,33= >
new33? B
{33C D
ok33E G
=33H I
false33J O
,33O P
Request33Q X
.33X Y
Id_Nota33Y `
,33` a
msg33b e
=33f g
$str	33h á
}
33à â
)
33â ä
;
33ä ã
if44 
(44 

DbProducto44 
.44 
Id44 !
<=44" $
$num44% &
)44& '
return44( .

StatusCode44/ 9
(449 :
$num44: =
,44= >
new44? B
{44C D
ok44E G
=44H I
false44J O
,44O P
Request44Q X
.44X Y
Id_Nota44Y `
,44` a
msg44b e
=44f g
$str	44h á
}
44à â
)
44â ä
;
44ä ã
int66 
relac66 
=66 
await66 !
mEvento66" )
.66) *)
INR_Registrar_Evento_Relacion66* G
(66G H

DbProducto66H R
.66R S
Id66S U
,66U V
user66W [
.66[ \

Id_Usuario66\ f
)66f g
;66g h
if77 
(77 
relac77 
<=77 
$num77 
)77 
return77  &

StatusCode77' 1
(771 2
$num772 5
,775 6
new777 :
{77; <
ok77= ?
=77@ A
false77B G
,77G H
msg77I L
=77M N
$str	77O ç
}
77é è
)
77è ê
;
77ê ë
await99 
mNotificacion99 #
.99# $$
NR_Eliminar_Notificacion99$ <
(99< =
Request99= D
.99D E
Id_Not99E K
,99K L
user99M Q
.99Q R

Id_Usuario99R \
)99\ ]
;99] ^
var;; 

listGuests;; 
=;;  
await;;! &
mEvento;;' .
.;;. /,
 INR_Mostar_Todos_Usuarios_Evento;;/ O
(;;O P

DbProducto;;P Z
.;;Z [
Id;;[ ]
);;] ^
;;;^ _
return== 

StatusCode== !
(==! "
$num==" %
,==% &
new==' *
{==+ ,
ok==- /
===0 1
true==2 6
,==6 7
evento==8 >
===? @

DbProducto==A K
,==K L

listGuests==M W
}==X Y
)==Y Z
;==Z [
}>> 
catch?? 
(?? 
	Exception?? 
)?? 
{@@ 
returnAA 

StatusCodeAA !
(AA! "
$numAA" %
,AA% &
newAA' *
{AA+ ,
okAA- /
=AA0 1
falseAA2 7
,AA7 8
msgAA9 <
=AA= >
$strAA? |
}AA} ~
)AA~ 
;	AA Ä
}BB 
}CC 	
[EE 	
HttpPostEE	 
(EE 
$strEE )
)EE) *
]EE* +
publicFF 
asyncFF 
TaskFF 
<FF 
ActionResultFF &
<FF& '
NotificacionFF' 3
>FF3 4
>FF4 5
DeleteFF6 <
(FF< =
[FF= >
FromBodyFF> F
]FFF G
NotificacionDeleteFFH Z
RequestFF[ b
)FFb c
{GG 	
tryHH 
{II 
ifJJ 
(JJ 
HttpContextJJ 
.JJ  
UserJJ  $
.JJ$ %
IdentityJJ% -
isJJ. 0
notJJ1 4
ClaimsIdentityJJ5 C
identityJJD L
)JJL M
returnJJN T

StatusCodeJJU _
(JJ_ `
$numJJ` c
,JJc d
newJJe h
{JJi j
okJJk m
=JJn o
falseJJp u
,JJu v
msgJJw z
=JJ{ |
$str	JJ} ∫
}
JJª º
)
JJº Ω
;
JJΩ æ
ClaimsIdentKK 
userKK  
=KK! "
mTokenCreateKK# /
.KK/ 0
GetUserKK0 7
(KK7 8
identityKK8 @
.KK@ A
ClaimsKKA G
)KKG H
;KKH I
ifLL 
(LL 
userLL 
.LL 

Id_UsuarioLL #
<=LL$ &
$numLL' (
)LL( )
returnLL* 0

StatusCodeLL1 ;
(LL; <
$numLL< ?
,LL? @
newLLA D
{LLE F
okLLG I
=LLJ K
falseLLL Q
,LLQ R
msgLLS V
=LLW X
$str	LLY ñ
}
LLó ò
)
LLò ô
;
LLô ö
awaitNN 
mNotificacionNN #
.NN# $$
NR_Eliminar_NotificacionNN$ <
(NN< =
RequestNN= D
.NND E
Id_NotNNE K
,NNK L
userNNM Q
.NNQ R

Id_UsuarioNNR \
)NN\ ]
;NN] ^
returnPP 

StatusCodePP !
(PP! "
$numPP" %
,PP% &
newPP' *
{PP+ ,
okPP- /
=PP0 1
truePP2 6
}PP7 8
)PP8 9
;PP9 :
}QQ 
catchRR 
(RR 
	ExceptionRR 
)RR 
{SS 
returnTT 

StatusCodeTT !
(TT! "
$numTT" %
,TT% &
newTT' *
{TT+ ,
okTT- /
=TT0 1
falseTT2 7
,TT7 8
msgTT9 <
=TT= >
$strTT? |
}TT} ~
)TT~ 
;	TT Ä
}UU 
}VV 	
[XX 	
HttpPostXX	 
(XX 
$strXX !
)XX! "
]XX" #
publicYY 
asyncYY 
TaskYY 
<YY 
ActionResultYY &
<YY& '
	ListGuestYY' 0
>YY0 1
>YY1 2
CreateGuestsYY3 ?
(YY? @
[YY@ A
FromBodyYYA I
]YYI J
	ListGuestYYK T
RequestYYU \
)YY\ ]
{ZZ 	
try[[ 
{\\ 
if]] 
(]] 
HttpContext]] 
.]]  
User]]  $
.]]$ %
Identity]]% -
is]]. 0
not]]1 4
ClaimsIdentity]]5 C
identity]]D L
)]]L M
return]]N T

StatusCode]]U _
(]]_ `
$num]]` c
,]]c d
new]]e h
{]]i j
ok]]k m
=]]n o
false]]p u
,]]u v
msg]]w z
=]]{ |
$str	]]} ∫
}
]]ª º
)
]]º Ω
;
]]Ω æ
ClaimsIdent^^ 
user^^  
=^^! "
mTokenCreate^^# /
.^^/ 0
GetUser^^0 7
(^^7 8
identity^^8 @
.^^@ A
Claims^^A G
)^^G H
;^^H I
if__ 
(__ 
user__ 
.__ 

Id_Usuario__ #
<=__$ &
$num__' (
)__( )
return__* 0

StatusCode__1 ;
(__; <
$num__< ?
,__? @
new__A D
{__E F
ok__G I
=__J K
false__L Q
,__Q R
msg__S V
=__W X
$str	__Y ñ
}
__ó ò
)
__ò ô
;
__ô ö
ifaa 
(aa 
Requestaa 
.aa 
	ListGutesaa $
.aa$ %
Countaa% *
>aa+ ,
$numaa- .
)aa. /
{bb 
awaitcc 
mNotificacioncc '
.cc' (%
NR_Registrar_Notificacioncc( A
(ccA B
RequestccB I
.ccI J

LastinsertccJ T
,ccT U
RequestccV ]
.cc] ^
	ListGutescc^ g
,ccg h
usercci m
.ccm n

Id_Usuarioccn x
)ccx y
;ccy z
foreachee 
(ee 
varee 
itemee  $
inee% '
Requestee( /
.ee/ 0
	ListGutesee0 9
)ee9 :
{ff 

mSendEmailgg "
.gg" #
sendEmailUsersgg# 1
(gg1 2
itemgg2 6
.gg6 7
Emailgg7 <
)gg< =
;gg= >
}hh 
}ii 
returnkk 

StatusCodekk !
(kk! "
$numkk" %
,kk% &
newkk' *
{kk+ ,
okkk- /
=kk0 1
truekk2 6
}kk7 8
)kk8 9
;kk9 :
}ll 
catchmm 
(mm 
	Exceptionmm 
)mm 
{nn 
returnoo 

StatusCodeoo !
(oo! "
$numoo" %
,oo% &
newoo' *
{oo+ ,
okoo- /
=oo0 1
falseoo2 7
,oo7 8
msgoo9 <
=oo= >
$stroo? |
}oo} ~
)oo~ 
;	oo Ä
}pp 
}qq 	
}rr 
}ss €
UE:\visual\ricardo\Backend-C#\CalendarBackend\CalendarBackend\interfaces\ICOSetting.cs
	namespace 	
CalendarBackend
 
{ 
public 

	interface 

ICOSetting 
{ 
Dev 
AppSettings 
( 
) 
; 
}		 
}

 Ü
UE:\visual\ricardo\Backend-C#\CalendarBackend\CalendarBackend\interfaces\ISendEmail.cs
	namespace 	
CalendarBackend
 
{ 
public 

	interface 

ISendEmail 
{ 
bool 
sendEmailUsers 
( 
string "
email# (
)( )
;) *
} 
} µ
UE:\visual\ricardo\Backend-C#\CalendarBackend\CalendarBackend\Models\ErrorViewModel.cs
	namespace 	
CalendarBackend
 
. 
Models  
{ 
public 

class 
ErrorViewModel 
{ 
public 
string 
? 
	RequestId  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
bool 
ShowRequestId !
=>" $
!% &
string& ,
., -
IsNullOrEmpty- :
(: ;
	RequestId; D
)D E
;E F
} 
}		 ⁄D
GE:\visual\ricardo\Backend-C#\CalendarBackend\CalendarBackend\Program.cs
var

 
builder

 
=

 
WebApplication

 
.

 
CreateBuilder

 *
(

* +
args

+ /
)

/ 0
;

0 1
var "
MyAllowSpecificOrigins 
= 
$str 6
;6 7
builder 
. 
Configuration 
. 
AddJsonFile !
(! "
$str" 4
)4 5
;5 6
var 
code 
=	 

builder 
. 
Configuration  
.  !

GetSection! +
(+ ,
$str, =
)= >
.> ?
Get? B
<B C
DevC F
>F G
(G H
)H I
;I J
var 
keyBytes 
= 
Encoding 
. 
UTF8 
. 
GetBytes %
(% &
code& *
.* +
Token+ 0
)0 1
;1 2
builder 
. 
Services 
. #
AddControllersWithViews (
(( )
)) *
;* +
builder 
. 
Services 
. 
AddCors 
( 
options  
=>! #
{ 
options 
. 
	AddPolicy 
( "
MyAllowSpecificOrigins ,
,, -
policy 
=> 
{ 	
policy 
. 
WithOrigins 
( 
$str I
)I J
. 
WithOrigins 
( 
$str B
)B C
. 
WithOrigins 
( 
$str 1
)1 2
. 
WithOrigins 
( 
$str 0
)0 1
. 
AllowAnyHeader 
( 
) 
. 
AllowAnyMethod 
( 
) 
; 
} 	
)	 

;
 
} 
) 
; 
builder   
.   
Services   
.   
AddAuthentication   "
(  " #
config  # )
=>  * ,
{!! 
config"" 

.""
 %
DefaultAuthenticateScheme"" $
=""% &
JwtBearerDefaults""' 8
.""8 9 
AuthenticationScheme""9 M
;""M N
config## 

.##
 "
DefaultChallengeScheme## !
=##" #
JwtBearerDefaults##$ 5
.##5 6 
AuthenticationScheme##6 J
;##J K
}%% 
)%% 
.%% 
AddJwtBearer%% 
(%% 
config%% 
=>%% 
{&& 
config'' 

.''
  
RequireHttpsMetadata'' 
=''  !
false''" '
;''' (
config(( 

.((
 
	SaveToken(( 
=(( 
true(( 
;(( 
config)) 

.))
 %
TokenValidationParameters)) $
=))% &
new))' *%
TokenValidationParameters))+ D
{** $
ValidateIssuerSigningKey++  
=++! "
true++# '
,++' (
IssuerSigningKey,, 
=,, 
new,,  
SymmetricSecurityKey,, 3
(,,3 4
keyBytes,,4 <
),,< =
,,,= >
ValidateIssuer-- 
=-- 
false-- 
,-- 
ValidateAudience.. 
=.. 
false..  
}// 
;// 
}00 
)00 
;00 
builder22 
.22 
Services22 
.22 
AddControllers22 
(22  
)22  !
;22! "
builder33 
.33 
Services33 
.33 
	AddScoped33 
<33 

IBdUsuario33 %
,33% &

SbdUsuario33' 1
>331 2
(332 3
)333 4
;334 5
builder44 
.44 
Services44 
.44 
	AddScoped44 
<44 
	IDbEvento44 $
,44$ %
	SdbEvento44& /
>44/ 0
(440 1
)441 2
;442 3
builder55 
.55 
Services55 
.55 
	AddScoped55 
<55 
ICreateHash55 &
,55& '
SCreateHash55( 3
>553 4
(554 5
)555 6
;556 7
builder66 
.66 
Services66 
.66 
	AddScoped66 
<66 

INrUsuario66 %
,66% &

SnrUsuario66' 1
>661 2
(662 3
)663 4
;664 5
builder77 
.77 
Services77 
.77 
	AddScoped77 
<77 
ITokenCreate77 '
,77' (
STokenCreate77) 5
>775 6
(776 7
)777 8
;778 9
builder88 
.88 
Services88 
.88 
	AddScoped88 
<88 
IValidarCampos88 )
,88) *
SValidarCampos88+ 9
>889 :
(88: ;
)88; <
;88< =
builder99 
.99 
Services99 
.99 
	AddScoped99 
<99 
IValidarUsuario99 *
,99* +
SValidarUsuario99, ;
>99; <
(99< =
)99= >
;99> ?
builder:: 
.:: 
Services:: 
.:: 
	AddScoped:: 
<:: 
IValidarEvento:: )
,::) *
SValidarEvento::+ 9
>::9 :
(::: ;
)::; <
;::< =
builder;; 
.;; 
Services;; 
.;; 
	AddScoped;; 
<;; 
	INrEvento;; $
,;;$ %
	SnrEvento;;& /
>;;/ 0
(;;0 1
);;1 2
;;;2 3
builder<< 
.<< 
Services<< 
.<< 
	AddScoped<< 
<<< 
IDbNotificacion<< *
,<<* +
SdbNotificacion<<, ;
><<; <
(<<< =
)<<= >
;<<> ?
builder== 
.== 
Services== 
.== 
	AddScoped== 
<== 
INrNotificacion== *
,==* +
SnrNotificacion==, ;
>==; <
(==< =
)=== >
;==> ?
builder>> 
.>> 
Services>> 
.>> 
	AddScoped>> 
<>> 

ISendEmail>> %
,>>% &

SSendEmail>>' 1
>>>1 2
(>>2 3
)>>3 4
;>>4 5
builder?? 
.?? 
Services?? 
.?? 
	AddScoped?? 
<?? 

ICOSetting?? %
,??% &

ScoSetting??' 1
>??1 2
(??2 3
)??3 4
;??4 5
builder@@ 
.@@ 
Services@@ 
.@@ 
	AddScoped@@ 
<@@ 
	IBdAction@@ $
,@@$ %
	SbdAction@@& /
>@@/ 0
(@@0 1
)@@1 2
;@@2 3
varAA 
appAA 
=AA 	
builderAA
 
.AA 
BuildAA 
(AA 
)AA 
;AA 
ifCC 
(CC 
!CC 
appCC 
.CC 	
EnvironmentCC	 
.CC 
IsDevelopmentCC "
(CC" #
)CC# $
)CC$ %
{DD 
appEE 
.EE 
UseExceptionHandlerEE 
(EE 
$strEE )
)EE) *
;EE* +
appFF 
.FF 
UseHstsFF 
(FF 
)FF 
;FF 
}GG 
appII 
.II 
UseHttpsRedirectionII 
(II 
)II 
;II 
appKK 
.KK 
UseCorsKK 
(KK "
MyAllowSpecificOriginsKK "
)KK" #
;KK# $
appMM 
.MM 
UseStaticFilesMM 
(MM 
)MM 
;MM 
appOO 
.OO 

UseRoutingOO 
(OO 
)OO 
;OO 
appQQ 
.QQ 
UseCorsQQ 
(QQ 
)QQ 
;QQ 
appSS 
.SS 
UseAuthenticationSS 
(SS 
)SS 
;SS 
appUU 
.UU 
UseAuthorizationUU 
(UU 
)UU 
;UU 
appWW 
.WW 
MapControllerRouteWW 
(WW 
nameXX 
:XX 	
$strXX
 
,XX 
patternYY 
:YY 
$strYY 5
)YY5 6
;YY6 7
app[[ 
.[[ 
Run[[ 
([[ 
)[[ 	
;[[	 
´
SE:\visual\ricardo\Backend-C#\CalendarBackend\CalendarBackend\services\ScoSetting.cs
	namespace 	
CalendarBackend
 
{ 
public 

class 

ScoSetting 
: 

ICOSetting (
{ 
private 
readonly 
IConfiguration '
mConfiguration( 6
;6 7
public 

ScoSetting 
( 
IConfiguration (
mConfiguration) 7
)7 8
{		 	
this

 
.

 
mConfiguration

 
=

  !
mConfiguration

" 0
;

0 1
} 	
public 
Dev 
AppSettings 
( 
)  
{ 	
return 
mConfiguration !
.! "

GetSection" ,
(, -
$str- >
)> ?
.? @
Get@ C
<C D
DevD G
>G H
(H I
)I J
;J K
} 	
} 
} ª
SE:\visual\ricardo\Backend-C#\CalendarBackend\CalendarBackend\services\SSendEmail.cs
	namespace 	
CalendarBackend
 
{ 
public 

class 

SSendEmail 
: 

ISendEmail (
{ 
private 
readonly 

ICOSetting #
mSetting$ ,
;, -
public		 

SSendEmail		 
(		 

ICOSetting		 $
mSetting		% -
)		- .
{

 	
this 
. 
mSetting 
= 
mSetting $
;$ %
} 	
public 
bool 
sendEmailUsers "
(" #
string# )
email* /
)/ 0
{ 	
try 
{ 
var 
setting 
= 
mSetting &
.& '
AppSettings' 2
(2 3
)3 4
;4 5
MailMessage 
message #
=$ %
new& )
() *
)* +
{ 
From 
= 
new 
MailAddress *
(* +
setting+ 2
.2 3
Email3 8
)8 9
,9 :
Subject 
= 
$str ,
} 
; 
message 
. 
To 
. 
Add 
( 
new "
MailAddress# .
(. /
email/ 4
)4 5
)5 6
;6 7
message 
. 
Body 
= 
$" !
$str! '
"' (
+) *
$" 
$str 
" 
+  
$" 
$str !
{! "
email" '
}' (
$str( w
"w x
+y z
$" 
$str p
"p q
+r s
$" 
$str 
" 
; 
message!! 
.!! 

IsBodyHtml!! "
=!!# $
true!!% )
;!!) *
var## 

smtpClient## 
=##  
new##! $

SmtpClient##% /
(##/ 0
setting##0 7
.##7 8
Client##8 >
)##> ?
{$$ 
Port%% 
=%% 
$num%% 
,%% 
Credentials&& 
=&&  !
new&&" %
NetworkCredential&&& 7
(&&7 8
setting&&8 ?
.&&? @
Email&&@ E
,&&E F
setting&&G N
.&&N O
Pass&&O S
)&&S T
,&&T U
	EnableSsl'' 
='' 
true''  $
}(( 
;(( 

smtpClient** 
.** 
Send** 
(**  
message**  '
)**' (
;**( )
return,, 
true,, 
;,, 
}-- 
catch.. 
(.. 
	Exception.. 
).. 
{// 
return00 
false00 
;00 
}11 
}22 	
}33 
}44 