ñ
SE:\visual\ricardo\Backend-C#\CalendarBackend\Capa_Negocio\interfaces\ICreateHash.cs
	namespace 	
Capa_Negocio
 
{ 
public 

	interface 
ICreateHash  
{ 
string 
PasswordDecrypt 
( 
string %
password& .
). /
;/ 0
string !
CreatePasswordEncrypt $
($ %
string% +
password, 4
)4 5
;5 6
} 
} ‚
QE:\visual\ricardo\Backend-C#\CalendarBackend\Capa_Negocio\interfaces\INrEvento.cs
	namespace 	
Capa_Negocio
 
{ 
public 

	interface 
	INrEvento 
{ 
Task 
< 
Resp 
> 
INR_Editar_Evento $
($ %
Evento% +
evento, 2
)2 3
;3 4
Task 
< 
Resp 
> 
INR_Eliminar_Evento &
(& '
int' *
Id_Even+ 2
,2 3
int4 7
uid8 ;
); <
;< =
Task		 
<		 
Resp		 
>		 '
INR_Eliminar_Evento_Usuario		 .
(		. /
int		/ 2
Id_Even		3 :
)		: ;
;		; <
Task

 
<

 
Resp

 
>

 0
$INR_Eliminar_Evento_Usuario_Relacion

 7
(

7 8
int

8 ;
Id_Even

< C
,

C D
int

E H
Id_User

I P
)

P Q
;

Q R
Task 
< 
Resp 
> %
INR_Eliminar_Notificacion ,
(, -
int- 0
uid1 4
)4 5
;5 6
Task 
< 
List 
< 

EventoPart 
> 
> +
INR_Mostar_Todos_Evento_Usuario >
(> ?
int? B
uidC F
)F G
;G H
Task 
< 
List 
< 
Guests 
> 
> ,
 INR_Mostar_Todos_Usuarios_Evento ;
(; <
int< ?
Id_Even@ G
)G H
;H I
Task 
< 
int 
>  
INR_Registrar_Evento &
(& '
Evento' -
evento. 4
)4 5
;5 6
Task 
< 
int 
> )
INR_Registrar_Evento_Relacion /
(/ 0
int0 3
Id_Even4 ;
,; <
int= @
uidA D
)D E
;E F
Evento 
RegisterDataSn 
( 
ClaimsIdent )
identity* 2
,2 3
EventoRegister4 B
RequestC J
)J K
;K L
Evento 
RegisterData 
( 
Guests "
guests# )
,) *
EventoRegister+ 9
Request: A
,A B
ClaimsIdentC N
identO T
)T U
;U V
Evento 

UpdateData 
( 
ClaimsIdent %
identity& .
,. /
EventoUpdate0 <
Request= D
)D E
;E F
Task 
< 
Evento 
> 
INR_Buscar_Evento &
(& '
int' *
Id_Even+ 2
)2 3
;3 4
} 
} À
WE:\visual\ricardo\Backend-C#\CalendarBackend\Capa_Negocio\interfaces\INrNotificacion.cs
	namespace 	
Capa_Negocio
 
{ 
public 

	interface 
INrNotificacion $
{ 
Task 
< 
int 
> %
NR_Registrar_Notificacion +
(+ ,
int, /
id_Not0 6
,6 7
List8 <
<< =
Guests= C
>C D
ListGueE L
,L M
intN Q
id_UsuR X
)X Y
;Y Z
Task 
< 
bool 
> $
NR_Eliminar_Notificacion +
(+ ,
int, /
Id_Not0 6
,6 7
int8 ;
Id_Usu< B
)B C
;C D
Task		 
<		 
List		 
<		 
Notificacion		 
>		 
>		  1
%INR_Mostar_Todos_Notificacion_Usuario		! F
(		F G
int		G J
Id_Usu		K Q
)		Q R
;		R S
}

 
} §
RE:\visual\ricardo\Backend-C#\CalendarBackend\Capa_Negocio\interfaces\INrUsuario.cs
	namespace 	
Capa_Negocio
 
{ 
public 

	interface 

INrUsuario 
{ 
Task 
< 
Resp 
> 
NR_Buscar_CorreoS $
($ %
string% +
email, 1
)1 2
;2 3
Task 
< 
int 
>  
NR_Registrar_Usuario &
(& '
UsuarioRegister' 6
usuario7 >
)> ?
;? @
Task		 
<		 
Usuario		 
>		 
NR_Login		 
(		 
string		 %
email		& +
)		+ ,
;		, -
}

 
} Â
TE:\visual\ricardo\Backend-C#\CalendarBackend\Capa_Negocio\interfaces\ITokenCreate.cs
	namespace 	
Capa_Negocio
 
{ 
public 

	interface 
ITokenCreate !
{ 
ClaimsIdent 
GetUser 
( 
IEnumerable '
<' (
Claim( -
>- .
identity/ 7
)7 8
;8 9
string		 
TokenCreate		 
(		 
int		 
id		 !
,		! "
string		# )
nombre		* 0
)		0 1
;		1 2
ClaimsIdent

 
ValidarToken

  
(

  !
string

! '
token

( -
,

- .
IEnumerable

/ :
<

: ;
Claim

; @
>

@ A
identity

B J
)

J K
;

K L
} 
} ®'
QE:\visual\ricardo\Backend-C#\CalendarBackend\Capa_Negocio\services\SCreateHash.cs
	namespace 	
Capa_Negocio
 
{ 
public 

class 
SCreateHash 
: 
ICreateHash *
{ 
public 
string !
CreatePasswordEncrypt +
(+ ,
string, 2
password3 ;
); <
{		 	
byte

 
[

 
]

 
iv

 
=

 
new

 
byte

  
[

  !
$num

! #
]

# $
;

$ %
byte 
[ 
] 
array 
; 
try 
{ 
using 
( 
Aes 
aes 
=  
Aes! $
.$ %
Create% +
(+ ,
), -
)- .
{ 
aes 
. 
Key 
= 
Encoding &
.& '
UTF8' +
.+ ,
GetBytes, 4
(4 5
$str5 O
)O P
;P Q
aes 
. 
IV 
= 
iv 
;  
ICryptoTransform $
	encryptor% .
=/ 0
aes1 4
.4 5
CreateEncryptor5 D
(D E
aesE H
.H I
KeyI L
,L M
aesN Q
.Q R
IVR T
)T U
;U V
using 
MemoryStream &
ms' )
=* +
new, /
(/ 0
)0 1
;1 2
using 
CryptoStream &
cryptoStream' 3
=4 5
new6 9
(9 :
ms: <
,< =
	encryptor> G
,G H
CryptoStreamModeI Y
.Y Z
WriteZ _
)_ `
;` a
using 
( 
StreamWriter '
streamWriter( 4
=5 6
new7 :
(: ;
cryptoStream; G
)G H
)H I
{ 
streamWriter $
.$ %
Write% *
(* +
password+ 3
)3 4
;4 5
} 
array 
= 
ms 
. 
ToArray &
(& '
)' (
;( )
} 
return   
Convert   
.   
ToBase64String   -
(  - .
array  . 3
)  3 4
;  4 5
}!! 
catch"" 
("" 
	Exception"" 
)"" 
{## 
return$$ 
$str$$ 
;$$ 
}%% 
}&& 	
public(( 
string(( 
PasswordDecrypt(( %
(((% &
string((& ,
password((- 5
)((5 6
{)) 	
byte** 
[** 
]** 
iv** 
=** 
new** 
byte**  
[**  !
$num**! #
]**# $
;**$ %
try,, 
{-- 
byte.. 
[.. 
].. 
buffer.. 
=.. 
Convert..  '
...' (
FromBase64String..( 8
(..8 9
password..9 A
)..A B
;..B C
using// 
Aes// 
aes// 
=// 
Aes//  #
.//# $
Create//$ *
(//* +
)//+ ,
;//, -
aes00 
.00 
Key00 
=00 
Encoding00 "
.00" #
UTF800# '
.00' (
GetBytes00( 0
(000 1
$str001 K
)00K L
;00L M
aes11 
.11 
IV11 
=11 
iv11 
;11 
ICryptoTransform33  
	decryptor33! *
=33+ ,
aes33- 0
.330 1
CreateDecryptor331 @
(33@ A
aes33A D
.33D E
Key33E H
,33H I
aes33J M
.33M N
IV33N P
)33P Q
;33Q R
using55 
MemoryStream55 "
ms55# %
=55& '
new55( +
(55+ ,
buffer55, 2
)552 3
;553 4
using66 
CryptoStream66 "
cryptoStream66# /
=660 1
new662 5
(665 6
ms666 8
,668 9
	decryptor66: C
,66C D
CryptoStreamMode66E U
.66U V
Read66V Z
)66Z [
;66[ \
using77 
StreamReader77 "
sr77# %
=77& '
new77( +
(77+ ,
cryptoStream77, 8
)778 9
;779 :
return99 
sr99 
.99 
	ReadToEnd99 #
(99# $
)99$ %
;99% &
}:: 
catch;; 
(;; 
	Exception;; 
);; 
{<< 
return== 
$str== 
;== 
}>> 
}?? 	
}@@ 
}AA ‚»
OE:\visual\ricardo\Backend-C#\CalendarBackend\Capa_Negocio\services\SnrEvento.cs
	namespace 	
Capa_Negocio
 
{ 
public 

class 
	SnrEvento 
: 
	INrEvento &
{ 
private		 
readonly		 
	IDbEvento		 "
mEvento		# *
;		* +
private

 
readonly

 
	IBdAction

 "
mAction

# *
;

* +
public 
	SnrEvento 
( 
	IDbEvento "
mEvento# *
,* +
	IBdAction, 5
mAction6 =
)= >
{ 	
this 
. 
mEvento 
= 
mEvento "
;" #
this 
. 
mAction 
= 
mAction "
;" #
} 	
public 
async 
Task 
< 
Resp 
> 
INR_Editar_Evento  1
(1 2
Evento2 8
evento9 ?
)? @
{ 	
var 
resp 
= 
await 
mEvento $
.$ %
BD_Editar_Evento% 5
(5 6
evento6 <
)< =
;= >
if 
( 
resp 
) 
return 
new  
(  !
)! "
{# $
Ok% '
=( )
false* /
,/ 0
msg1 4
=5 6
$str7 t
}u v
;v w
return 
new 
( 
) 
{ 
Ok 
= 
true  $
}% &
;& '
} 	
public 
async 
Task 
< 
Resp 
> 
INR_Eliminar_Evento  3
(3 4
int4 7
Id_Even8 ?
,? @
intA D
uidE H
)H I
{ 	
var 
resp 
= 
await 
mEvento $
.$ %
BD_Eliminar_Evento% 7
(7 8
Id_Even8 ?
,? @
uidA D
)D E
;E F
if 
( 
resp 
) 
return 
new  
(  !
)! "
{# $
Ok% '
=( )
false* /
,/ 0
msg1 4
=5 6
$str7 t
}u v
;v w
return 
new 
( 
) 
{ 
Ok 
= 
true  $
}% &
;& '
} 	
public!! 
async!! 
Task!! 
<!! 
List!! 
<!! 

EventoPart!! )
>!!) *
>!!* ++
INR_Mostar_Todos_Evento_Usuario!!, K
(!!K L
int!!L O
uid!!P S
)!!S T
{"" 	
	DataTable## 
eventos## 
=## 
await##  %
mEvento##& -
.##- .*
DB_Mostar_Todos_Evento_Usuario##. L
(##L M
uid##M P
)##P Q
;##Q R
var%% 
evaluar%% 
=%% 
await%% 
EvaluarLista%%  ,
(%%, -
eventos%%- 4
)%%4 5
;%%5 6
return'' 
evaluar'' 
;'' 
}(( 	
public)) 
async)) 
Task)) 
<)) 
List)) 
<)) 
Guests)) %
>))% &
>))& ',
 INR_Mostar_Todos_Usuarios_Evento))( H
())H I
int))I L
Id_Even))M T
)))T U
{** 	
	DataTable++ 
guests++ 
=++ 
await++ $
mEvento++% ,
.++, -+
DB_Mostar_Todos_Usuarios_Evento++- L
(++L M
Id_Even++M T
)++T U
;++U V
var-- 
evaluar-- 
=-- 
EvaluarListaGuest-- +
(--+ ,
guests--, 2
)--2 3
;--3 4
return// 
evaluar// 
;// 
}00 	
public11 
async11 
Task11 
<11 
int11 
>11  
INR_Registrar_Evento11 3
(113 4
Evento114 :
evento11; A
)11A B
{22 	
return33 
await33 
mEvento33  
.33  !
BD_Registrar_Evento33! 4
(334 5
evento335 ;
)33; <
;33< =
}44 	
public66 
Evento66 
RegisterDataSn66 $
(66$ %
ClaimsIdent66% 0
identity661 9
,669 :
EventoRegister66; I
Request66J Q
)66Q R
{77 	
var88 
evento88 
=88 
new88 
Evento88 #
{99 
Title:: 
=:: 
Request:: 
.::  
Title::  %
,::% &
Notes;; 
=;; 
Request;; 
.;;  
Notes;;  %
,;;% &
Start<< 
=<< 
Request<< 
.<<  
Start<<  %
,<<% &
End== 
=== 
Request== 
.== 
End== !
,==! "
User>> 
=>> 
identity>> 
.>>  
Names>>  %
,>>% &
UserUid?? 
=?? 
identity?? "
.??" #

Id_Usuario??# -
,??- .
IdCre@@ 
=@@ 
identity@@  
.@@  !

Id_Usuario@@! +
}AA 
;AA 
returnCC 
eventoCC 
;CC 
}DD 	
publicFF 
EventoFF 

UpdateDataFF  
(FF  !
ClaimsIdentFF! ,
identityFF- 5
,FF5 6
EventoUpdateFF7 C
RequestFFD K
)FFK L
{GG 	
EventoHH 
eventoHH 
=HH 
newHH 
(HH  
)HH  !
{II 
IdJJ 
=JJ 
RequestJJ 
.JJ 
IdJJ 
,JJ  
TitleKK 
=KK 
RequestKK 
.KK  
TitleKK  %
,KK% &
NotesLL 
=LL 
RequestLL 
.LL  
NotesLL  %
,LL% &
StartMM 
=MM 
RequestMM 
.MM  
StartMM  %
,MM% &
EndNN 
=NN 
RequestNN 
.NN 
EndNN !
,NN! "
UserOO 
=OO 
identityOO 
.OO  
NamesOO  %
,OO% &
UserUidPP 
=PP 
identityPP "
.PP" #

Id_UsuarioPP# -
}QQ 
;QQ 
returnSS 
eventoSS 
;SS 
}TT 	
publicVV 
asyncVV 
TaskVV 
<VV 
EventoVV  
>VV  !
INR_Buscar_EventoVV" 3
(VV3 4
intVV4 7
Id_EvenVV8 ?
)VV? @
{WW 	
	DataTableXX 
dataXX 
=XX 
awaitXX "
mEventoXX# *
.XX* +
BD_Buscar_EventoXX+ ;
(XX; <
Id_EvenXX< C
)XXC D
;XXD E
ifZZ 
(ZZ 
dataZZ 
.ZZ 
RowsZZ 
.ZZ 
CountZZ 
>ZZ  !
$numZZ" #
)ZZ# $
{[[ 
var\\ 
Usuario\\ 
=\\ 
data\\ "
.\\" #
Rows\\# '
[\\' (
$num\\( )
]\\) *
[\\* +
$str\\+ 4
]\\4 5
.\\5 6
ToString\\6 >
(\\> ?
)\\? @
;\\@ A
if]] 
(]] 
string]] 
.]] 
IsNullOrEmpty]] (
(]]( )
Usuario]]) 0
)]]0 1
)]]1 2
return]]3 9
new]]: =
(]]= >
)]]> ?
;]]? @
var__ 
title__ 
=__ 
data__  
.__  !
Rows__! %
[__% &
$num__& '
]__' (
[__( )
$str__) 0
]__0 1
.__1 2
ToString__2 :
(__: ;
)__; <
;__< =
if`` 
(`` 
string`` 
.`` 
IsNullOrEmpty`` (
(``( )
title``) .
)``. /
)``/ 0
return``1 7
new``8 ;
(``; <
)``< =
;``= >
varbb 
notesbb 
=bb 
databb  
.bb  !
Rowsbb! %
[bb% &
$numbb& '
]bb' (
[bb( )
$strbb) 0
]bb0 1
.bb1 2
ToStringbb2 :
(bb: ;
)bb; <
;bb< =
ifcc 
(cc 
stringcc 
.cc 
IsNullOrEmptycc (
(cc( )
notescc) .
)cc. /
)cc/ 0
returncc1 7
newcc8 ;
(cc; <
)cc< =
;cc= >
varee 
startee 
=ee 
dataee  
.ee  !
Rowsee! %
[ee% &
$numee& '
]ee' (
[ee( )
$stree) 5
]ee5 6
.ee6 7
ToStringee7 ?
(ee? @
)ee@ A
;eeA B
ifff 
(ff 
stringff 
.ff 
IsNullOrEmptyff (
(ff( )
startff) .
)ff. /
)ff/ 0
returnff1 7
newff8 ;
(ff; <
)ff< =
;ff= >
varhh 
endhh 
=hh 
datahh 
.hh 
Rowshh #
[hh# $
$numhh$ %
]hh% &
[hh& '
$strhh' 1
]hh1 2
.hh2 3
ToStringhh3 ;
(hh; <
)hh< =
;hh= >
ifii 
(ii 
stringii 
.ii 
IsNullOrEmptyii (
(ii( )
endii) ,
)ii, -
)ii- .
returnii/ 5
newii6 9
(ii9 :
)ii: ;
;ii; <
Eventokk 
eventokk 
=kk 
newkk  #
(kk# $
)kk$ %
{ll 
Idmm 
=mm 
Convertmm  
.mm  !
ToInt16mm! (
(mm( )
datamm) -
.mm- .
Rowsmm. 2
[mm2 3
$nummm3 4
]mm4 5
[mm5 6
$strmm6 >
]mm> ?
)mm? @
,mm@ A
UserUidnn 
=nn 
Convertnn %
.nn% &
ToInt16nn& -
(nn- .
datann. 2
.nn2 3
Rowsnn3 7
[nn7 8
$numnn8 9
]nn9 :
[nn: ;
$strnn; C
]nnC D
)nnD E
,nnE F
Useroo 
=oo 
Usuariooo "
,oo" #
Titlepp 
=pp 
titlepp !
,pp! "
Notesqq 
=qq 
notesqq !
,qq! "
Startrr 
=rr 
startrr !
,rr! "
Endss 
=ss 
endss 
,ss 
IdCrett 
=tt 
Converttt #
.tt# $
ToInt16tt$ +
(tt+ ,
datatt, 0
.tt0 1
Rowstt1 5
[tt5 6
$numtt6 7
]tt7 8
[tt8 9
$strtt9 A
]ttA B
)ttB C
}uu 
;uu 
returnww 
eventoww 
;ww 
}xx 
returnzz 
newzz 
(zz 
)zz 
;zz 
}{{ 	
public}} 
Evento}} 
RegisterData}} "
(}}" #
Guests}}# )
guests}}* 0
,}}0 1
EventoRegister}}2 @
Request}}A H
,}}H I
ClaimsIdent}}J U
ident}}V [
)}}[ \
{~~ 	
Evento 
evento 
= 
new 
(  
)  !
{
ÄÄ 
Title
ÅÅ 
=
ÅÅ 
Request
ÅÅ 
.
ÅÅ  
Title
ÅÅ  %
,
ÅÅ% &
Notes
ÇÇ 
=
ÇÇ 
Request
ÇÇ 
.
ÇÇ  
Notes
ÇÇ  %
,
ÇÇ% &
Start
ÉÉ 
=
ÉÉ 
Request
ÉÉ 
.
ÉÉ  
Start
ÉÉ  %
,
ÉÉ% &
End
ÑÑ 
=
ÑÑ 
Request
ÑÑ 
.
ÑÑ 
End
ÑÑ !
,
ÑÑ! "
User
ÖÖ 
=
ÖÖ 
ident
ÖÖ 
.
ÖÖ 
Names
ÖÖ "
,
ÖÖ" #
UserUid
ÜÜ 
=
ÜÜ 
guests
ÜÜ  
.
ÜÜ  !
id
ÜÜ! #
,
ÜÜ# $
IdCre
áá 
=
áá 
ident
áá 
.
áá 

Id_Usuario
áá (
}
àà 
;
àà 
return
ää 
evento
ää 
;
ää 
}
ãã 	
public
çç 
async
çç 
Task
çç 
<
çç 
Resp
çç 
>
çç )
INR_Eliminar_Evento_Usuario
çç  ;
(
çç; <
int
çç< ?
Id_Even
çç@ G
)
ççG H
{
éé 	
var
èè 
notUs
èè 
=
èè 
await
èè 
mEvento
èè %
.
èè% &(
BD_Eliminar_Evento_Usuario
èè& @
(
èè@ A
Id_Even
èèA H
)
èèH I
;
èèI J
if
êê 
(
êê 
notUs
êê 
)
êê 
return
êê 
new
êê !
(
êê! "
)
êê" #
{
êê$ %
Ok
êê& (
=
êê) *
false
êê+ 0
,
êê0 1
msg
êê2 5
=
êê6 7
$str
êê8 v
}
êêw x
;
êêx y
return
íí 
new
íí 
(
íí 
)
íí 
{
íí 
Ok
íí 
=
íí 
true
íí  $
}
íí% &
;
íí& '
}
ìì 	
public
ïï 
async
ïï 
Task
ïï 
<
ïï 
int
ïï 
>
ïï +
INR_Registrar_Evento_Relacion
ïï <
(
ïï< =
int
ïï= @
Id_Even
ïïA H
,
ïïH I
int
ïïJ M
uid
ïïN Q
)
ïïQ R
{
ññ 	
return
óó 
await
óó 
mEvento
óó  
.
óó  !*
BD_Registrar_Evento_Relacion
óó! =
(
óó= >
Id_Even
óó> E
,
óóE F
uid
óóG J
)
óóJ K
;
óóK L
}
òò 	
private
öö 
async
öö 
Task
öö 
<
öö 
List
öö 
<
öö  

EventoPart
öö  *
>
öö* +
>
öö+ ,
EvaluarLista
öö- 9
(
öö9 :
	DataTable
öö: C
eventos
ööD K
)
ööK L
{
õõ 	
List
úú 
<
úú 

EventoPart
úú 
>
úú 
list
úú !
=
úú" #
new
úú$ '
(
úú' (
)
úú( )
;
úú) *
try
ûû 
{
üü 
if
†† 
(
†† 
eventos
†† 
.
†† 
Rows
††  
.
††  !
Count
††! &
>
††' (
$num
††) *
)
††* +
{
°° 
foreach
¢¢ 
(
¢¢ 
DataRow
¢¢ $
row
¢¢% (
in
¢¢) +
eventos
¢¢, 3
.
¢¢3 4
Rows
¢¢4 8
)
¢¢8 9
{
££ 
var
§§ 
indicted
§§ $
=
§§% &
EvualarDataRow
§§' 5
(
§§5 6
row
§§6 9
)
§§9 :
;
§§: ;
if
•• 
(
•• 
indicted
•• $
.
••$ %
Id
••% '
<=
••( *
$num
••+ ,
)
••, -
break
••. 3
;
••3 4
var
¶¶ 
resp
¶¶  
=
¶¶! "
await
¶¶# (.
 INR_Mostar_Todos_Usuarios_Evento
¶¶) I
(
¶¶I J
indicted
¶¶J R
.
¶¶R S
Id
¶¶S U
)
¶¶U V
;
¶¶V W
indicted
ßß  
.
ßß  !

listGuests
ßß! +
=
ßß, -
resp
ßß. 2
;
ßß2 3
list
®® 
.
®® 
Add
®®  
(
®®  !
indicted
®®! )
)
®®) *
;
®®* +
}
©© 
return
™™ 
list
™™ 
;
™™  
}
´´ 
return
≠≠ 
list
≠≠ 
;
≠≠ 
}
ÆÆ 
catch
ØØ 
(
ØØ 
	Exception
ØØ 
)
ØØ 
{
∞∞ 
return
±± 
list
±± 
;
±± 
}
≤≤ 
}
≥≥ 	
private
µµ 
static
µµ 
List
µµ 
<
µµ 
Guests
µµ "
>
µµ" #
EvaluarListaGuest
µµ$ 5
(
µµ5 6
	DataTable
µµ6 ?
eventos
µµ@ G
)
µµG H
{
∂∂ 	
List
∑∑ 
<
∑∑ 
Guests
∑∑ 
>
∑∑ 
list
∑∑ 
=
∑∑ 
new
∑∑  #
(
∑∑# $
)
∑∑$ %
;
∑∑% &
try
ππ 
{
∫∫ 
if
ªª 
(
ªª 
eventos
ªª 
.
ªª 
Rows
ªª  
.
ªª  !
Count
ªª! &
>
ªª' (
$num
ªª) *
)
ªª* +
{
ºº 
foreach
ΩΩ 
(
ΩΩ 
DataRow
ΩΩ $
row
ΩΩ% (
in
ΩΩ) +
eventos
ΩΩ, 3
.
ΩΩ3 4
Rows
ΩΩ4 8
)
ΩΩ8 9
{
ææ 
var
øø 
name
øø  
=
øø! "
row
øø# &
[
øø& '
$str
øø' -
]
øø- .
.
øø. /
ToString
øø/ 7
(
øø7 8
)
øø8 9
;
øø9 :
if
¿¿ 
(
¿¿ 
string
¿¿ "
.
¿¿" #
IsNullOrEmpty
¿¿# 0
(
¿¿0 1
name
¿¿1 5
)
¿¿5 6
)
¿¿6 7
break
¿¿8 =
;
¿¿= >
var
¬¬ 
email
¬¬ !
=
¬¬" #
row
¬¬$ '
[
¬¬' (
$str
¬¬( /
]
¬¬/ 0
.
¬¬0 1
ToString
¬¬1 9
(
¬¬9 :
)
¬¬: ;
;
¬¬; <
if
√√ 
(
√√ 
string
√√ "
.
√√" #
IsNullOrEmpty
√√# 0
(
√√0 1
email
√√1 6
)
√√6 7
)
√√7 8
break
√√9 >
;
√√> ?
Guests
≈≈ 
env
≈≈ "
=
≈≈# $
new
≈≈% (
(
≈≈( )
)
≈≈) *
{
∆∆ 
id
«« 
=
««  
Convert
««! (
.
««( )
ToInt16
««) 0
(
««0 1
row
««1 4
[
««4 5
$str
««5 =
]
««= >
.
««> ?
ToString
««? G
(
««G H
)
««H I
)
««I J
,
««J K
Name
»»  
=
»»! "
name
»»# '
,
»»' (
Email
…… !
=
……" #
email
……$ )
,
……) *
}
   
;
   
list
ÃÃ 
.
ÃÃ 
Add
ÃÃ  
(
ÃÃ  !
env
ÃÃ! $
)
ÃÃ$ %
;
ÃÃ% &
}
ÕÕ 
return
ŒŒ 
list
ŒŒ 
;
ŒŒ  
}
œœ 
return
—— 
list
—— 
;
—— 
}
““ 
catch
”” 
(
”” 
	Exception
”” 
)
”” 
{
‘‘ 
return
’’ 
list
’’ 
;
’’ 
}
÷÷ 
}
◊◊ 	
public
ŸŸ 
async
ŸŸ 
Task
ŸŸ 
<
ŸŸ 
Resp
ŸŸ 
>
ŸŸ 2
$INR_Eliminar_Evento_Usuario_Relacion
ŸŸ  D
(
ŸŸD E
int
ŸŸE H
Id_Even
ŸŸI P
,
ŸŸP Q
int
ŸŸR U
Id_User
ŸŸV ]
)
ŸŸ] ^
{
⁄⁄ 	
var
€€ 
resp
€€ 
=
€€ 
await
€€ 
mEvento
€€ $
.
€€$ %)
BD_Eliminar_Evento_Relacion
€€% @
(
€€@ A
Id_Even
€€A H
,
€€H I
Id_User
€€J Q
)
€€Q R
;
€€R S
if
‹‹ 
(
‹‹ 
resp
‹‹ 
)
‹‹ 
return
‹‹ 
new
‹‹  
(
‹‹  !
)
‹‹! "
{
‹‹# $
Ok
‹‹% '
=
‹‹( )
false
‹‹* /
,
‹‹/ 0
msg
‹‹1 4
=
‹‹5 6
$str
‹‹7 u
}
‹‹v w
;
‹‹w x
return
ﬁﬁ 
new
ﬁﬁ 
(
ﬁﬁ 
)
ﬁﬁ 
{
ﬁﬁ 
Ok
ﬁﬁ 
=
ﬁﬁ 
true
ﬁﬁ  $
}
ﬁﬁ% &
;
ﬁﬁ& '
}
ﬂﬂ 	
public
·· 
async
·· 
Task
·· 
<
·· 
Resp
·· 
>
·· '
INR_Eliminar_Notificacion
··  9
(
··9 :
int
··: =
uid
··> A
)
··A B
{
‚‚ 	
var
„„ 
resp
„„ 
=
„„ 
await
„„ 
mAction
„„ $
.
„„$ %&
BD_Eliminar_Notificacion
„„% =
(
„„= >
uid
„„> A
)
„„A B
;
„„B C
if
‰‰ 
(
‰‰ 
resp
‰‰ 
)
‰‰ 
return
‰‰ 
new
‰‰  
(
‰‰  !
)
‰‰! "
{
‰‰# $
Ok
‰‰% '
=
‰‰( )
false
‰‰* /
,
‰‰/ 0
msg
‰‰1 4
=
‰‰5 6
$str
‰‰7 u
}
‰‰v w
;
‰‰w x
return
ÂÂ 
new
ÂÂ 
(
ÂÂ 
)
ÂÂ 
{
ÂÂ 
Ok
ÂÂ 
=
ÂÂ 
true
ÂÂ  $
}
ÂÂ% &
;
ÂÂ& '
}
ÊÊ 	
private
ËË 
static
ËË 

EventoPart
ËË !
EvualarDataRow
ËË" 0
(
ËË0 1
DataRow
ËË1 8
row
ËË9 <
)
ËË< =
{
ÈÈ 	
var
ÍÍ 
user
ÍÍ 
=
ÍÍ 
row
ÍÍ 
[
ÍÍ 
$str
ÍÍ $
]
ÍÍ$ %
.
ÍÍ% &
ToString
ÍÍ& .
(
ÍÍ. /
)
ÍÍ/ 0
;
ÍÍ0 1
if
ÎÎ 
(
ÎÎ 
string
ÎÎ 
.
ÎÎ 
IsNullOrEmpty
ÎÎ $
(
ÎÎ$ %
user
ÎÎ% )
)
ÎÎ) *
)
ÎÎ* +
return
ÎÎ, 2
new
ÎÎ3 6
(
ÎÎ6 7
)
ÎÎ7 8
;
ÎÎ8 9
var
ÌÌ 
title
ÌÌ 
=
ÌÌ 
row
ÌÌ 
[
ÌÌ 
$str
ÌÌ #
]
ÌÌ# $
.
ÌÌ$ %
ToString
ÌÌ% -
(
ÌÌ- .
)
ÌÌ. /
;
ÌÌ/ 0
if
ÓÓ 
(
ÓÓ 
string
ÓÓ 
.
ÓÓ 
IsNullOrEmpty
ÓÓ $
(
ÓÓ$ %
title
ÓÓ% *
)
ÓÓ* +
)
ÓÓ+ ,
return
ÓÓ- 3
new
ÓÓ4 7
(
ÓÓ7 8
)
ÓÓ8 9
;
ÓÓ9 :
var
 
notes
 
=
 
row
 
[
 
$str
 #
]
# $
.
$ %
ToString
% -
(
- .
)
. /
;
/ 0
if
ÒÒ 
(
ÒÒ 
string
ÒÒ 
.
ÒÒ 
IsNullOrEmpty
ÒÒ $
(
ÒÒ$ %
notes
ÒÒ% *
)
ÒÒ* +
)
ÒÒ+ ,
return
ÒÒ- 3
new
ÒÒ4 7
(
ÒÒ7 8
)
ÒÒ8 9
;
ÒÒ9 :
var
ÛÛ 
start
ÛÛ 
=
ÛÛ 
row
ÛÛ 
[
ÛÛ 
$str
ÛÛ (
]
ÛÛ( )
.
ÛÛ) *
ToString
ÛÛ* 2
(
ÛÛ2 3
)
ÛÛ3 4
;
ÛÛ4 5
if
ÙÙ 
(
ÙÙ 
string
ÙÙ 
.
ÙÙ 
IsNullOrEmpty
ÙÙ $
(
ÙÙ$ %
start
ÙÙ% *
)
ÙÙ* +
)
ÙÙ+ ,
return
ÙÙ- 3
new
ÙÙ4 7
(
ÙÙ7 8
)
ÙÙ8 9
;
ÙÙ9 :
var
ˆˆ 
end
ˆˆ 
=
ˆˆ 
row
ˆˆ 
[
ˆˆ 
$str
ˆˆ $
]
ˆˆ$ %
.
ˆˆ% &
ToString
ˆˆ& .
(
ˆˆ. /
)
ˆˆ/ 0
;
ˆˆ0 1
if
˜˜ 
(
˜˜ 
string
˜˜ 
.
˜˜ 
IsNullOrEmpty
˜˜ $
(
˜˜$ %
end
˜˜% (
)
˜˜( )
)
˜˜) *
return
˜˜+ 1
new
˜˜2 5
(
˜˜5 6
)
˜˜6 7
;
˜˜7 8

EventoPart
˘˘ 
env
˘˘ 
=
˘˘ 
new
˘˘  
(
˘˘  !
)
˘˘! "
{
˙˙ 
Id
˚˚ 
=
˚˚ 
Convert
˚˚ 
.
˚˚ 
ToInt16
˚˚ $
(
˚˚$ %
row
˚˚% (
[
˚˚( )
$str
˚˚) 1
]
˚˚1 2
.
˚˚2 3
ToString
˚˚3 ;
(
˚˚; <
)
˚˚< =
)
˚˚= >
,
˚˚> ?
UserUid
¸¸ 
=
¸¸ 
Convert
¸¸ !
.
¸¸! "
ToInt16
¸¸" )
(
¸¸) *
row
¸¸* -
[
¸¸- .
$str
¸¸. 6
]
¸¸6 7
.
¸¸7 8
ToString
¸¸8 @
(
¸¸@ A
)
¸¸A B
)
¸¸B C
,
¸¸C D
User
˝˝ 
=
˝˝ 
user
˝˝ 
,
˝˝ 
Title
˛˛ 
=
˛˛ 
title
˛˛ 
,
˛˛ 
Notes
ˇˇ 
=
ˇˇ 
notes
ˇˇ 
,
ˇˇ 
Start
ÄÄ 
=
ÄÄ 
start
ÄÄ 
,
ÄÄ 
End
ÅÅ 
=
ÅÅ 
end
ÅÅ 
,
ÅÅ 
IdCre
ÇÇ 
=
ÇÇ 
Convert
ÇÇ 
.
ÇÇ  
ToInt16
ÇÇ  '
(
ÇÇ' (
row
ÇÇ( +
[
ÇÇ+ ,
$str
ÇÇ, 4
]
ÇÇ4 5
.
ÇÇ5 6
ToString
ÇÇ6 >
(
ÇÇ> ?
)
ÇÇ? @
)
ÇÇ@ A
}
ÉÉ 
;
ÉÉ 
return
ÖÖ 
env
ÖÖ 
;
ÖÖ 
}
ÜÜ 	
}
áá 
}àà û4
UE:\visual\ricardo\Backend-C#\CalendarBackend\Capa_Negocio\services\SnrNotificacion.cs
	namespace 	
Capa_Negocio
 
{ 
public 

class 
SnrNotificacion  
:! "
INrNotificacion# 2
{ 
private		 
readonly		 
IDbNotificacion		 (
mNotificacion		) 6
;		6 7
public 
SnrNotificacion 
( 
IDbNotificacion .
mNotificacion/ <
)< =
{ 	
this 
. 
mNotificacion 
=  
mNotificacion! .
;. /
} 	
public 
async 
Task 
< 
List 
< 
Notificacion +
>+ ,
>, -1
%INR_Mostar_Todos_Notificacion_Usuario. S
(S T
intT W
Id_UsuX ^
)^ _
{ 	
var 
resp 
= 
await 
mNotificacion *
.* +0
$DB_Mostar_Todas_Notificacion_Usuario+ O
(O P
Id_UsuP V
)V W
;W X
return 
EvaluarLista 
(  
resp  $
)$ %
;% &
} 	
public 
async 
Task 
< 
bool 
> $
NR_Eliminar_Notificacion  8
(8 9
int9 <
Id_Not= C
,C D
intE H
Id_UsuI O
)O P
{ 	
return 
await 
mNotificacion &
.& '$
BD_Eliminar_Notificacion' ?
(? @
Id_Not@ F
,F G
Id_UsuH N
)N O
;O P
} 	
public 
async 
Task 
< 
int 
> %
NR_Registrar_Notificacion 8
(8 9
int9 <
id_Not= C
,C D
ListE I
<I J
GuestsJ P
>P Q
ListGueR Y
,Y Z
int[ ^
id_Usu_ e
)e f
{ 	
foreach 
( 
Guests 
guests !
in" $
ListGue% ,
), -
{ 
var   
notification    
=  ! "
RegistarData  # /
(  / 0
id_Not  0 6
,  6 7
guests  8 >
,  > ?
id_Usu  @ F
)  F G
;  G H
await!! 
mNotificacion!! #
.!!# $%
BD_Registrar_Notificacion!!$ =
(!!= >
notification!!> J
)!!J K
;!!K L
}"" 
return$$ 
$num$$ 
;$$ 
}%% 	
private'' 
static'' 
List'' 
<'' 
Notificacion'' (
>''( )
EvaluarLista''* 6
(''6 7
	DataTable''7 @
eventos''A H
)''H I
{(( 	
List)) 
<)) 
Notificacion)) 
>)) 
list)) #
=))$ %
new))& )
())) *
)))* +
;))+ ,
try++ 
{,, 
if-- 
(-- 
eventos-- 
.-- 
Rows--  
.--  !
Count--! &
>--' (
$num--) *
)--* +
{.. 
foreach// 
(// 
DataRow// $
row//% (
in//) +
eventos//, 3
.//3 4
Rows//4 8
)//8 9
{00 
var11 
email11 !
=11" #
row11$ '
[11' (
$str11( /
]11/ 0
.110 1
ToString111 9
(119 :
)11: ;
;11; <
if22 
(22 
string22 "
.22" #
IsNullOrEmpty22# 0
(220 1
email221 6
)226 7
)227 8
break229 >
;22> ?
var44 
name44  
=44! "
row44# &
[44& '
$str44' -
]44- .
.44. /
ToString44/ 7
(447 8
)448 9
;449 :
if55 
(55 
string55 "
.55" #
IsNullOrEmpty55# 0
(550 1
name551 5
)555 6
)556 7
break558 =
;55= >
Notificacion77 $
not77% (
=77) *
new77+ .
(77. /
)77/ 0
{88 
Id_Not99 "
=99# $
Convert99% ,
.99, -
ToInt1699- 4
(994 5
row995 8
[998 9
$str999 B
]99B C
.99C D
ToString99D L
(99L M
)99M N
)99N O
,99O P
Email:: !
=::" #
email::$ )
,::) *
Id_Nota;; #
=;;$ %
Convert;;& -
.;;- .
ToInt16;;. 5
(;;5 6
row;;6 9
[;;9 :
$str;;: C
];;C D
.;;D E
ToString;;E M
(;;M N
);;N O
);;O P
,;;P Q
Id_Usu<< "
=<<# $
Convert<<% ,
.<<, -
ToInt16<<- 4
(<<4 5
row<<5 8
[<<8 9
$str<<9 A
]<<A B
.<<B C
ToString<<C K
(<<K L
)<<L M
)<<M N
,<<N O
Name==  
===! "
name==# '
}>> 
;>> 
list@@ 
.@@ 
Add@@  
(@@  !
not@@! $
)@@$ %
;@@% &
}AA 
returnCC 
listCC 
;CC  
}DD 
returnFF 
listFF 
;FF 
}GG 
catchHH 
(HH 
	ExceptionHH 
)HH 
{II 
returnJJ 
listJJ 
;JJ 
}KK 
}LL 	
privateNN 
staticNN  
NotificacionRegisterNN +
RegistarDataNN, 8
(NN8 9
intNN9 <
Id_NotNN= C
,NNC D
GuestsNNE K
ListGueNNL S
,NNS T
intNNU X
id_UsuNNY _
)NN_ `
{OO 	 
NotificacionRegisterPP  
notificationPP! -
=PP. /
newPP0 3
(PP3 4
)PP4 5
{QQ 
Id_NotaRR 
=RR 
Id_NotRR 
,RR  
Id_UsuSS 
=SS 
ListGueSS 
.SS  
idSS  "
,SS" #
Id_CreeTT 
=TT 
id_UsuTT 
}UU 
;UU 
returnWW 
notificationWW 
;WW  
}XX 	
}YY 
}ZZ ±"
PE:\visual\ricardo\Backend-C#\CalendarBackend\Capa_Negocio\services\SnrUsuario.cs
	namespace 	
Capa_Negocio
 
{ 
public 

class 

SnrUsuario 
: 

INrUsuario (
{ 
private		 
readonly		 

IBdUsuario		 #
mUsuario		$ ,
;		, -
public 

SnrUsuario 
( 

IBdUsuario $
mUsuario% -
)- .
{ 	
this 
. 
mUsuario 
= 
mUsuario $
;$ %
} 	
public 
async 
Task 
< 
Resp 
> 
NR_Buscar_CorreoS  1
(1 2
string2 8
email9 >
)> ?
{ 	
var 
resp 
= 
await 
mUsuario %
.% &
BD_Buscar_Correo& 6
(6 7
email7 <
)< =
;= >
if 
( 
resp 
) 
return 
new  
(  !
)! "
{# $
Ok% '
=( )
false* /
,/ 0
msg1 4
=5 6
$str7 U
}V W
;W X
return 
new 
Resp 
( 
) 
{ 
Ok  "
=# $
true% )
}* +
;+ ,
} 	
public 
async 
Task 
< 
Usuario !
>! "
NR_Login# +
(+ ,
string, 2
email3 8
)8 9
{ 	
	DataTable 
data 
= 
await "
mUsuario# +
.+ ,
DB_Login, 4
(4 5
email5 :
): ;
;; <
if 
( 
data 
. 
Rows 
. 
Count 
>  !
$num" #
)# $
{ 
var 
name 
= 
data 
.  
Rows  $
[$ %
$num% &
]& '
[' (
$str( .
]. /
./ 0
ToString0 8
(8 9
)9 :
;: ;
if   
(   
string   
.   
IsNullOrEmpty   (
(  ( )
name  ) -
)  - .
)  . /
return  0 6
new  7 :
(  : ;
)  ; <
;  < =
var"" 
password"" 
="" 
data"" #
.""# $
Rows""$ (
[""( )
$num"") *
]""* +
[""+ ,
$str"", 6
]""6 7
.""7 8
ToString""8 @
(""@ A
)""A B
;""B C
if## 
(## 
string## 
.## 
IsNullOrEmpty## (
(##( )
password##) 1
)##1 2
)##2 3
return##4 :
new##; >
(##> ?
)##? @
;##@ A
Usuario%% 
usuario%% 
=%%  !
new%%" %
(%%% &
)%%& '
{&& 
uid'' 
='' 
Convert'' !
.''! "
ToInt16''" )
('') *
data''* .
.''. /
Rows''/ 3
[''3 4
$num''4 5
]''5 6
[''6 7
$str''7 ?
]''? @
)''@ A
,''A B
Name(( 
=(( 
name(( 
,((  
Password)) 
=)) 
password)) '
,))' (
Email** 
=** 
email** !
}++ 
;++ 
return-- 
usuario-- 
;-- 
}.. 
return00 
new00 
(00 
)00 
;00 
}11 	
public33 
async33 
Task33 
<33 
int33 
>33  
NR_Registrar_Usuario33 3
(333 4
UsuarioRegister334 C
usuario33D K
)33K L
{44 	
return55 
await55 
mUsuario55 !
.55! " 
BD_Registrar_Usuario55" 6
(556 7
usuario557 >
)55> ?
;55? @
}66 	
}77 
}88 ı=
RE:\visual\ricardo\Backend-C#\CalendarBackend\Capa_Negocio\services\STokenCreate.cs
	namespace 	
Capa_Negocio
 
{ 
public 

class 
STokenCreate 
: 
ITokenCreate  ,
{ 
public 
ClaimsIdent 
GetUser "
(" #
IEnumerable# .
<. /
Claim/ 4
>4 5
identity6 >
)> ?
{ 	
if 
( 
identity 
!= 
null  
)  !
{ 
var 
id 
= 
identity !
.! "
Where" '
(' (
c( )
=>* ,
c- .
.. /
Type/ 3
==4 6

ClaimTypes7 A
.A B
NameIdentifierB P
)P Q
. 
Select 
( 
c 
=> 
c  !
.! "
Value" '
)' (
.( )
SingleOrDefault) 8
(8 9
)9 :
;: ;
var 
name 
= 
identity #
.# $
Where$ )
() *
c* +
=>, .
c/ 0
.0 1
Type1 5
==6 8

ClaimTypes9 C
.C D
SurnameD K
)K L
. 
Select 
( 
c 
=> 
c  
.  !
Value! &
)& '
.' (
SingleOrDefault( 7
(7 8
)8 9
;9 :
if 
( 
id 
is 
null 
) 
return %
new& )
ClaimsIdent* 5
(5 6
)6 7
;7 8
if 
( 
name 
is 
null  
)  !
return" (
new) ,
ClaimsIdent- 8
(8 9
)9 :
;: ;
ClaimsIdent 
user  
=! "
new# &
(& '
)' (
{ 

Id_Usuario   
=    
int  ! $
.  $ %
Parse  % *
(  * +
id  + -
)  - .
,  . /
Names!! 
=!! 
name!!  
}"" 
;"" 
return$$ 
user$$ 
;$$ 
}%% 
return'' 
new'' 
ClaimsIdent'' "
(''" #
)''# $
;''$ %
}(( 	
public** 
string** 
TokenCreate** !
(**! "
int**" %
id**& (
,**( )
string*** 0
nombre**1 7
)**7 8
{++ 	
try,, 
{-- 
if.. 
(.. 
string.. 
... 
IsNullOrEmpty.. (
(..( )
nombre..) /
)../ 0
)..0 1
return..2 8
$str..9 ;
;..; <
if// 
(// 
id// 
==// 
$num// 
)// 
return// "
$str//# %
;//% &
var11 
keyBytes11 
=11 
Encoding11 '
.11' (
UTF811( ,
.11, -
GetBytes11- 5
(115 6
$str116 ^
)11^ _
;11_ `
var22 
clains22 
=22 
new22  
ClaimsIdentity22! /
(22/ 0
)220 1
;221 2
clains44 
.44 
AddClaim44 
(44  
new44  #
Claim44$ )
(44) *

ClaimTypes44* 4
.444 5
NameIdentifier445 C
,44C D
id44E G
.44G H
ToString44H P
(44P Q
)44Q R
)44R S
)44S T
;44T U
clains55 
.55 
AddClaim55 
(55  
new55  #
Claim55$ )
(55) *

ClaimTypes55* 4
.554 5
Surname555 <
,55< =
nombre55> D
)55D E
)55E F
;55F G
var77 

tokenDescr77 
=77  
new77! $#
SecurityTokenDescriptor77% <
{88 
Subject99 
=99 
clains99 $
,99$ %
Expires:: 
=:: 
DateTime:: &
.::& '
UtcNow::' -
.::- .

AddMinutes::. 8
(::8 9
$num::9 <
)::< =
,::= >
SigningCredentials;; &
=;;' (
new;;) ,
SigningCredentials;;- ?
(;;? @
new;;@ C 
SymmetricSecurityKey;;D X
(;;X Y
keyBytes;;Y a
);;a b
,;;b c
SecurityAlgorithms<< &
.<<& '
HmacSha512Signature<<' :
)<<: ;
}== 
;== 
var?? 
tokenHan?? 
=?? 
new?? "#
JwtSecurityTokenHandler??# :
(??: ;
)??; <
;??< =
var@@ 
tokenC@@ 
=@@ 
tokenHan@@ %
.@@% &
CreateToken@@& 1
(@@1 2

tokenDescr@@2 <
)@@< =
;@@= >
stringAA 
tokenAA 
=AA 
tokenHanAA '
.AA' (

WriteTokenAA( 2
(AA2 3
tokenCAA3 9
)AA9 :
;AA: ;
returnBB 
tokenBB 
;BB 
}CC 
catchDD 
(DD 
	ExceptionDD 
)DD 
{EE 
returnFF 
$strFF 
;FF 
}GG 
}HH 	
publicJJ 
ClaimsIdentJJ 
ValidarTokenJJ '
(JJ' (
stringJJ( .
tokenJJ/ 4
,JJ4 5
IEnumerableJJ6 A
<JJA B
ClaimJJB G
>JJG H
identityJJI Q
)JJQ R
{KK 	
tryLL 
{MM 
varNN 
tokenHandlerNN  
=NN! "
newNN# &#
JwtSecurityTokenHandlerNN' >
(NN> ?
)NN? @
;NN@ A
varPP 
keyPP 
=PP 
EncodingPP "
.PP" #
UTF8PP# '
.PP' (
GetBytesPP( 0
(PP0 1
$strPP1 Y
)PPY Z
;PPZ [
tokenHandlerRR 
.RR 
ValidateTokenRR *
(RR* +
tokenRR+ 0
,RR0 1
newRR2 5%
TokenValidationParametersRR6 O
{SS $
ValidateIssuerSigningKeyTT ,
=TT- .
trueTT/ 3
,TT3 4
IssuerSigningKeyUU $
=UU% &
newUU' * 
SymmetricSecurityKeyUU+ ?
(UU? @
keyUU@ C
)UUC D
,UUD E
ValidateIssuerVV "
=VV# $
falseVV% *
,VV* +
ValidateAudienceWW $
=WW% &
falseWW' ,
,WW, -
	ClockSkewXX 
=XX 
TimeSpanXX  (
.XX( )
ZeroXX) -
}YY 
,YY 
outYY 
SecurityTokenYY $
validatedTokenYY% 3
)YY3 4
;YY4 5
ClaimsIdent[[ 
user[[  
=[[! "
GetUser[[# *
([[* +
identity[[+ 3
)[[3 4
;[[4 5
string]] 
newToken]] 
=]]  !
TokenCreate]]" -
(]]- .
user]]. 2
.]]2 3

Id_Usuario]]3 =
,]]= >
user]]? C
.]]C D
Names]]D I
)]]I J
;]]J K
user^^ 
.^^ 
Token^^ 
=^^ 
newToken^^ %
;^^% &
return`` 
user`` 
;`` 
}aa 
catchbb 
(bb 
	Exceptionbb 
)bb 
{cc 
returndd 
newdd 
ClaimsIdentdd &
(dd& '
)dd' (
;dd( )
}ee 
}ff 	
}gg 
}hh 