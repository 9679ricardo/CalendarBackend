–
SE:\visual\ricardo\Backend-C#\CalendarBackend\Capa_Negocio\interfaces\ICreateHash.cs
	namespace 	
Capa_Negocio
 
{ 
public 

	interface 
ICreateHash  
{ 
string 
PasswordDecrypt 
( 
string %
password& .
). /
;/ 0
string !
CreatePasswordEncrypt $
($ %
string% +
password, 4
)4 5
;5 6
} 
} ²
RE:\visual\ricardo\Backend-C#\CalendarBackend\Capa_Negocio\interfaces\INR_Evento.cs
	namespace 	
Capa_Negocio
 
{ 
public 

	interface 

INR_Evento 
{ 
Task 
< 
object 
> 
INR_Editar_Evento &
(& '
Evento' -
evento. 4
)4 5
;5 6
Task 
< 
object 
> 
INR_Eliminar_Evento (
(( )
int) ,
Id_Even- 4
,4 5
int6 9
uid: =
)= >
;> ?
Task		 
<		 
object		 
>		 '
INR_Eliminar_Evento_Usuario		 0
(		0 1
int		1 4
Id_Even		5 <
)		< =
;		= >
Task

 
<

 
object

 
>

 0
$INR_Eliminar_Evento_Usuario_Relacion

 9
(

9 :
int

: =
Id_Even

> E
,

E F
int

G J
Id_User

K R
)

R S
;

S T
Task 
< 
List 
< 

EventoPart 
> 
> +
INR_Mostar_Todos_Evento_Usuario >
(> ?
int? B
uidC F
)F G
;G H
Task 
< 
List 
< 
Guests 
> 
> ,
 INR_Mostar_Todos_Usuarios_Evento ;
(; <
int< ?
Id_Even@ G
)G H
;H I
Task 
< 
int 
>  
INR_Registrar_Evento &
(& '
Evento' -
evento. 4
)4 5
;5 6
Task 
< 
int 
> )
INR_Registrar_Evento_Relacion /
(/ 0
int0 3
Id_Even4 ;
,; <
int= @
uidA D
)D E
;E F
Evento 
RegisterData 
( 
ClaimsIdent '
identity( 0
,0 1
EventoRegister2 @
RequestA H
)H I
;I J
Evento 
RegisterData 
( 
Guests "
guests# )
,) *
EventoRegister+ 9
Request: A
,A B
ClaimsIdentC N
identO T
)T U
;U V
Evento 

UpdateData 
( 
ClaimsIdent %
identity& .
,. /
EventoUpdate0 <
Request= D
)D E
;E F
Task 
< 
Evento 
> 
INR_Buscar_Evento &
(& '
int' *
Id_Even+ 2
)2 3
;3 4
} 
} Ç

XE:\visual\ricardo\Backend-C#\CalendarBackend\Capa_Negocio\interfaces\INR_Notificacion.cs
	namespace 	
Capa_Negocio
 
{ 
public 

	interface 
INR_Notificacion %
{ 
Task 
< 
int 
> %
NR_Registrar_Notificacion +
(+ ,
int, /
id_Not0 6
,6 7
List8 <
<< =
Guests= C
>C D
ListGueE L
,L M
intN Q
id_UsuR X
)X Y
;Y Z
Task 
< 
bool 
> $
NR_Eliminar_Notificacion +
(+ ,
int, /
Id_Not0 6
,6 7
int8 ;
Id_Usu< B
)B C
;C D
Task		 
<		 
List		 
<		 
Notificacion		 
>		 
>		  1
%INR_Mostar_Todos_Notificacion_Usuario		! F
(		F G
int		G J
Id_Usu		K Q
)		Q R
;		R S 
NotificacionRegister

 
RegistarData

 )
(

) *
int

* -
Id_Not

. 4
,

4 5
Guests

6 <
ListGue

= D
,

D E
int

F I
id_Usu

J P
)

P Q
;

Q R
} 
} ¨
SE:\visual\ricardo\Backend-C#\CalendarBackend\Capa_Negocio\interfaces\INR_Usuario.cs
	namespace 	
Capa_Negocio
 
{ 
public 

	interface 
INR_Usuario  
{ 
Task 
< 
object 
> 
NR_Buscar_CorreoS &
(& '
string' -
email. 3
)3 4
;4 5
Task 
< 
int 
>  
NR_Registrar_Usuario &
(& '
UsuarioRegister' 6
usuario7 >
)> ?
;? @
Task		 
<		 
Usuario		 
>		 
NR_Login		 
(		 
string		 %
email		& +
)		+ ,
;		, -
}

 
} å
TE:\visual\ricardo\Backend-C#\CalendarBackend\Capa_Negocio\interfaces\ITokenCreate.cs
	namespace 	
Capa_Negocio
 
{ 
public 

	interface 
ITokenCreate !
{ 
ClaimsIdent 
GetUser 
( 
IEnumerable '
<' (
Claim( -
>- .
identity/ 7
)7 8
;8 9
string		 
TokenCreate		 
(		 
int		 
id		 !
,		! "
string		# )
nombre		* 0
)		0 1
;		1 2
ClaimsIdent

 
ValidarToken

  
(

  !
string

! '
token

( -
,

- .
IEnumerable

/ :
<

: ;
Claim

; @
>

@ A
identity

B J
)

J K
;

K L
} 
} ¨'
QE:\visual\ricardo\Backend-C#\CalendarBackend\Capa_Negocio\services\SCreateHash.cs
	namespace 	
Capa_Negocio
 
{ 
public 

class 
SCreateHash 
: 
ICreateHash *
{ 
public 
string !
CreatePasswordEncrypt +
(+ ,
string, 2
password3 ;
); <
{		 	
byte

 
[

 
]

 
iv

 
=

 
new

 
byte

  
[

  !
$num

! #
]

# $
;

$ %
byte 
[ 
] 
array 
; 
try 
{ 
using 
( 
Aes 
aes 
=  
Aes! $
.$ %
Create% +
(+ ,
), -
)- .
{ 
aes 
. 
Key 
= 
Encoding &
.& '
UTF8' +
.+ ,
GetBytes, 4
(4 5
$str5 O
)O P
;P Q
aes 
. 
IV 
= 
iv 
;  
ICryptoTransform $
	encryptor% .
=/ 0
aes1 4
.4 5
CreateEncryptor5 D
(D E
aesE H
.H I
KeyI L
,L M
aesN Q
.Q R
IVR T
)T U
;U V
using 
MemoryStream &
ms' )
=* +
new, /
(/ 0
)0 1
;1 2
using 
CryptoStream &
cryptoStream' 3
=4 5
new6 9
(9 :
ms: <
,< =
	encryptor> G
,G H
CryptoStreamModeI Y
.Y Z
WriteZ _
)_ `
;` a
using 
( 
StreamWriter '
streamWriter( 4
=5 6
new7 :
(: ;
cryptoStream; G
)G H
)H I
{ 
streamWriter $
.$ %
Write% *
(* +
password+ 3
)3 4
;4 5
} 
array 
= 
ms 
. 
ToArray &
(& '
)' (
;( )
} 
return   
Convert   
.   
ToBase64String   -
(  - .
array  . 3
)  3 4
;  4 5
}!! 
catch"" 
("" 
	Exception"" 
)"" 
{## 
return$$ 
$str$$ 
;$$ 
}%% 
}&& 	
public(( 
string(( 
PasswordDecrypt(( %
(((% &
string((& ,
password((- 5
)((5 6
{)) 	
byte** 
[** 
]** 
iv** 
=** 
new** 
byte**  
[**  !
$num**! #
]**# $
;**$ %
try,, 
{-- 
byte.. 
[.. 
].. 
buffer.. 
=.. 
Convert..  '
...' (
FromBase64String..( 8
(..8 9
password..9 A
)..A B
;..B C
using// 
Aes// 
aes// 
=// 
Aes//  #
.//# $
Create//$ *
(//* +
)//+ ,
;//, -
aes00 
.00 
Key00 
=00 
Encoding00 "
.00" #
UTF800# '
.00' (
GetBytes00( 0
(000 1
$str001 K
)00K L
;00L M
aes11 
.11 
IV11 
=11 
iv11 
;11 
ICryptoTransform33  
	decryptor33! *
=33+ ,
aes33- 0
.330 1
CreateDecryptor331 @
(33@ A
aes33A D
.33D E
Key33E H
,33H I
aes33J M
.33M N
IV33N P
)33P Q
;33Q R
using55 
MemoryStream55 "
ms55# %
=55& '
new55( +
(55+ ,
buffer55, 2
)552 3
;553 4
using66 
CryptoStream66 "
cryptoStream66# /
=660 1
new662 5
(665 6
ms666 8
,668 9
	decryptor66: C
,66C D
CryptoStreamMode66E U
.66U V
Read66V Z
)66Z [
;66[ \
using77 
StreamReader77 "
sr77# %
=77& '
new77( +
(77+ ,
cryptoStream77, 8
)778 9
;779 :
return99 
sr99 
.99 
	ReadToEnd99 #
(99# $
)99$ %
;99% &
}:: 
catch;; 
(;; 
	Exception;; 
);; 
{<< 
return== 
$str== 
;== 
}>> 
}?? 	
}@@ 
}AA ¿–
PE:\visual\ricardo\Backend-C#\CalendarBackend\Capa_Negocio\services\SNR_Evento.cs
	namespace 	
Capa_Negocio
 
{ 
public 

class 

SNR_Evento 
: 

INR_Evento (
{ 
private		 
readonly		 

IDB_Evento		 #
mEvento		$ +
;		+ ,
public 

SNR_Evento 
( 

IDB_Evento $
mEvento% ,
), -
{ 	
this 
. 
mEvento 
= 
mEvento "
;" #
} 	
public 
async 
Task 
< 
object  
>  !
INR_Editar_Evento" 3
(3 4
Evento4 :
evento; A
)A B
{ 	
var 
resp 
= 
await 
mEvento $
.$ %
BD_Editar_Evento% 5
(5 6
evento6 <
)< =
;= >
if 
( 
resp 
) 
return 
new  
{! "
ok# %
=& '
false( -
,- .
msg/ 2
=3 4
$str5 r
}s t
;t u
return 
null 
; 
} 	
public 
async 
Task 
< 
object  
>  !
INR_Eliminar_Evento" 5
(5 6
int6 9
Id_Even: A
,A B
intC F
uidG J
)J K
{ 	
var 
resp 
= 
await 
mEvento $
.$ %
BD_Eliminar_Evento% 7
(7 8
Id_Even8 ?
,? @
uidA D
)D E
;E F
if 
( 
resp 
) 
return 
new  
{! "
ok# %
=& '
false( -
,- .
msg/ 2
=3 4
$str5 r
}s t
;t u
return 
null 
; 
} 	
public 
async 
Task 
< 
List 
< 

EventoPart )
>) *
>* ++
INR_Mostar_Todos_Evento_Usuario, K
(K L
intL O
uidP S
)S T
{   	
	DataTable!! 
eventos!! 
=!! 
await!!  %
mEvento!!& -
.!!- .*
DB_Mostar_Todos_Evento_Usuario!!. L
(!!L M
uid!!M P
)!!P Q
;!!Q R
var## 
evaluar## 
=## 
await## 
EvaluarLista##  ,
(##, -
eventos##- 4
)##4 5
;##5 6
return%% 
evaluar%% 
;%% 
}&& 	
public'' 
async'' 
Task'' 
<'' 
List'' 
<'' 
Guests'' %
>''% &
>''& ',
 INR_Mostar_Todos_Usuarios_Evento''( H
(''H I
int''I L
Id_Even''M T
)''T U
{(( 	
	DataTable)) 
guests)) 
=)) 
await)) $
mEvento))% ,
.)), -+
DB_Mostar_Todos_Usuarios_Evento))- L
())L M
Id_Even))M T
)))T U
;))U V
var++ 
evaluar++ 
=++ 
EvaluarListaGuest++ +
(+++ ,
guests++, 2
)++2 3
;++3 4
return-- 
evaluar-- 
;-- 
}.. 	
public// 
async// 
Task// 
<// 
int// 
>//  
INR_Registrar_Evento// 3
(//3 4
Evento//4 :
evento//; A
)//A B
{00 	
return11 
await11 
mEvento11  
.11  !
BD_Registrar_Evento11! 4
(114 5
evento115 ;
)11; <
;11< =
}22 	
public44 
Evento44 
RegisterData44 "
(44" #
ClaimsIdent44# .
identity44/ 7
,447 8
EventoRegister449 G
Request44H O
)44O P
{55 	
Evento66 
evento66 
=66 
new66 
(66  
)66  !
{77 
Title88 
=88 
Request88 
.88  
Title88  %
,88% &
Notes99 
=99 
Request99 
.99  
Notes99  %
,99% &
Start:: 
=:: 
Request:: 
.::  
Start::  %
,::% &
End;; 
=;; 
Request;; 
.;; 
End;; !
,;;! "
User<< 
=<< 
identity<< 
.<<  
Names<<  %
,<<% &
UserUid== 
=== 
identity== "
.==" #

Id_Usuario==# -
,==- .
IdCre>> 
=>> 
identity>>  
.>>  !

Id_Usuario>>! +
}?? 
;?? 
returnAA 
eventoAA 
;AA 
}BB 	
publicDD 
EventoDD 

UpdateDataDD  
(DD  !
ClaimsIdentDD! ,
identityDD- 5
,DD5 6
EventoUpdateDD7 C
RequestDDD K
)DDK L
{EE 	
EventoFF 
eventoFF 
=FF 
newFF 
(FF  
)FF  !
{GG 
IdHH 
=HH 
RequestHH 
.HH 
IdHH 
,HH  
TitleII 
=II 
RequestII 
.II  
TitleII  %
,II% &
NotesJJ 
=JJ 
RequestJJ 
.JJ  
NotesJJ  %
,JJ% &
StartKK 
=KK 
RequestKK 
.KK  
StartKK  %
,KK% &
EndLL 
=LL 
RequestLL 
.LL 
EndLL !
,LL! "
UserMM 
=MM 
identityMM 
.MM  
NamesMM  %
,MM% &
UserUidNN 
=NN 
identityNN "
.NN" #

Id_UsuarioNN# -
}OO 
;OO 
returnQQ 
eventoQQ 
;QQ 
}RR 	
publicTT 
asyncTT 
TaskTT 
<TT 
EventoTT  
>TT  !
INR_Buscar_EventoTT" 3
(TT3 4
intTT4 7
Id_EvenTT8 ?
)TT? @
{UU 	
	DataTableVV 
dataVV 
=VV 
awaitVV "
mEventoVV# *
.VV* +
BD_Buscar_EventoVV+ ;
(VV; <
Id_EvenVV< C
)VVC D
;VVD E
EventoWW 
eventoWW 
=WW 
newWW 
(WW  
)WW  !
;WW! "
ifYY 
(YY 
dataYY 
.YY 
RowsYY 
.YY 
CountYY 
>YY  !
$numYY" #
)YY# $
{ZZ 
evento[[ 
.[[ 
Id[[ 
=[[ 
Convert[[ #
.[[# $
ToInt16[[$ +
([[+ ,
data[[, 0
.[[0 1
Rows[[1 5
[[[5 6
$num[[6 7
][[7 8
[[[8 9
$str[[9 A
][[A B
)[[B C
;[[C D
evento\\ 
.\\ 
UserUid\\ 
=\\  
Convert\\! (
.\\( )
ToInt16\\) 0
(\\0 1
data\\1 5
.\\5 6
Rows\\6 :
[\\: ;
$num\\; <
]\\< =
[\\= >
$str\\> F
]\\F G
)\\G H
;\\H I
evento]] 
.]] 
User]] 
=]] 
data]] "
.]]" #
Rows]]# '
[]]' (
$num]]( )
]]]) *
[]]* +
$str]]+ 4
]]]4 5
.]]5 6
ToString]]6 >
(]]> ?
)]]? @
;]]@ A
evento^^ 
.^^ 
Title^^ 
=^^ 
data^^ #
.^^# $
Rows^^$ (
[^^( )
$num^^) *
]^^* +
[^^+ ,
$str^^, 3
]^^3 4
.^^4 5
ToString^^5 =
(^^= >
)^^> ?
;^^? @
evento__ 
.__ 
Notes__ 
=__ 
data__ #
.__# $
Rows__$ (
[__( )
$num__) *
]__* +
[__+ ,
$str__, 3
]__3 4
.__4 5
ToString__5 =
(__= >
)__> ?
;__? @
evento`` 
.`` 
Start`` 
=`` 
data`` #
.``# $
Rows``$ (
[``( )
$num``) *
]``* +
[``+ ,
$str``, 8
]``8 9
.``9 :
ToString``: B
(``B C
)``C D
;``D E
eventoaa 
.aa 
Endaa 
=aa 
dataaa !
.aa! "
Rowsaa" &
[aa& '
$numaa' (
]aa( )
[aa) *
$straa* 4
]aa4 5
.aa5 6
ToStringaa6 >
(aa> ?
)aa? @
;aa@ A
eventobb 
.bb 
IdCrebb 
=bb 
Convertbb &
.bb& '
ToInt16bb' .
(bb. /
databb/ 3
.bb3 4
Rowsbb4 8
[bb8 9
$numbb9 :
]bb: ;
[bb; <
$strbb< D
]bbD E
)bbE F
;bbF G
returndd 
eventodd 
;dd 
}ee 
returngg 
eventogg 
;gg 
}hh 	
publicjj 
Eventojj 
RegisterDatajj "
(jj" #
Guestsjj# )
guestsjj* 0
,jj0 1
EventoRegisterjj2 @
RequestjjA H
,jjH I
ClaimsIdentjjJ U
identjjV [
)jj[ \
{kk 	
Eventoll 
eventoll 
=ll 
newll 
(ll  
)ll  !
{mm 
Titlenn 
=nn 
Requestnn 
.nn  
Titlenn  %
,nn% &
Notesoo 
=oo 
Requestoo 
.oo  
Notesoo  %
,oo% &
Startpp 
=pp 
Requestpp 
.pp  
Startpp  %
,pp% &
Endqq 
=qq 
Requestqq 
.qq 
Endqq !
,qq! "
Userrr 
=rr 
identrr 
.rr 
Namesrr "
,rr" #
UserUidss 
=ss 
guestsss  
.ss  !
idss! #
,ss# $
IdCrett 
=tt 
identtt 
.tt 

Id_Usuariott (
}uu 
;uu 
returnww 
eventoww 
;ww 
}xx 	
publiczz 
asynczz 
Taskzz 
<zz 
objectzz  
>zz  !'
INR_Eliminar_Evento_Usuariozz" =
(zz= >
intzz> A
Id_EvenzzB I
)zzI J
{{{ 	
var|| 
notUs|| 
=|| 
await|| 
mEvento|| %
.||% &&
BD_Eliminar_Evento_Usuario||& @
(||@ A
Id_Even||A H
)||H I
;||I J
if}} 
(}} 
notUs}} 
)}} 
return}} 
new}} !
{}}" #
ok}}$ &
=}}' (
false}}) .
,}}. /
msg}}0 3
=}}4 5
$str}}6 t
}}}u v
;}}v w
return 
null 
; 
}
€€ 	
public
‚‚ 
async
‚‚ 
Task
‚‚ 
<
‚‚ 
int
‚‚ 
>
‚‚ +
INR_Registrar_Evento_Relacion
‚‚ <
(
‚‚< =
int
‚‚= @
Id_Even
‚‚A H
,
‚‚H I
int
‚‚J M
uid
‚‚N Q
)
‚‚Q R
{
ƒƒ 	
return
„„ 
await
„„ 
mEvento
„„  
.
„„  !*
BD_Registrar_Evento_Relacion
„„! =
(
„„= >
Id_Even
„„> E
,
„„E F
uid
„„G J
)
„„J K
;
„„K L
}
…… 	
private
‡‡ 
async
‡‡ 
Task
‡‡ 
<
‡‡ 
List
‡‡ 
<
‡‡  

EventoPart
‡‡  *
>
‡‡* +
>
‡‡+ ,
EvaluarLista
‡‡- 9
(
‡‡9 :
	DataTable
‡‡: C
eventos
‡‡D K
)
‡‡K L
{
ˆˆ 	
List
‰‰ 
<
‰‰ 

EventoPart
‰‰ 
>
‰‰ 
list
‰‰ !
=
‰‰" #
new
‰‰$ '
(
‰‰' (
)
‰‰( )
;
‰‰) *
try
‹‹ 
{
ŒŒ 
if
 
(
 
eventos
 
.
 
Rows
  
.
  !
Count
! &
>
' (
$num
) *
)
* +
{
ŽŽ 
foreach
 
(
 
DataRow
 $
row
% (
in
) +
eventos
, 3
.
3 4
Rows
4 8
)
8 9
{
 

EventoPart
‘‘ "
env
‘‘# &
=
‘‘' (
new
‘‘) ,
(
‘‘, -
)
‘‘- .
{
’’ 
Id
““ 
=
““  
Convert
““! (
.
““( )
ToInt16
““) 0
(
““0 1
row
““1 4
[
““4 5
$str
““5 =
]
““= >
.
““> ?
ToString
““? G
(
““G H
)
““H I
)
““I J
,
““J K
UserUid
”” #
=
””$ %
Convert
””& -
.
””- .
ToInt16
””. 5
(
””5 6
row
””6 9
[
””9 :
$str
””: B
]
””B C
.
””C D
ToString
””D L
(
””L M
)
””M N
)
””N O
,
””O P
User
••  
=
••! "
row
••# &
[
••& '
$str
••' 0
]
••0 1
.
••1 2
ToString
••2 :
(
••: ;
)
••; <
,
••< =
Title
–– !
=
––" #
row
––$ '
[
––' (
$str
––( /
]
––/ 0
.
––0 1
ToString
––1 9
(
––9 :
)
––: ;
,
––; <
Notes
—— !
=
——" #
row
——$ '
[
——' (
$str
——( /
]
——/ 0
.
——0 1
ToString
——1 9
(
——9 :
)
——: ;
,
——; <
Start
˜˜ !
=
˜˜" #
row
˜˜$ '
[
˜˜' (
$str
˜˜( 4
]
˜˜4 5
.
˜˜5 6
ToString
˜˜6 >
(
˜˜> ?
)
˜˜? @
,
˜˜@ A
End
™™ 
=
™™  !
row
™™" %
[
™™% &
$str
™™& 0
]
™™0 1
.
™™1 2
ToString
™™2 :
(
™™: ;
)
™™; <
,
™™< =
IdCre
šš !
=
šš" #
Convert
šš$ +
.
šš+ ,
ToInt16
šš, 3
(
šš3 4
row
šš4 7
[
šš7 8
$str
šš8 @
]
šš@ A
.
ššA B
ToString
ššB J
(
ššJ K
)
ššK L
)
ššL M
}
›› 
;
›› 
var
 
resp
  
=
! "
await
# (.
 INR_Mostar_Todos_Usuarios_Evento
) I
(
I J
env
J M
.
M N
Id
N P
)
P Q
;
Q R
env
žž 
.
žž 

listGuests
žž &
=
žž' (
resp
žž) -
;
žž- .
list
   
.
   
Add
    
(
    !
env
  ! $
)
  $ %
;
  % &
}
¡¡ 
return
¢¢ 
list
¢¢ 
;
¢¢  
}
££ 
return
¥¥ 
list
¥¥ 
;
¥¥ 
}
¦¦ 
catch
§§ 
(
§§ 
	Exception
§§ 
)
§§ 
{
¨¨ 
return
©© 
list
©© 
;
©© 
}
ªª 
}
«« 	
private
­­ 
static
­­ 
List
­­ 
<
­­ 
Guests
­­ "
>
­­" #
EvaluarListaGuest
­­$ 5
(
­­5 6
	DataTable
­­6 ?
eventos
­­@ G
)
­­G H
{
®® 	
List
¯¯ 
<
¯¯ 
Guests
¯¯ 
>
¯¯ 
list
¯¯ 
=
¯¯ 
new
¯¯  #
(
¯¯# $
)
¯¯$ %
;
¯¯% &
try
±± 
{
²² 
if
³³ 
(
³³ 
eventos
³³ 
.
³³ 
Rows
³³  
.
³³  !
Count
³³! &
>
³³' (
$num
³³) *
)
³³* +
{
´´ 
foreach
µµ 
(
µµ 
DataRow
µµ $
row
µµ% (
in
µµ) +
eventos
µµ, 3
.
µµ3 4
Rows
µµ4 8
)
µµ8 9
{
¶¶ 
Guests
·· 
env
·· "
=
··# $
new
··% (
(
··( )
)
··) *
{
¸¸ 
id
¹¹ 
=
¹¹  
Convert
¹¹! (
.
¹¹( )
ToInt16
¹¹) 0
(
¹¹0 1
row
¹¹1 4
[
¹¹4 5
$str
¹¹5 =
]
¹¹= >
.
¹¹> ?
ToString
¹¹? G
(
¹¹G H
)
¹¹H I
)
¹¹I J
,
¹¹J K
Name
ºº  
=
ºº! "
row
ºº# &
[
ºº& '
$str
ºº' -
]
ºº- .
.
ºº. /
ToString
ºº/ 7
(
ºº7 8
)
ºº8 9
,
ºº9 :
Email
»» !
=
»»" #
row
»»$ '
[
»»' (
$str
»»( /
]
»»/ 0
.
»»0 1
ToString
»»1 9
(
»»9 :
)
»»: ;
,
»»; <
}
¼¼ 
;
¼¼ 
list
¾¾ 
.
¾¾ 
Add
¾¾  
(
¾¾  !
env
¾¾! $
)
¾¾$ %
;
¾¾% &
}
¿¿ 
return
ÀÀ 
list
ÀÀ 
;
ÀÀ  
}
ÁÁ 
return
ÃÃ 
list
ÃÃ 
;
ÃÃ 
}
ÄÄ 
catch
ÅÅ 
(
ÅÅ 
	Exception
ÅÅ 
)
ÅÅ 
{
ÆÆ 
return
ÇÇ 
list
ÇÇ 
;
ÇÇ 
}
ÈÈ 
}
ÉÉ 	
public
ËË 
async
ËË 
Task
ËË 
<
ËË 
object
ËË  
>
ËË  !2
$INR_Eliminar_Evento_Usuario_Relacion
ËË" F
(
ËËF G
int
ËËG J
Id_Even
ËËK R
,
ËËR S
int
ËËT W
Id_User
ËËX _
)
ËË_ `
{
ÌÌ 	
var
ÍÍ 
resp
ÍÍ 
=
ÍÍ 
await
ÍÍ 
mEvento
ÍÍ $
.
ÍÍ$ %)
BD_Eliminar_Evento_Relacion
ÍÍ% @
(
ÍÍ@ A
Id_Even
ÍÍA H
,
ÍÍH I
Id_User
ÍÍJ Q
)
ÍÍQ R
;
ÍÍR S
if
ÎÎ 
(
ÎÎ 
resp
ÎÎ 
)
ÎÎ 
return
ÎÎ 
new
ÎÎ  
{
ÎÎ! "
ok
ÎÎ# %
=
ÎÎ& '
false
ÎÎ( -
,
ÎÎ- .
msg
ÎÎ/ 2
=
ÎÎ3 4
$str
ÎÎ5 s
}
ÎÎt u
;
ÎÎu v
return
ÐÐ 
null
ÐÐ 
;
ÐÐ 
}
ÑÑ 	
}
ÒÒ 
}ÓÓ ê/
VE:\visual\ricardo\Backend-C#\CalendarBackend\Capa_Negocio\services\SNR_Notificacion.cs
	namespace 	
Capa_Negocio
 
{ 
public 

class 
SNR_Notificacion !
:" #
INR_Notificacion$ 4
{ 
private		 
readonly		 
IDB_Notificacion		 )
mNotificacion		* 7
;		7 8
public 
SNR_Notificacion 
(  
IDB_Notificacion  0
mNotificacion1 >
)> ?
{ 	
this 
. 
mNotificacion 
=  
mNotificacion! .
;. /
} 	
public 
async 
Task 
< 
List 
< 
Notificacion +
>+ ,
>, -1
%INR_Mostar_Todos_Notificacion_Usuario. S
(S T
intT W
Id_UsuX ^
)^ _
{ 	
var 
resp 
= 
await 
mNotificacion *
.* +0
$DB_Mostar_Todas_Notificacion_Usuario+ O
(O P
Id_UsuP V
)V W
;W X
return 
EvaluarLista 
(  
resp  $
)$ %
;% &
} 	
public 
async 
Task 
< 
bool 
> $
NR_Eliminar_Notificacion  8
(8 9
int9 <
Id_Not= C
,C D
intE H
Id_UsuI O
)O P
{ 	
return 
await 
mNotificacion &
.& '$
BD_Eliminar_Notificacion' ?
(? @
Id_Not@ F
,F G
Id_UsuH N
)N O
;O P
} 	
public 
async 
Task 
< 
int 
> %
NR_Registrar_Notificacion 8
(8 9
int9 <
id_Not= C
,C D
ListE I
<I J
GuestsJ P
>P Q
ListGueR Y
,Y Z
int[ ^
id_user_ f
)f g
{ 	
foreach 
( 
Guests 
guests !
in" $
ListGue% ,
), -
{ 
var   
notification    
=  ! "
RegistarData  # /
(  / 0
id_Not  0 6
,  6 7
guests  8 >
,  > ?
id_user  @ G
)  G H
;  H I
await!! 
mNotificacion!! #
.!!# $%
BD_Registrar_Notificacion!!$ =
(!!= >
notification!!> J
)!!J K
;!!K L
}"" 
return$$ 
$num$$ 
;$$ 
}%% 	
private'' 
static'' 
List'' 
<'' 
Notificacion'' (
>''( )
EvaluarLista''* 6
(''6 7
	DataTable''7 @
eventos''A H
)''H I
{(( 	
List)) 
<)) 
Notificacion)) 
>)) 
list)) #
=))$ %
new))& )
())) *
)))* +
;))+ ,
try++ 
{,, 
if-- 
(-- 
eventos-- 
.-- 
Rows--  
.--  !
Count--! &
>--' (
$num--) *
)--* +
{.. 
foreach// 
(// 
DataRow// $
row//% (
in//) +
eventos//, 3
.//3 4
Rows//4 8
)//8 9
{00 
Notificacion11 $
not11% (
=11) *
new11+ .
(11. /
)11/ 0
{22 
Id_Not33 "
=33# $
Convert33% ,
.33, -
ToInt1633- 4
(334 5
row335 8
[338 9
$str339 B
]33B C
.33C D
ToString33D L
(33L M
)33M N
)33N O
,33O P
Email44 !
=44" #
row44$ '
[44' (
$str44( /
]44/ 0
.440 1
ToString441 9
(449 :
)44: ;
,44; <
Id_Nota55 #
=55$ %
Convert55& -
.55- .
ToInt1655. 5
(555 6
row556 9
[559 :
$str55: C
]55C D
.55D E
ToString55E M
(55M N
)55N O
)55O P
,55P Q
Id_Usu66 "
=66# $
Convert66% ,
.66, -
ToInt1666- 4
(664 5
row665 8
[668 9
$str669 A
]66A B
.66B C
ToString66C K
(66K L
)66L M
)66M N
,66N O
Name77  
=77! "
row77# &
[77& '
$str77' -
]77- .
.77. /
ToString77/ 7
(777 8
)778 9
}88 
;88 
list:: 
.:: 
Add::  
(::  !
not::! $
)::$ %
;::% &
};; 
return== 
list== 
;==  
}>> 
return@@ 
list@@ 
;@@ 
}AA 
catchBB 
(BB 
	ExceptionBB 
)BB 
{CC 
returnDD 
listDD 
;DD 
}EE 
}FF 	
publicHH  
NotificacionRegisterHH #
RegistarDataHH$ 0
(HH0 1
intHH1 4
Id_NotHH5 ;
,HH; <
GuestsHH= C
guestHHD I
,HHI J
intHHK N
id_userHHO V
)HHV W
{II 	 
NotificacionRegisterJJ  
notificationJJ! -
=JJ. /
newJJ0 3
(JJ3 4
)JJ4 5
{KK 
Id_NotaLL 
=LL 
Id_NotLL 
,LL  
Id_UsuMM 
=MM 
guestMM 
.MM 
idMM  
,MM  !
Id_CreeNN 
=NN 
id_userNN  
}OO 
;OO 
returnQQ 
notificationQQ 
;QQ  
}RR 	
}SS 
}TT ¤
QE:\visual\ricardo\Backend-C#\CalendarBackend\Capa_Negocio\services\SNR_Usuario.cs
	namespace 	
Capa_Negocio
 
{ 
public 

class 
SNR_Usuario 
: 
INR_Usuario *
{ 
private		 
readonly		 
IBD_Usuario		 $
mUsuario		% -
;		- .
public 
SNR_Usuario 
( 
IBD_Usuario &
mUsuario' /
)/ 0
{ 	
this 
. 
mUsuario 
= 
mUsuario $
;$ %
} 	
public 
async 
Task 
< 
object  
>  !
NR_Buscar_CorreoS" 3
(3 4
string4 :
email; @
)@ A
{ 	
var 
resp 
= 
await 
mUsuario %
.% &
BD_Buscar_Correo& 6
(6 7
email7 <
)< =
;= >
if 
( 
resp 
) 
return 
new  
{! "
ok# %
=& '
false( -
,- .
msg/ 2
=3 4
$str5 S
}T U
;U V
return 
null 
; 
} 	
public 
async 
Task 
< 
Usuario !
>! "
NR_Login# +
(+ ,
string, 2
email3 8
)8 9
{ 	
	DataTable 
data 
= 
await "
mUsuario# +
.+ ,
DB_Login, 4
(4 5
email5 :
): ;
;; <
if 
( 
data 
. 
Rows 
. 
Count 
>  !
$num" #
)# $
{ 
Usuario 
usuario 
=  !
new" %
(% &
)& '
{   
uid!! 
=!! 
Convert!! !
.!!! "
ToInt16!!" )
(!!) *
data!!* .
.!!. /
Rows!!/ 3
[!!3 4
$num!!4 5
]!!5 6
[!!6 7
$str!!7 ?
]!!? @
)!!@ A
,!!A B
Name"" 
="" 
data"" 
.""  
Rows""  $
[""$ %
$num""% &
]""& '
[""' (
$str""( .
]"". /
.""/ 0
ToString""0 8
(""8 9
)""9 :
,"": ;
Password## 
=## 
data## #
.### $
Rows##$ (
[##( )
$num##) *
]##* +
[##+ ,
$str##, 6
]##6 7
.##7 8
ToString##8 @
(##@ A
)##A B
,##B C
Email$$ 
=$$ 
email$$ !
}%% 
;%% 
return'' 
usuario'' 
;'' 
}(( 
return** 
new** 
Usuario** 
(** 
)**  
;**  !
}++ 	
public-- 
async-- 
Task-- 
<-- 
int-- 
>--  
NR_Registrar_Usuario-- 3
(--3 4
UsuarioRegister--4 C
usuario--D K
)--K L
{.. 	
return// 
await// 
mUsuario// !
.//! " 
BD_Registrar_Usuario//" 6
(//6 7
usuario//7 >
)//> ?
;//? @
}00 	
}11 
}22 —5
RE:\visual\ricardo\Backend-C#\CalendarBackend\Capa_Negocio\services\STokenCreate.cs
	namespace 	
Capa_Negocio
 
{ 
public 

class 
STokenCreate 
: 
ITokenCreate  ,
{ 
public 
ClaimsIdent 
GetUser "
(" #
IEnumerable# .
<. /
Claim/ 4
>4 5
identity6 >
)> ?
{ 	
if 
( 
identity 
!= 
null  
)  !
{ 
string 
id 
= 
identity $
.$ %
FirstOrDefault% 3
(3 4
o4 5
=>6 8
o9 :
.: ;
Type; ?
==@ B

ClaimTypesC M
.M N
NameIdentifierN \
)\ ]
.] ^
Value^ c
;c d
string 
no 
= 
identity $
.$ %
FirstOrDefault% 3
(3 4
n4 5
=>6 8
n9 :
.: ;
Type; ?
==@ B

ClaimTypesC M
.M N
SurnameN U
)U V
.V W
ValueW \
;\ ]
ClaimsIdent 
user  
=! "
new# &
(& '
)' (
{ 

Id_Usuario 
=  
int! $
.$ %
Parse% *
(* +
id+ -
)- .
,. /
Names 
= 
no 
} 
; 
return 
user 
; 
} 
return 
new 
ClaimsIdent "
(" #
)# $
;$ %
}   	
public"" 
string"" 
TokenCreate"" !
(""! "
int""" %
id""& (
,""( )
string""* 0
nombre""1 7
)""7 8
{## 	
try$$ 
{%% 
var&& 
keyBytes&& 
=&& 
Encoding&& '
.&&' (
UTF8&&( ,
.&&, -
GetBytes&&- 5
(&&5 6
$str&&6 ^
)&&^ _
;&&_ `
var'' 
clains'' 
='' 
new''  
ClaimsIdentity''! /
(''/ 0
)''0 1
;''1 2
clains)) 
.)) 
AddClaim)) 
())  
new))  #
Claim))$ )
())) *

ClaimTypes))* 4
.))4 5
NameIdentifier))5 C
,))C D
id))E G
.))G H
ToString))H P
())P Q
)))Q R
)))R S
)))S T
;))T U
clains** 
.** 
AddClaim** 
(**  
new**  #
Claim**$ )
(**) *

ClaimTypes*** 4
.**4 5
Surname**5 <
,**< =
nombre**> D
)**D E
)**E F
;**F G
var,, 

tokenDescr,, 
=,,  
new,,! $#
SecurityTokenDescriptor,,% <
{-- 
Subject.. 
=.. 
clains.. $
,..$ %
Expires// 
=// 
DateTime// &
.//& '
UtcNow//' -
.//- .

AddMinutes//. 8
(//8 9
$num//9 <
)//< =
,//= >
SigningCredentials00 &
=00' (
new00) ,
SigningCredentials00- ?
(00? @
new00@ C 
SymmetricSecurityKey00D X
(00X Y
keyBytes00Y a
)00a b
,00b c
SecurityAlgorithms11 &
.11& '
HmacSha512Signature11' :
)11: ;
}22 
;22 
var44 
tokenHan44 
=44 
new44 "#
JwtSecurityTokenHandler44# :
(44: ;
)44; <
;44< =
var55 
tokenC55 
=55 
tokenHan55 %
.55% &
CreateToken55& 1
(551 2

tokenDescr552 <
)55< =
;55= >
string66 
token66 
=66 
tokenHan66 '
.66' (

WriteToken66( 2
(662 3
tokenC663 9
)669 :
;66: ;
return77 
token77 
;77 
}88 
catch99 
(99 
	Exception99 
)99 
{:: 
return;; 
$str;; 
;;; 
}<< 
}== 	
public?? 
ClaimsIdent?? 
ValidarToken?? '
(??' (
string??( .
token??/ 4
,??4 5
IEnumerable??6 A
<??A B
Claim??B G
>??G H
identity??I Q
)??Q R
{@@ 	
tryAA 
{BB 
varCC 
tokenHandlerCC  
=CC! "
newCC# &#
JwtSecurityTokenHandlerCC' >
(CC> ?
)CC? @
;CC@ A
varEE 
keyEE 
=EE 
EncodingEE "
.EE" #
UTF8EE# '
.EE' (
GetBytesEE( 0
(EE0 1
$strEE1 Y
)EEY Z
;EEZ [
tokenHandlerGG 
.GG 
ValidateTokenGG *
(GG* +
tokenGG+ 0
,GG0 1
newGG2 5%
TokenValidationParametersGG6 O
{HH $
ValidateIssuerSigningKeyII ,
=II- .
trueII/ 3
,II3 4
IssuerSigningKeyJJ $
=JJ% &
newJJ' * 
SymmetricSecurityKeyJJ+ ?
(JJ? @
keyJJ@ C
)JJC D
,JJD E
ValidateIssuerKK "
=KK# $
falseKK% *
,KK* +
ValidateAudienceLL $
=LL% &
falseLL' ,
,LL, -
	ClockSkewMM 
=MM 
TimeSpanMM  (
.MM( )
ZeroMM) -
}NN 
,NN 
outNN 
SecurityTokenNN $
validatedTokenNN% 3
)NN3 4
;NN4 5
ClaimsIdentPP 
userPP  
=PP! "
GetUserPP# *
(PP* +
identityPP+ 3
)PP3 4
;PP4 5
stringRR 
newTokenRR 
=RR  !
TokenCreateRR" -
(RR- .
userRR. 2
.RR2 3

Id_UsuarioRR3 =
,RR= >
userRR? C
.RRC D
NamesRRD I
)RRI J
;RRJ K
userSS 
.SS 
TokenSS 
=SS 
newTokenSS %
;SS% &
returnUU 
userUU 
;UU 
}VV 
catchWW 
(WW 
	ExceptionWW 
)WW 
{XX 
returnYY 
newYY 
ClaimsIdentYY &
(YY& '
)YY' (
;YY( )
}ZZ 
}[[ 	
}\\ 
}]] 