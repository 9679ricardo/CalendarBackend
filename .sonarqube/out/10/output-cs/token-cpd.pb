ıu
ZE:\visual\ricardo\Backend-C#\CalendarBackend\CalendarBackend\Controllers\AuthController.cs
	namespace 	
CalendarBackend
 
. 
Controllers %
{		 
[

 
Route

 

(


 
$str

 
)

 
]

 
[ 
ApiController 
] 
public 

class 
AuthController 
:  !

Controller" ,
{ 
readonly 
INR_Usuario 
mUsuario %
;% &
readonly 
ICreateHash 
mCreateHash (
;( )
readonly 
ITokenCreate 
mTokenCreate *
;* +
readonly 
IValidarUsuario  
	mVUsuario! *
;* +
public 
AuthController 
( 
INR_Usuario )
mUsuario* 2
,2 3
ICreateHash4 ?
mCreateHash@ K
,K L
ITokenCreateM Y
mTokenCreateZ f
,f g
IValidarUsuarioh w
	mVUsuario	x Å
)
Å Ç
{ 	
this 
. 
mUsuario 
= 
mUsuario $
;$ %
this 
. 
mCreateHash 
= 
mCreateHash *
;* +
this 
. 
mTokenCreate 
= 
mTokenCreate  ,
;, -
this 
. 
	mVUsuario 
= 
	mVUsuario &
;& '
} 	
[ 	
HttpPost	 
( 
$str 
) 
] 
public 
async 
Task 
< 
ActionResult &
<& '
UsuarioRegister' 6
>6 7
>7 8
Register9 A
(A B
UsuarioRegisterB Q
requestR Y
)Y Z
{ 	
try 
{ 
var!! 
validar!! 
=!! 
	mVUsuario!! '
.!!' (
ValidarUsuario!!( 6
(!!6 7
request!!7 >
)!!> ?
;!!? @
if"" 
("" 
validar"" 
!="" 
null"" #
)""# $
return""% +

StatusCode"", 6
(""6 7
$num""7 :
,"": ;
validar""< C
)""C D
;""D E
var%% 
	respuesta%% 
=%% 
await%%  %
mUsuario%%& .
.%%. /
NR_Buscar_CorreoS%%/ @
(%%@ A
request%%A H
.%%H I
Email%%I N
)%%N O
;%%O P
if&& 
(&& 
	respuesta&& 
!=&&  
null&&! %
)&&% &
return&&' -

StatusCode&&. 8
(&&8 9
$num&&9 <
,&&< =
	respuesta&&> G
)&&G H
;&&H I
string)) 
hsp)) 
=)) 
mCreateHash)) (
.))( )!
CreatePasswordEncrypt))) >
())> ?
request))? F
.))F G
Password))G O
)))O P
;))P Q
if** 
(** 
string** 
.** 
IsNullOrEmpty** (
(**( )
hsp**) ,
)**, -
)**- .
return**/ 5

StatusCode**6 @
(**@ A
$num**A D
,**D E
new**F I
{**J K
ok**L N
=**O P
false**Q V
,**V W
msg**X [
=**\ ]
$str	**^ õ
}
**ú ù
)
**ù û
;
**û ü
request-- 
.-- 
Password--  
=--! "
hsp--# &
;--& '
var.. 
uid.. 
=.. 
await.. 
mUsuario..  (
...( ) 
NR_Registrar_Usuario..) =
(..= >
request..> E
)..E F
;..F G
if// 
(// 
uid// 
<=// 
$num// 
)// 
return// $

StatusCode//% /
(/// 0
$num//0 3
,//3 4
new//5 8
{//9 :
ok//; =
=//> ?
false//@ E
,//E F
msg//G J
=//K L
$str	//M ä
}
//ã å
)
//å ç
;
//ç é
var22 
token22 
=22 
mTokenCreate22 (
.22( )
TokenCreate22) 4
(224 5
uid225 8
,228 9
request22: A
.22A B
Name22B F
)22F G
;22G H
if33 
(33 
string33 
.33 
IsNullOrEmpty33 (
(33( )
token33) .
)33. /
)33/ 0
return331 7

StatusCode338 B
(33B C
$num33C F
,33F G
new33H K
{33L M
ok33N P
=33Q R
false33S X
,33X Y
msg33Z ]
=33^ _
$str	33` û
}
33ü †
)
33† °
;
33° ¢
return55 

StatusCode55 !
(55! "
$num55" %
,55% &
new55' *
{55+ ,
ok55- /
=550 1
true552 6
,556 7
uid558 ;
,55; <
name55= A
=55B C
request55D K
.55K L
Name55L P
,55P Q
token55R W
,55W X
request55Y `
.55` a
Email55a f
}55g h
)55h i
;55i j
}66 
catch77 
(77 
	Exception77 
)77 
{88 
return99 

StatusCode99 !
(99! "
$num99" %
,99% &
new99' *
{99+ ,
ok99- /
=990 1
false992 7
,997 8
msg999 <
=99= >
$str99? |
}99} ~
)99~ 
;	99 Ä
}:: 
};; 	
[== 	
HttpPost==	 
(== 
$str== 
)== 
]== 
public>> 
async>> 
Task>> 
<>> 
ActionResult>> &
<>>& '
UsuarioLogin>>' 3
>>>3 4
>>>4 5
Login>>6 ;
(>>; <
UsuarioLogin>>< H
request>>I P
)>>P Q
{?? 	
try@@ 
{AA 
varCC 
validarCC 
=CC 
	mVUsuarioCC '
.CC' (
ValidarLoginCC( 4
(CC4 5
requestCC5 <
)CC< =
;CC= >
ifDD 
(DD 
validarDD 
!=DD 
nullDD #
)DD# $
returnDD% +

StatusCodeDD, 6
(DD6 7
$numDD7 :
,DD: ;
validarDD< C
)DDC D
;DDD E
varGG 
loginGG 
=GG 
awaitGG !
mUsuarioGG" *
.GG* +
NR_LoginGG+ 3
(GG3 4
requestGG4 ;
.GG; <
EmailGG< A
)GGA B
;GGB C
ifHH 
(HH 
loginHH 
==HH 
nullHH !
)HH! "
returnHH# )

StatusCodeHH* 4
(HH4 5
$numHH5 8
,HH8 9
newHH: =
{HH> ?
okHH@ B
=HHC D
falseHHE J
,HHJ K
msgHHL O
=HHP Q
$strHHR l
}HHm n
)HHn o
;HHo p
ifII 
(II 
loginII 
.II 
PasswordII "
==II# %
nullII& *
)II* +
returnII, 2

StatusCodeII3 =
(II= >
$numII> A
,IIA B
newIIC F
{IIG H
okIII K
=IIL M
falseIIN S
,IIS T
msgIIU X
=IIY Z
$strII[ u
}IIv w
)IIw x
;IIx y
stringLL 
hspLL 
=LL 
mCreateHashLL (
.LL( )
PasswordDecryptLL) 8
(LL8 9
loginLL9 >
.LL> ?
PasswordLL? G
)LLG H
;LLH I
ifMM 
(MM 
!MM 
hspMM 
.MM 
EqualsMM 
(MM  
requestMM  '
.MM' (
PasswordMM( 0
)MM0 1
)MM1 2
returnMM3 9

StatusCodeMM: D
(MMD E
$numMME H
,MMH I
newMMJ M
{MMN O
okMMP R
=MMS T
falseMMU Z
,MMZ [
msgMM\ _
=MM` a
$strMMb |
}MM} ~
)MM~ 
;	MM Ä
varPP 
tokenPP 
=PP 
mTokenCreatePP (
.PP( )
TokenCreatePP) 4
(PP4 5
loginPP5 :
.PP: ;
uidPP; >
,PP> ?
loginPP@ E
.PPE F
NamePPF J
)PPJ K
;PPK L
ifQQ 
(QQ 
stringQQ 
.QQ 
IsNullOrEmptyQQ (
(QQ( )
tokenQQ) .
)QQ. /
)QQ/ 0
returnQQ1 7

StatusCodeQQ8 B
(QQB C
$numQQC F
,QQF G
newQQH K
{QQL M
okQQN P
=QQQ R
falseQQS X
,QQX Y
msgQQZ ]
=QQ^ _
$str	QQ` û
}
QQü †
)
QQ† °
;
QQ° ¢
returnSS 

StatusCodeSS !
(SS! "
$numSS" %
,SS% &
newSS' *
{SS+ ,
okSS- /
=SS0 1
trueSS2 6
,SS6 7
loginSS8 =
.SS= >
uidSS> A
,SSA B
nameSSC G
=SSH I
loginSSJ O
.SSO P
NameSSP T
,SST U
tokenSSV [
,SS[ \
requestSS] d
.SSd e
EmailSSe j
}SSk l
)SSl m
;SSm n
}TT 
catchUU 
{VV 
returnWW 

StatusCodeWW !
(WW! "
$numWW" %
,WW% &
newWW' *
{WW+ ,
okWW- /
=WW0 1
falseWW2 7
,WW7 8
msgWW9 <
=WW= >
$strWW? |
}WW} ~
)WW~ 
;	WW Ä
}XX 
}ZZ 	
[\\ 	
	Authorize\\	 
]\\ 
[]] 	
HttpPost]]	 
(]] 
$str]] 
)]]  
]]]  !
public^^ 
ActionResult^^ 
<^^ 
string^^ "
>^^" #
Renew^^$ )
(^^) *
string^^* 0
token^^1 6
)^^6 7
{__ 	
try`` 
{aa 
ClaimsIdentitybb 
identitybb '
=bb( )
HttpContextbb* 5
.bb5 6
Userbb6 :
.bb: ;
Identitybb; C
asbbD F
ClaimsIdentitybbG U
;bbU V
ClaimsIdentdd 
renewdd !
=dd" #
mTokenCreatedd$ 0
.dd0 1
ValidarTokendd1 =
(dd= >
tokendd> C
,ddC D
identityddE M
.ddM N
ClaimsddN T
)ddT U
;ddU V
ifee 
(ee 
renewee 
==ee 
nullee !
)ee! "
returnee# )

StatusCodeee* 4
(ee4 5
$numee5 8
,ee8 9
newee: =
{ee> ?
okee@ B
=eeC D
falseeeE J
,eeJ K
msgeeL O
=eeP Q
$streeR c
}eed e
)eee f
;eef g
ifff 
(ff 
stringff 
.ff 
IsNullOrEmptyff (
(ff( )
renewff) .
.ff. /
Tokenff/ 4
)ff4 5
)ff5 6
returnff7 =

StatusCodeff> H
(ffH I
$numffI L
,ffL M
newffN Q
{ffR S
okffT V
=ffW X
falseffY ^
,ff^ _
msgff` c
=ffd e
$strfff w
}ffx y
)ffy z
;ffz {
returnhh 

StatusCodehh !
(hh! "
$numhh" %
,hh% &
newhh' *
{hh+ ,
okhh- /
=hh0 1
truehh2 6
,hh6 7
uidhh8 ;
=hh< =
renewhh> C
.hhC D

Id_UsuariohhD N
,hhN O
namehhP T
=hhU V
renewhhW \
.hh\ ]
Nameshh] b
,hhb c
tokenhhd i
=hhj k
renewhhl q
.hhq r
Tokenhhr w
}hhx y
)hhy z
;hhz {
}ii 
catchjj 
{kk 
returnll 

StatusCodell !
(ll! "
$numll" %
,ll% &
newll' *
{ll+ ,
okll- /
=ll0 1
falsell2 7
,ll7 8
msgll9 <
=ll= >
$strll? P
}llQ R
)llR S
;llS T
}mm 
}nn 	
[pp 	
	Authorizepp	 
]pp 
[qq 	
HttpPostqq	 
(qq 
$strqq 
)qq 
]qq 
publicrr 
asyncrr 
Taskrr 
<rr 
ActionResultrr &
<rr& '
Eventorr' -
>rr- .
>rr. /
GetAsUsuariorr0 <
(rr< =
stringrr= C
emailrrD I
)rrI J
{ss 	
trytt 
{uu 
varvv 
loginvv 
=vv 
awaitvv !
mUsuariovv" *
.vv* +
NR_Loginvv+ 3
(vv3 4
emailvv4 9
)vv9 :
;vv: ;
ifww 
(ww 
loginww 
==ww 
nullww !
)ww! "
returnww# )

StatusCodeww* 4
(ww4 5
$numww5 8
,ww8 9
newww: =
{ww> ?
okww@ B
=wwC D
falsewwE J
,wwJ K
msgwwL O
=wwP Q
$strwwR x
}wwy z
)wwz {
;ww{ |
ifxx 
(xx 
stringxx 
.xx 
IsNullOrEmptyxx (
(xx( )
loginxx) .
.xx. /
Emailxx/ 4
)xx4 5
)xx5 6
returnxx7 =

StatusCodexx> H
(xxH I
$numxxI L
,xxL M
newxxN Q
{xxR S
okxxT V
=xxW X
falsexxY ^
,xx^ _
msgxx` c
=xxd e
$str	xxf å
}
xxç é
)
xxé è
;
xxè ê
returnzz 

StatusCodezz !
(zz! "
$numzz" %
,zz% &
newzz' *
{zz+ ,
okzz- /
=zz0 1
truezz2 6
,zz6 7
loginzz8 =
.zz= >
Emailzz> C
,zzC D
idzzE G
=zzH I
loginzzJ O
.zzO P
uidzzP S
,zzS T
loginzzU Z
.zzZ [
Namezz[ _
}zz` a
)zza b
;zzb c
}|| 
catch}} 
(}} 
	Exception}} 
)}} 
{~~ 
return 

StatusCode !
(! "
$num" %
,% &
new' *
{+ ,
ok- /
=0 1
false2 7
,7 8
msg9 <
== >
$str? |
}} ~
)~ 
;	 Ä
}
ÄÄ 
}
ÅÅ 	
}
ÉÉ 
}ÑÑ íœ
\E:\visual\ricardo\Backend-C#\CalendarBackend\CalendarBackend\Controllers\EventoController.cs
	namespace 	
CalendarBackend
 
. 
Controllers %
{		 
[

 
	Authorize

 
]

 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
EventoController !
:" #

Controller$ .
{ 
private 
readonly 
IValidarEvento '
mVEvento( 0
;0 1
private 
readonly 

INR_Evento #
mEvento$ +
;+ ,
readonly 
ITokenCreate 
mTokenCreate *
;* +
public 
EventoController 
(  
IValidarEvento  .
mVEvento/ 7
,7 8

INR_Evento9 C
mEventoD K
,K L
ITokenCreateM Y
mTokenCreateZ f
)f g
{ 	
this 
. 
mVEvento 
= 
mVEvento $
;$ %
this 
. 
mEvento 
= 
mEvento "
;" #
this 
. 
mTokenCreate 
= 
mTokenCreate  ,
;, -
} 	
[ 	
HttpGet	 
( 
$str 
) 
] 
public 
async 
Task 
< 
ActionResult &
<& '

EventoPart' 1
>1 2
>2 3 
GetAllEventosUsuario4 H
(H I
)I J
{ 	
try 
{ 
if 
( 
HttpContext 
.  
User  $
.$ %
Identity% -
is. 0
not1 4
ClaimsIdentity5 C
identityD L
)L M
returnN T

StatusCodeU _
(_ `
$num` c
,c d
newe h
{i j
okk m
=n o
falsep u
,u v
msgw z
={ |
$str	} ∫
}
ª º
)
º Ω
;
Ω æ
ClaimsIdent   
user    
=  ! "
mTokenCreate  # /
.  / 0
GetUser  0 7
(  7 8
identity  8 @
.  @ A
Claims  A G
)  G H
;  H I
if!! 
(!! 
user!! 
.!! 

Id_Usuario!! #
<=!!$ &
$num!!' (
)!!( )

StatusCode!!* 4
(!!4 5
$num!!5 8
,!!8 9
new!!: =
{!!> ?
ok!!@ B
=!!C D
false!!E J
,!!J K
msg!!L O
=!!P Q
$str	!!R è
}
!!ê ë
)
!!ë í
;
!!í ì
var$$ 
list$$ 
=$$ 
await$$  
mEvento$$! (
.$$( )+
INR_Mostar_Todos_Evento_Usuario$$) H
($$H I
user$$I M
.$$M N

Id_Usuario$$N X
)$$X Y
;$$Y Z
return%% 

StatusCode%% !
(%%! "
$num%%" %
,%%% &
new%%' *
{%%+ ,
ok%%- /
=%%0 1
true%%2 6
,%%6 7
eventos%%8 ?
=%%@ A
list%%B F
}%%G H
)%%H I
;%%I J
}'' 
catch(( 
((( 
	Exception(( 
)(( 
{)) 
return** 

StatusCode** !
(**! "
$num**" %
,**% &
new**' *
{**+ ,
ok**- /
=**0 1
false**2 7
,**7 8
msg**9 <
=**= >
$str**? |
}**} ~
)**~ 
;	** Ä
}++ 
},, 	
[.. 	
HttpPost..	 
(.. 
$str.. 
).. 
].. 
public// 
async// 
Task// 
<// 
ActionResult// &
<//& '
EventoRegister//' 5
>//5 6
>//6 7
Create//8 >
(//> ?
[//? @
FromBody//@ H
]//H I
EventoRegister//J X
Request//Y `
)//` a
{00 	
try11 
{22 
if44 
(44 
HttpContext44 
.44  
User44  $
.44$ %
Identity44% -
is44. 0
not441 4
ClaimsIdentity445 C
identity44D L
)44L M
return44N T

StatusCode44U _
(44_ `
$num44` c
,44c d
new44e h
{44i j
ok44k m
=44n o
false44p u
,44u v
msg44w z
=44{ |
$str	44} ∫
}
44ª º
)
44º Ω
;
44Ω æ
ClaimsIdent55 
user55  
=55! "
mTokenCreate55# /
.55/ 0
GetUser550 7
(557 8
identity558 @
.55@ A
Claims55A G
)55G H
;55H I
if66 
(66 
user66 
.66 

Id_Usuario66 #
<=66$ &
$num66' (
)66( )
return66* 0

StatusCode661 ;
(66; <
$num66< ?
,66? @
new66A D
{66E F
ok66G I
=66J K
false66L Q
,66Q R
msg66S V
=66W X
$str	66Y ñ
}
66ó ò
)
66ò ô
;
66ô ö
var88 
even88 
=88 
mEvento88 "
.88" #
RegisterData88# /
(88/ 0
user880 4
,884 5
Request886 =
)88= >
;88> ?
var;; 
validar;; 
=;; 
mVEvento;; &
.;;& '
ValidarEvento;;' 4
(;;4 5
even;;5 9
);;9 :
;;;: ;
if<< 
(<< 
validar<< 
!=<< 
null<< #
)<<# $
return<<% +

StatusCode<<, 6
(<<6 7
$num<<7 :
,<<: ;
validar<<< C
)<<C D
;<<D E
int?? 
lastlast_insert?? #
=??$ %
await??& +
mEvento??, 3
.??3 4 
INR_Registrar_Evento??4 H
(??H I
even??I M
)??M N
;??N O
if@@ 
(@@ 
lastlast_insert@@ #
<=@@$ &
$num@@' (
)@@( )
return@@* 0

StatusCode@@1 ;
(@@; <
$num@@< ?
,@@? @
new@@A D
{@@E F
ok@@G I
=@@J K
false@@L Q
,@@Q R
msg@@S V
=@@W X
$str	@@Y ñ
}
@@ó ò
)
@@ò ô
;
@@ô ö
evenAA 
.AA 
IdAA 
=AA 
lastlast_insertAA )
;AA) *
intEE 
relacEE 
=EE 
awaitEE !
mEventoEE" )
.EE) *)
INR_Registrar_Evento_RelacionEE* G
(EEG H
lastlast_insertEEH W
,EEW X
userEEY ]
.EE] ^

Id_UsuarioEE^ h
)EEh i
;EEi j
ifFF 
(FF 
relacFF 
<=FF 
$numFF 
)FF 
returnFF  &

StatusCodeFF' 1
(FF1 2
$numFF2 5
,FF5 6
newFF7 :
{FF; <
okFF= ?
=FF@ A
falseFFB G
,FFG H
msgFFI L
=FFM N
$str	FFO é
}
FFè ê
)
FFê ë
;
FFë í
returnHH 

StatusCodeHH !
(HH! "
$numHH" %
,HH% &
newHH' *
{HH+ ,
okHH- /
=HH0 1
trueHH2 6
,HH6 7
eventoHH8 >
=HH? @
evenHHA E
}HHF G
)HHG H
;HHH I
}II 
catchJJ 
(JJ 
	ExceptionJJ 
)JJ 
{KK 
returnLL 

StatusCodeLL !
(LL! "
$numLL" %
,LL% &
newLL' *
{LL+ ,
okLL- /
=LL0 1
falseLL2 7
,LL7 8
msgLL9 <
=LL= >
$strLL? |
}LL} ~
)LL~ 
;	LL Ä
}MM 
}NN 	
[PP 	
HttpPutPP	 
(PP 
$strPP 
)PP 
]PP 
publicQQ 
asyncQQ 
TaskQQ 
<QQ 
ActionResultQQ &
<QQ& '
EventoUpdateQQ' 3
>QQ3 4
>QQ4 5
UpdateQQ6 <
(QQ< =
[QQ= >
FromBodyQQ> F
]QQF G
EventoUpdateQQH T
RequestQQU \
)QQ\ ]
{RR 	
trySS 
{TT 
ifVV 
(VV 
HttpContextVV 
.VV  
UserVV  $
.VV$ %
IdentityVV% -
isVV. 0
notVV1 4
ClaimsIdentityVV5 C
identityVVD L
)VVL M
returnVVN T

StatusCodeVVU _
(VV_ `
$numVV` c
,VVc d
newVVe h
{VVi j
okVVk m
=VVn o
falseVVp u
,VVu v
msgVVw z
=VV{ |
$str	VV} ∫
}
VVª º
)
VVº Ω
;
VVΩ æ
ClaimsIdentWW 
userWW  
=WW! "
mTokenCreateWW# /
.WW/ 0
GetUserWW0 7
(WW7 8
identityWW8 @
.WW@ A
ClaimsWWA G
)WWG H
;WWH I
ifXX 
(XX 
userXX 
.XX 

Id_UsuarioXX #
<=XX$ &
$numXX' (
)XX( )
returnXX* 0

StatusCodeXX1 ;
(XX; <
$numXX< ?
,XX? @
newXXA D
{XXE F
okXXG I
=XXJ K
falseXXL Q
,XXQ R
msgXXS V
=XXW X
$str	XXY ñ
}
XXó ò
)
XXò ô
;
XXô ö
varZZ 
envZZ 
=ZZ 
mEventoZZ !
.ZZ! "

UpdateDataZZ" ,
(ZZ, -
userZZ- 1
,ZZ1 2
RequestZZ3 :
)ZZ: ;
;ZZ; <
var]] 
validar]] 
=]] 
mVEvento]] &
.]]& '
ValidarEvento]]' 4
(]]4 5
env]]5 8
)]]8 9
;]]9 :
if^^ 
(^^ 
validar^^ 
!=^^ 
null^^ #
)^^# $
return^^% +

StatusCode^^, 6
(^^6 7
$num^^7 :
,^^: ;
validar^^< C
)^^C D
;^^D E
var__ 
val__ 
=__ 
mVEvento__ "
.__" #
ValidarEventoId__# 2
(__2 3
Request__3 :
.__: ;
Id__; =
)__= >
;__> ?
if`` 
(`` 
val`` 
!=`` 
null`` 
)``  
return``! '

StatusCode``( 2
(``2 3
$num``3 6
,``6 7
val``8 ;
)``; <
;``< =
Eventocc 

DbProductocc !
=cc" #
awaitcc$ )
mEventocc* 1
.cc1 2
INR_Buscar_Eventocc2 C
(ccC D
RequestccD K
.ccK L
IdccL N
)ccN O
;ccO P
ifdd 
(dd 

DbProductodd 
==dd !
nulldd" &
)dd& '
returndd( .

StatusCodedd/ 9
(dd9 :
$numdd: =
,dd= >
newdd? B
{ddC D
okddE G
=ddH I
falseddJ O
,ddO P
RequestddQ X
.ddX Y
IdddY [
,dd[ \
msgdd] `
=dda b
$str	ddc Ç
}
ddÉ Ñ
)
ddÑ Ö
;
ddÖ Ü
ifee 
(ee 

DbProductoee 
.ee 
Idee !
<=ee" $
$numee% &
)ee& '
returnee( .

StatusCodeee/ 9
(ee9 :
$numee: =
,ee= >
newee? B
{eeC D
okeeE G
=eeH I
falseeeJ O
,eeO P
RequesteeQ X
.eeX Y
IdeeY [
,ee[ \
msgee] `
=eea b
$str	eec Ç
}
eeÉ Ñ
)
eeÑ Ö
;
eeÖ Ü
ifhh 
(hh 

DbProductohh 
.hh 
UserUidhh &
!=hh' )
userhh* .
.hh. /

Id_Usuariohh/ 9
)hh9 :
returnhh; A

StatusCodehhB L
(hhL M
$numhhM P
,hhP Q
newhhR U
{hhV W
okhhX Z
=hh[ \
falsehh] b
,hhb c
Requesthhd k
.hhk l
Idhhl n
,hhn o
msghhp s
=hht u
$str	hhv °
}
hh¢ £
)
hh£ §
;
hh§ •
ifii 
(ii 

DbProductoii 
.ii 
IdCreii #
!=ii$ &
userii' +
.ii+ ,

Id_Usuarioii, 6
)ii6 7
returnii8 >

StatusCodeii? I
(iiI J
$numiiJ M
,iiM N
newiiO R
{iiS T
okiiU W
=iiX Y
falseiiZ _
,ii_ `
Requestiia h
.iih i
Idiii k
,iik l
msgiim p
=iiq r
$str	iis û
}
iiü †
)
ii† °
;
ii° ¢
envkk 
.kk 
UserUidkk 
=kk 
userkk "
.kk" #

Id_Usuariokk# -
;kk- .
envll 
.ll 
Userll 
=ll 
userll 
.ll  
Namesll  %
;ll% &
varoo 
upoo 
=oo 
awaitoo 
mEventooo &
.oo& '
INR_Editar_Eventooo' 8
(oo8 9
envoo9 <
)oo< =
;oo= >
ifpp 
(pp 
uppp 
!=pp 
nullpp 
)pp 
returnpp  &

StatusCodepp' 1
(pp1 2
$numpp2 5
,pp5 6
uppp7 9
)pp9 :
;pp: ;
returnrr 

StatusCoderr !
(rr! "
$numrr" %
,rr% &
newrr' *
{rr+ ,
okrr- /
=rr0 1
truerr2 6
,rr6 7
eventorr8 >
=rr? @
envrrA D
}rrE F
)rrF G
;rrG H
}ss 
catchtt 
(tt 
	Exceptiontt 
)tt 
{uu 
returnvv 

StatusCodevv !
(vv! "
$numvv" %
,vv% &
newvv' *
{vv+ ,
okvv- /
=vv0 1
falsevv2 7
,vv7 8
msgvv9 <
=vv= >
$strvv? |
}vv} ~
)vv~ 
;	vv Ä
}ww 
}xx 	
[zz 	

HttpDeletezz	 
(zz 
$strzz 
)zz 
]zz 
public{{ 
async{{ 
Task{{ 
<{{ 
ActionResult{{ &
<{{& '
Evento{{' -
>{{- .
>{{. /
Delete{{0 6
({{6 7
int{{7 :
Id{{; =
){{= >
{|| 	
try}} 
{~~ 
if
ÄÄ 
(
ÄÄ 
HttpContext
ÄÄ 
.
ÄÄ  
User
ÄÄ  $
.
ÄÄ$ %
Identity
ÄÄ% -
is
ÄÄ. 0
not
ÄÄ1 4
ClaimsIdentity
ÄÄ5 C
identity
ÄÄD L
)
ÄÄL M
return
ÄÄN T

StatusCode
ÄÄU _
(
ÄÄ_ `
$num
ÄÄ` c
,
ÄÄc d
new
ÄÄe h
{
ÄÄi j
ok
ÄÄk m
=
ÄÄn o
false
ÄÄp u
,
ÄÄu v
msg
ÄÄw z
=
ÄÄ{ |
$strÄÄ} ∫
}ÄÄª º
)ÄÄº Ω
;ÄÄΩ æ
ClaimsIdent
ÅÅ 
user
ÅÅ  
=
ÅÅ! "
mTokenCreate
ÅÅ# /
.
ÅÅ/ 0
GetUser
ÅÅ0 7
(
ÅÅ7 8
identity
ÅÅ8 @
.
ÅÅ@ A
Claims
ÅÅA G
)
ÅÅG H
;
ÅÅH I
if
ÇÇ 
(
ÇÇ 
user
ÇÇ 
.
ÇÇ 

Id_Usuario
ÇÇ #
<=
ÇÇ$ &
$num
ÇÇ' (
)
ÇÇ( )
return
ÇÇ* 0

StatusCode
ÇÇ1 ;
(
ÇÇ; <
$num
ÇÇ< ?
,
ÇÇ? @
new
ÇÇA D
{
ÇÇE F
ok
ÇÇG I
=
ÇÇJ K
false
ÇÇL Q
,
ÇÇQ R
msg
ÇÇS V
=
ÇÇW X
$strÇÇY ñ
}ÇÇó ò
)ÇÇò ô
;ÇÇô ö
var
ÑÑ 
val
ÑÑ 
=
ÑÑ 
mVEvento
ÑÑ "
.
ÑÑ" #
ValidarEventoId
ÑÑ# 2
(
ÑÑ2 3
Id
ÑÑ3 5
)
ÑÑ5 6
;
ÑÑ6 7
if
ÖÖ 
(
ÖÖ 
val
ÖÖ 
!=
ÖÖ 
null
ÖÖ 
)
ÖÖ  
return
ÖÖ! '

StatusCode
ÖÖ( 2
(
ÖÖ2 3
$num
ÖÖ3 6
,
ÖÖ6 7
val
ÖÖ8 ;
)
ÖÖ; <
;
ÖÖ< =
Evento
àà 

DbProducto
àà !
=
àà" #
await
àà$ )
mEvento
àà* 1
.
àà1 2
INR_Buscar_Evento
àà2 C
(
ààC D
Id
ààD F
)
ààF G
;
ààG H
if
ââ 
(
ââ 

DbProducto
ââ 
==
ââ !
null
ââ" &
)
ââ& '
return
ââ( .

StatusCode
ââ/ 9
(
ââ9 :
$num
ââ: =
,
ââ= >
new
ââ? B
{
ââC D
ok
ââE G
=
ââH I
false
ââJ O
,
ââO P
msg
ââQ T
=
ââU V
$str
ââW v
}
ââw x
)
ââx y
;
âây z
if
ää 
(
ää 

DbProducto
ää 
.
ää 
Id
ää !
<=
ää" $
$num
ää% &
)
ää& '
return
ää( .

StatusCode
ää/ 9
(
ää9 :
$num
ää: =
,
ää= >
new
ää? B
{
ääC D
ok
ääE G
=
ääH I
false
ääJ O
,
ääO P
msg
ääQ T
=
ääU V
$str
ääW v
}
ääw x
)
ääx y
;
ääy z
if
çç 
(
çç 

DbProducto
çç 
.
çç 
UserUid
çç &
!=
çç' )
user
çç* .
.
çç. /

Id_Usuario
çç/ 9
)
çç9 :
return
çç; A

StatusCode
ççB L
(
ççL M
$num
ççM P
,
ççP Q
new
ççR U
{
ççV W
ok
ççX Z
=
çç[ \
false
çç] b
,
ççb c
msg
ççd g
=
ççh i
$strççj ó
}ççò ô
)ççô ö
;ççö õ
if
éé 
(
éé 

DbProducto
éé 
.
éé 
IdCre
éé $
!=
éé% '
user
éé( ,
.
éé, -

Id_Usuario
éé- 7
)
éé7 8
return
éé9 ?

StatusCode
éé@ J
(
ééJ K
$num
ééK N
,
ééN O
new
ééP S
{
ééT U
ok
ééV X
=
ééY Z
false
éé[ `
,
éé` a
msg
ééc f
=
éég h
$strééi ñ
}ééó ò
)ééò ô
;ééô ö
var
ëë 
delR
ëë 
=
ëë 
await
ëë  
mEvento
ëë! (
.
ëë( ))
INR_Eliminar_Evento_Usuario
ëë) D
(
ëëD E
Id
ëëE G
)
ëëG H
;
ëëH I
if
íí 
(
íí 
delR
íí 
!=
íí 
null
íí  
)
íí  !
return
íí" (

StatusCode
íí) 3
(
íí3 4
$num
íí4 7
,
íí7 8
delR
íí9 =
)
íí= >
;
íí> ?
var
ïï 
del
ïï 
=
ïï 
await
ïï 
mEvento
ïï  '
.
ïï' (!
INR_Eliminar_Evento
ïï( ;
(
ïï; <
Id
ïï< >
,
ïï> ?
user
ïï@ D
.
ïïD E

Id_Usuario
ïïE O
)
ïïO P
;
ïïP Q
if
ññ 
(
ññ 
del
ññ 
!=
ññ 
null
ññ 
)
ññ  
return
ññ! '

StatusCode
ññ( 2
(
ññ2 3
$num
ññ3 6
,
ññ6 7
del
ññ8 ;
)
ññ; <
;
ññ< =
return
òò 

StatusCode
òò !
(
òò! "
$num
òò" %
,
òò% &
new
òò' *
{
òò+ ,
ok
òò- /
=
òò0 1
true
òò2 6
}
òò7 8
)
òò8 9
;
òò9 :
}
ôô 
catch
öö 
(
öö 
	Exception
öö 
)
öö 
{
õõ 
return
úú 

StatusCode
úú !
(
úú! "
$num
úú" %
,
úú% &
new
úú' *
{
úú+ ,
ok
úú- /
=
úú0 1
false
úú2 7
,
úú7 8
msg
úú9 <
=
úú= >
$str
úú? |
}
úú} ~
)
úú~ 
;úú Ä
}
ùù 
}
ûû 	
[
†† 	
HttpPut
††	 
(
†† 
$str
††  
)
††  !
]
††! "
public
°° 
async
°° 
Task
°° 
<
°° 
ActionResult
°° &
<
°°& '
Notificacion
°°' 3
>
°°3 4
>
°°4 5
DeleteRe
°°6 >
(
°°> ?
[
°°? @
FromBody
°°@ H
]
°°H I
Relacion
°°J R
Request
°°S Z
)
°°Z [
{
¢¢ 	
try
££ 
{
§§ 
if
¶¶ 
(
¶¶ 
HttpContext
¶¶ 
.
¶¶  
User
¶¶  $
.
¶¶$ %
Identity
¶¶% -
is
¶¶. 0
not
¶¶1 4
ClaimsIdentity
¶¶5 C
identity
¶¶D L
)
¶¶L M
return
¶¶N T

StatusCode
¶¶U _
(
¶¶_ `
$num
¶¶` c
,
¶¶c d
new
¶¶e h
{
¶¶i j
ok
¶¶k m
=
¶¶n o
false
¶¶p u
,
¶¶u v
msg
¶¶w z
=
¶¶{ |
$str¶¶} ∫
}¶¶ª º
)¶¶º Ω
;¶¶Ω æ
ClaimsIdent
ßß 
user
ßß  
=
ßß! "
mTokenCreate
ßß# /
.
ßß/ 0
GetUser
ßß0 7
(
ßß7 8
identity
ßß8 @
.
ßß@ A
Claims
ßßA G
)
ßßG H
;
ßßH I
if
®® 
(
®® 
user
®® 
.
®® 

Id_Usuario
®® #
<=
®®$ &
$num
®®' (
)
®®( )
return
®®* 0

StatusCode
®®1 ;
(
®®; <
$num
®®< ?
,
®®? @
new
®®A D
{
®®E F
ok
®®G I
=
®®J K
false
®®L Q
,
®®Q R
msg
®®S V
=
®®W X
$str®®Y ñ
}®®ó ò
)®®ò ô
;®®ô ö
Evento
´´ 

DbProducto
´´ !
=
´´" #
await
´´$ )
mEvento
´´* 1
.
´´1 2
INR_Buscar_Evento
´´2 C
(
´´C D
Request
´´D K
.
´´K L
Id_Nota
´´L S
)
´´S T
;
´´T U
if
¨¨ 
(
¨¨ 

DbProducto
¨¨ 
==
¨¨ !
null
¨¨" &
)
¨¨& '
return
¨¨( .

StatusCode
¨¨/ 9
(
¨¨9 :
$num
¨¨: =
,
¨¨= >
new
¨¨? B
{
¨¨C D
ok
¨¨E G
=
¨¨H I
false
¨¨J O
,
¨¨O P
Request
¨¨Q X
.
¨¨X Y
Id_Nota
¨¨Y `
,
¨¨` a
msg
¨¨b e
=
¨¨f g
$str¨¨h á
}¨¨à â
)¨¨â ä
;¨¨ä ã
if
≠≠ 
(
≠≠ 

DbProducto
≠≠ 
.
≠≠ 
Id
≠≠ !
<=
≠≠" $
$num
≠≠% &
)
≠≠& '
return
≠≠( .

StatusCode
≠≠/ 9
(
≠≠9 :
$num
≠≠: =
,
≠≠= >
new
≠≠? B
{
≠≠C D
ok
≠≠E G
=
≠≠H I
false
≠≠J O
,
≠≠O P
Request
≠≠Q X
.
≠≠X Y
Id_Nota
≠≠Y `
,
≠≠` a
msg
≠≠b e
=
≠≠f g
$str≠≠h á
}≠≠à â
)≠≠â ä
;≠≠ä ã
if
∞∞ 
(
∞∞ 

DbProducto
∞∞ 
.
∞∞ 
UserUid
∞∞ &
!=
∞∞' )
user
∞∞* .
.
∞∞. /

Id_Usuario
∞∞/ 9
)
∞∞9 :
return
∞∞; A

StatusCode
∞∞B L
(
∞∞L M
$num
∞∞M P
,
∞∞P Q
new
∞∞R U
{
∞∞V W
ok
∞∞X Z
=
∞∞[ \
false
∞∞] b
,
∞∞b c
Request
∞∞d k
.
∞∞k l
Id_User
∞∞l s
,
∞∞s t
msg
∞∞u x
=
∞∞y z
$str∞∞{ ¶
}∞∞ß ®
)∞∞® ©
;∞∞© ™
if
±± 
(
±± 

DbProducto
±± 
.
±± 
IdCre
±± $
!=
±±% '
user
±±( ,
.
±±, -

Id_Usuario
±±- 7
)
±±7 8
return
±±9 ?

StatusCode
±±@ J
(
±±J K
$num
±±K N
,
±±N O
new
±±P S
{
±±T U
ok
±±V X
=
±±Y Z
false
±±[ `
,
±±` a
Request
±±b i
.
±±i j
Id_User
±±j q
,
±±q r
msg
±±s v
=
±±w x
$str±±y §
}±±• ¶
)±±¶ ß
;±±ß ®
var
¥¥ 
delR
¥¥ 
=
¥¥ 
await
¥¥  
mEvento
¥¥! (
.
¥¥( )2
$INR_Eliminar_Evento_Usuario_Relacion
¥¥) M
(
¥¥M N

DbProducto
¥¥N X
.
¥¥X Y
Id
¥¥Y [
,
¥¥[ \
Request
¥¥] d
.
¥¥d e
Id_User
¥¥e l
)
¥¥l m
;
¥¥m n
if
µµ 
(
µµ 
delR
µµ 
!=
µµ 
null
µµ  
)
µµ  !
return
µµ" (

StatusCode
µµ) 3
(
µµ3 4
$num
µµ4 7
,
µµ7 8
delR
µµ9 =
)
µµ= >
;
µµ> ?
return
∑∑ 

StatusCode
∑∑ !
(
∑∑! "
$num
∑∑" %
,
∑∑% &
new
∑∑' *
{
∑∑+ ,
ok
∑∑- /
=
∑∑0 1
true
∑∑2 6
}
∑∑7 8
)
∑∑8 9
;
∑∑9 :
}
∏∏ 
catch
ππ 
(
ππ 
	Exception
ππ 
)
ππ 
{
∫∫ 
return
ªª 

StatusCode
ªª !
(
ªª! "
$num
ªª" %
,
ªª% &
new
ªª' *
{
ªª+ ,
ok
ªª- /
=
ªª0 1
false
ªª2 7
,
ªª7 8
msg
ªª9 <
=
ªª= >
$str
ªª? |
}
ªª} ~
)
ªª~ 
;ªª Ä
}
ºº 
}
ΩΩ 	
}
ææ 
}øø ›
ZE:\visual\ricardo\Backend-C#\CalendarBackend\CalendarBackend\Controllers\HomeController.cs
	namespace 	
CalendarBackend
 
. 
Controllers %
{ 
public 

class 
HomeController 
:  !

Controller" ,
{ 
private		 
readonly		 
ILogger		  
<		  !
HomeController		! /
>		/ 0
_logger		1 8
;		8 9
public 
HomeController 
( 
ILogger %
<% &
HomeController& 4
>4 5
logger6 <
)< =
{ 	
_logger 
= 
logger 
; 
} 	
public 
IActionResult 
Index "
(" #
)# $
{ 	
return 
View 
( 
) 
; 
} 	
} 
} ≠r
bE:\visual\ricardo\Backend-C#\CalendarBackend\CalendarBackend\Controllers\NotificationController.cs
	namespace 	
CalendarBackend
 
. 
Controllers %
{ 
public 

class "
NotificationController '
:( )

Controller* 4
{		 
private 
readonly 

INR_Evento #
mEvento$ +
;+ ,
readonly 
ITokenCreate 
mTokenCreate *
;* +
private 
readonly 
INR_Notificacion )
mNotificacion* 7
;7 8
private 
readonly 

ISendEmail #

mSendEmail$ .
;. /
public "
NotificationController %
(% &

INR_Evento& 0
mEvento1 8
,8 9
ITokenCreate: F
mTokenCreateG S
,S T
INR_NotificacionU e
mNotificacionf s
,s t

ISendEmailu 

mSendEmail
Ä ä
)
ä ã
{ 	
this 
. 
mEvento 
= 
mEvento "
;" #
this 
. 
mTokenCreate 
= 
mTokenCreate  ,
;, -
this 
. 
mNotificacion 
=  
mNotificacion! .
;. /
this 
. 

mSendEmail 
= 

mSendEmail (
;( )
} 	
[ 	
HttpGet	 
( 
$str  
)  !
]! "
public 
async 
Task 
< 
ActionResult &
<& '
Evento' -
>- .
>. /%
GetAllNotificationUsuario0 I
(I J
)J K
{ 	
try 
{ 
if 
( 
HttpContext 
.  
User  $
.$ %
Identity% -
is. 0
not1 4
ClaimsIdentity5 C
identityD L
)L M
returnN T

StatusCodeU _
(_ `
$num` c
,c d
newe h
{i j
okk m
=n o
falsep u
,u v
msgw z
={ |
$str	} ∫
}
ª º
)
º Ω
;
Ω æ
ClaimsIdent 
user  
=! "
mTokenCreate# /
./ 0
GetUser0 7
(7 8
identity8 @
.@ A
ClaimsA G
)G H
;H I
if 
( 
user 
. 

Id_Usuario #
<=$ &
$num' (
)( )

StatusCode* 4
(4 5
$num5 8
,8 9
new: =
{> ?
ok@ B
=C D
falseE J
,J K
msgL O
=P Q
$str	R è
}
ê ë
)
ë í
;
í ì
var!! 
list!! 
=!! 
await!!  
mNotificacion!!! .
.!!. /1
%INR_Mostar_Todos_Notificacion_Usuario!!/ T
(!!T U
user!!U Y
.!!Y Z

Id_Usuario!!Z d
)!!d e
;!!e f
return"" 

StatusCode"" !
(""! "
$num""" %
,""% &
new""' *
{""+ ,
ok""- /
=""0 1
true""2 6
,""6 7
notifications""8 E
=""F G
list""H L
}""M N
)""N O
;""O P
}$$ 
catch%% 
(%% 
	Exception%% 
)%% 
{&& 
return'' 

StatusCode'' !
(''! "
$num''" %
,''% &
new''' *
{''+ ,
ok''- /
=''0 1
false''2 7
,''7 8
msg''9 <
=''= >
$str''? |
}''} ~
)''~ 
;	'' Ä
}(( 
})) 	
[++ 	
HttpPost++	 
(++ 
$str++ (
)++( )
]++) *
public,, 
async,, 
Task,, 
<,, 
ActionResult,, &
<,,& '
Notificacion,,' 3
>,,3 4
>,,4 5
Create,,6 <
(,,< =
[,,= >
FromBody,,> F
],,F G
NotificacionDelete,,H Z
Request,,[ b
),,b c
{-- 	
try.. 
{// 
if11 
(11 
HttpContext11 
.11  
User11  $
.11$ %
Identity11% -
is11. 0
not111 4
ClaimsIdentity115 C
identity11D L
)11L M
return11N T

StatusCode11U _
(11_ `
$num11` c
,11c d
new11e h
{11i j
ok11k m
=11n o
false11p u
,11u v
msg11w z
=11{ |
$str	11} ∫
}
11ª º
)
11º Ω
;
11Ω æ
ClaimsIdent22 
user22  
=22! "
mTokenCreate22# /
.22/ 0
GetUser220 7
(227 8
identity228 @
.22@ A
Claims22A G
)22G H
;22H I
if33 
(33 
user33 
.33 

Id_Usuario33 #
<=33$ &
$num33' (
)33( )
return33* 0

StatusCode331 ;
(33; <
$num33< ?
,33? @
new33A D
{33E F
ok33G I
=33J K
false33L Q
,33Q R
msg33S V
=33W X
$str	33Y ñ
}
33ó ò
)
33ò ô
;
33ô ö
Evento66 

DbProducto66 !
=66" #
await66$ )
mEvento66* 1
.661 2
INR_Buscar_Evento662 C
(66C D
Request66D K
.66K L
Id_Nota66L S
)66S T
;66T U
if77 
(77 

DbProducto77 
==77 !
null77" &
)77& '
return77( .

StatusCode77/ 9
(779 :
$num77: =
,77= >
new77? B
{77C D
ok77E G
=77H I
false77J O
,77O P
Request77Q X
.77X Y
Id_Nota77Y `
,77` a
msg77b e
=77f g
$str	77h á
}
77à â
)
77â ä
;
77ä ã
if88 
(88 

DbProducto88 
.88 
Id88 !
<=88" $
$num88% &
)88& '
return88( .

StatusCode88/ 9
(889 :
$num88: =
,88= >
new88? B
{88C D
ok88E G
=88H I
false88J O
,88O P
Request88Q X
.88X Y
Id_Nota88Y `
,88` a
msg88b e
=88f g
$str	88h á
}
88à â
)
88â ä
;
88ä ã
int;; 
relac;; 
=;; 
await;; !
mEvento;;" )
.;;) *)
INR_Registrar_Evento_Relacion;;* G
(;;G H

DbProducto;;H R
.;;R S
Id;;S U
,;;U V
user;;W [
.;;[ \

Id_Usuario;;\ f
);;f g
;;;g h
if<< 
(<< 
relac<< 
<=<< 
$num<< 
)<< 
return<<  &

StatusCode<<' 1
(<<1 2
$num<<2 5
,<<5 6
new<<7 :
{<<; <
ok<<= ?
=<<@ A
false<<B G
,<<G H
msg<<I L
=<<M N
$str	<<O ç
}
<<é è
)
<<è ê
;
<<ê ë
await>> 
mNotificacion>> #
.>># $$
NR_Eliminar_Notificacion>>$ <
(>>< =
Request>>= D
.>>D E
Id_Not>>E K
,>>K L
user>>M Q
.>>Q R

Id_Usuario>>R \
)>>\ ]
;>>] ^
var@@ 

listGuests@@ 
=@@  
await@@! &
mEvento@@' .
.@@. /,
 INR_Mostar_Todos_Usuarios_Evento@@/ O
(@@O P

DbProducto@@P Z
.@@Z [
Id@@[ ]
)@@] ^
;@@^ _
returnBB 

StatusCodeBB !
(BB! "
$numBB" %
,BB% &
newBB' *
{BB+ ,
okBB- /
=BB0 1
trueBB2 6
,BB6 7
eventoBB8 >
=BB? @

DbProductoBBA K
,BBK L

listGuestsBBM W
}BBX Y
)BBY Z
;BBZ [
}CC 
catchDD 
(DD 
	ExceptionDD 
)DD 
{EE 
returnFF 

StatusCodeFF !
(FF! "
$numFF" %
,FF% &
newFF' *
{FF+ ,
okFF- /
=FF0 1
falseFF2 7
,FF7 8
msgFF9 <
=FF= >
$strFF? |
}FF} ~
)FF~ 
;	FF Ä
}GG 
}HH 	
[JJ 	
HttpPostJJ	 
(JJ 
$strJJ )
)JJ) *
]JJ* +
publicKK 
asyncKK 
TaskKK 
<KK 
ActionResultKK &
<KK& '
NotificacionKK' 3
>KK3 4
>KK4 5
DeleteKK6 <
(KK< =
[KK= >
FromBodyKK> F
]KKF G
NotificacionDeleteKKH Z
RequestKK[ b
)KKb c
{LL 	
tryMM 
{NN 
ifPP 
(PP 
HttpContextPP 
.PP  
UserPP  $
.PP$ %
IdentityPP% -
isPP. 0
notPP1 4
ClaimsIdentityPP5 C
identityPPD L
)PPL M
returnPPN T

StatusCodePPU _
(PP_ `
$numPP` c
,PPc d
newPPe h
{PPi j
okPPk m
=PPn o
falsePPp u
,PPu v
msgPPw z
=PP{ |
$str	PP} ∫
}
PPª º
)
PPº Ω
;
PPΩ æ
ClaimsIdentQQ 
userQQ  
=QQ! "
mTokenCreateQQ# /
.QQ/ 0
GetUserQQ0 7
(QQ7 8
identityQQ8 @
.QQ@ A
ClaimsQQA G
)QQG H
;QQH I
ifRR 
(RR 
userRR 
.RR 

Id_UsuarioRR #
<=RR$ &
$numRR' (
)RR( )
returnRR* 0

StatusCodeRR1 ;
(RR; <
$numRR< ?
,RR? @
newRRA D
{RRE F
okRRG I
=RRJ K
falseRRL Q
,RRQ R
msgRRS V
=RRW X
$str	RRY ñ
}
RRó ò
)
RRò ô
;
RRô ö
awaitUU 
mNotificacionUU #
.UU# $$
NR_Eliminar_NotificacionUU$ <
(UU< =
RequestUU= D
.UUD E
Id_NotUUE K
,UUK L
userUUM Q
.UUQ R

Id_UsuarioUUR \
)UU\ ]
;UU] ^
returnWW 

StatusCodeWW !
(WW! "
$numWW" %
,WW% &
newWW' *
{WW+ ,
okWW- /
=WW0 1
trueWW2 6
}WW7 8
)WW8 9
;WW9 :
}XX 
catchYY 
(YY 
	ExceptionYY 
)YY 
{ZZ 
return[[ 

StatusCode[[ !
([[! "
$num[[" %
,[[% &
new[[' *
{[[+ ,
ok[[- /
=[[0 1
false[[2 7
,[[7 8
msg[[9 <
=[[= >
$str[[? |
}[[} ~
)[[~ 
;	[[ Ä
}\\ 
}]] 	
[__ 	
HttpPost__	 
(__ 
$str__ !
)__! "
]__" #
public`` 
async`` 
Task`` 
<`` 
ActionResult`` &
<``& '
	ListGuest``' 0
>``0 1
>``1 2
CreateGuests``3 ?
(``? @
[``@ A
FromBody``A I
]``I J
	ListGuest``K T
Request``U \
)``\ ]
{aa 	
trybb 
{cc 
ifee 
(ee 
HttpContextee 
.ee  
Useree  $
.ee$ %
Identityee% -
isee. 0
notee1 4
ClaimsIdentityee5 C
identityeeD L
)eeL M
returneeN T

StatusCodeeeU _
(ee_ `
$numee` c
,eec d
neweee h
{eei j
okeek m
=een o
falseeep u
,eeu v
msgeew z
=ee{ |
$str	ee} ∫
}
eeª º
)
eeº Ω
;
eeΩ æ
ClaimsIdentff 
userff  
=ff! "
mTokenCreateff# /
.ff/ 0
GetUserff0 7
(ff7 8
identityff8 @
.ff@ A
ClaimsffA G
)ffG H
;ffH I
ifgg 
(gg 
usergg 
.gg 

Id_Usuariogg #
<=gg$ &
$numgg' (
)gg( )
returngg* 0

StatusCodegg1 ;
(gg; <
$numgg< ?
,gg? @
newggA D
{ggE F
okggG I
=ggJ K
falseggL Q
,ggQ R
msgggS V
=ggW X
$str	ggY ñ
}
ggó ò
)
ggò ô
;
ggô ö
ifii 
(ii 
Requestii 
.ii 
	ListGutesii $
.ii$ %
Countii% *
>ii+ ,
$numii- .
)ii. /
{jj 
awaitkk 
mNotificacionkk '
.kk' (%
NR_Registrar_Notificacionkk( A
(kkA B
RequestkkB I
.kkI J

LastinsertkkJ T
,kkT U
RequestkkV ]
.kk] ^
	ListGuteskk^ g
,kkg h
userkki m
.kkm n

Id_Usuariokkn x
)kkx y
;kky z
foreachmm 
(mm 
varmm 
itemmm  $
inmm% '
Requestmm( /
.mm/ 0
	ListGutesmm0 9
)mm9 :
{nn 

mSendEmailoo "
.oo" #
sendEmailUsersoo# 1
(oo1 2
itemoo2 6
.oo6 7
Emailoo7 <
)oo< =
;oo= >
}pp 
}qq 
returnss 

StatusCodess !
(ss! "
$numss" %
,ss% &
newss' *
{ss+ ,
okss- /
=ss0 1
truess2 6
}ss7 8
)ss8 9
;ss9 :
}tt 
catchuu 
(uu 
	Exceptionuu 
)uu 
{vv 
returnww 

StatusCodeww !
(ww! "
$numww" %
,ww% &
newww' *
{ww+ ,
okww- /
=ww0 1
falseww2 7
,ww7 8
msgww9 <
=ww= >
$strww? |
}ww} ~
)ww~ 
;	ww Ä
}xx 
}yy 	
}zz 
}{{ Ü
UE:\visual\ricardo\Backend-C#\CalendarBackend\CalendarBackend\interfaces\ISendEmail.cs
	namespace 	
CalendarBackend
 
{ 
public 

	interface 

ISendEmail 
{ 
bool 
sendEmailUsers 
( 
string "
email# (
)( )
;) *
} 
} µ
UE:\visual\ricardo\Backend-C#\CalendarBackend\CalendarBackend\Models\ErrorViewModel.cs
	namespace 	
CalendarBackend
 
. 
Models  
{ 
public 

class 
ErrorViewModel 
{ 
public 
string 
? 
	RequestId  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
bool 
ShowRequestId !
=>" $
!% &
string& ,
., -
IsNullOrEmpty- :
(: ;
	RequestId; D
)D E
;E F
} 
}		 òA
GE:\visual\ricardo\Backend-C#\CalendarBackend\CalendarBackend\Program.cs
var

 
builder

 
=

 
WebApplication

 
.

 
CreateBuilder

 *
(

* +
args

+ /
)

/ 0
;

0 1
var "
MyAllowSpecificOrigins 
= 
$str 6
;6 7
builder 
. 
Configuration 
. 
AddJsonFile !
(! "
$str" 4
)4 5
;5 6
var 
code 
=	 

builder 
. 
Configuration  
.  !

GetSection! +
(+ ,
$str, =
)= >
.> ?
Get? B
<B C
DevC F
>F G
(G H
)H I
;I J
var 
keyBytes 
= 
Encoding 
. 
UTF8 
. 
GetBytes %
(% &
code& *
.* +
Token+ 0
)0 1
;1 2
builder 
. 
Services 
. #
AddControllersWithViews (
(( )
)) *
;* +
builder 
. 
Services 
. 
AddCors 
( 
options  
=>! #
{ 
options 
. 
	AddPolicy 
( "
MyAllowSpecificOrigins ,
,, -
policy 
=> 
{ 	
policy 
. 
WithOrigins 
( 
$str I
)I J
. 
WithOrigins 
( 
$str B
)B C
. 
WithOrigins 
( 
$str 1
)1 2
. 
WithOrigins 
( 
$str 0
)0 1
. 
AllowAnyHeader 
( 
) 
. 
AllowAnyMethod 
( 
) 
; 
} 	
)	 

;
 
} 
) 
; 
builder!! 
.!! 
Services!! 
.!! 
AddAuthentication!! "
(!!" #
config!!# )
=>!!* ,
{"" 
config## 

.##
 %
DefaultAuthenticateScheme## $
=##% &
JwtBearerDefaults##' 8
.##8 9 
AuthenticationScheme##9 M
;##M N
config$$ 

.$$
 "
DefaultChallengeScheme$$ !
=$$" #
JwtBearerDefaults$$$ 5
.$$5 6 
AuthenticationScheme$$6 J
;$$J K
}&& 
)&& 
.&& 
AddJwtBearer&& 
(&& 
config&& 
=>&& 
{'' 
config(( 

.((
  
RequireHttpsMetadata(( 
=((  !
false((" '
;((' (
config)) 

.))
 
	SaveToken)) 
=)) 
true)) 
;)) 
config** 

.**
 %
TokenValidationParameters** $
=**% &
new**' *%
TokenValidationParameters**+ D
{++ $
ValidateIssuerSigningKey,,  
=,,! "
true,,# '
,,,' (
IssuerSigningKey-- 
=-- 
new--  
SymmetricSecurityKey-- 3
(--3 4
keyBytes--4 <
)--< =
,--= >
ValidateIssuer.. 
=.. 
false.. 
,.. 
ValidateAudience// 
=// 
false//  
}00 
;00 
}11 
)11 
;11 
builder33 
.33 
Services33 
.33 
AddControllers33 
(33  
)33  !
;33! "
builder44 
.44 
Services44 
.44 
	AddScoped44 
<44 
IBD_Usuario44 &
,44& '
SBD_Usuario44( 3
>443 4
(444 5
)445 6
;446 7
builder55 
.55 
Services55 
.55 
	AddScoped55 
<55 

IDB_Evento55 %
,55% &

SDB_Evento55' 1
>551 2
(552 3
)553 4
;554 5
builder66 
.66 
Services66 
.66 
	AddScoped66 
<66 
ICreateHash66 &
,66& '
SCreateHash66( 3
>663 4
(664 5
)665 6
;666 7
builder77 
.77 
Services77 
.77 
	AddScoped77 
<77 
INR_Usuario77 &
,77& '
SNR_Usuario77( 3
>773 4
(774 5
)775 6
;776 7
builder88 
.88 
Services88 
.88 
	AddScoped88 
<88 
ITokenCreate88 '
,88' (
STokenCreate88) 5
>885 6
(886 7
)887 8
;888 9
builder99 
.99 
Services99 
.99 
	AddScoped99 
<99 
IValidarCampos99 )
,99) *
SValidarCampos99+ 9
>999 :
(99: ;
)99; <
;99< =
builder:: 
.:: 
Services:: 
.:: 
	AddScoped:: 
<:: 
IValidarUsuario:: *
,::* +
SValidarUsuario::, ;
>::; <
(::< =
)::= >
;::> ?
builder;; 
.;; 
Services;; 
.;; 
	AddScoped;; 
<;; 
IValidarEvento;; )
,;;) *
SValidarEvento;;+ 9
>;;9 :
(;;: ;
);;; <
;;;< =
builder<< 
.<< 
Services<< 
.<< 
	AddScoped<< 
<<< 

INR_Evento<< %
,<<% &

SNR_Evento<<' 1
><<1 2
(<<2 3
)<<3 4
;<<4 5
builder== 
.== 
Services== 
.== 
	AddScoped== 
<== 
IDB_Notificacion== +
,==+ ,
SDB_Notificacion==- =
>=== >
(==> ?
)==? @
;==@ A
builder>> 
.>> 
Services>> 
.>> 
	AddScoped>> 
<>> 
INR_Notificacion>> +
,>>+ ,
SNR_Notificacion>>- =
>>>= >
(>>> ?
)>>? @
;>>@ A
builder?? 
.?? 
Services?? 
.?? 
	AddScoped?? 
<?? 

ISendEmail?? %
,??% &

SSendEmail??' 1
>??1 2
(??2 3
)??3 4
;??4 5
var@@ 
app@@ 
=@@ 	
builder@@
 
.@@ 
Build@@ 
(@@ 
)@@ 
;@@ 
ifCC 
(CC 
!CC 
appCC 
.CC 	
EnvironmentCC	 
.CC 
IsDevelopmentCC "
(CC" #
)CC# $
)CC$ %
{DD 
appEE 
.EE 
UseExceptionHandlerEE 
(EE 
$strEE )
)EE) *
;EE* +
appGG 
.GG 
UseHstsGG 
(GG 
)GG 
;GG 
}HH 
appJJ 
.JJ 
UseHttpsRedirectionJJ 
(JJ 
)JJ 
;JJ 
appLL 
.LL 
UseCorsLL 
(LL "
MyAllowSpecificOriginsLL "
)LL" #
;LL# $
appNN 
.NN 
UseStaticFilesNN 
(NN 
)NN 
;NN 
appPP 
.PP 

UseRoutingPP 
(PP 
)PP 
;PP 
appRR 
.RR 
UseCorsRR 
(RR 
)RR 
;RR 
appTT 
.TT 
UseAuthenticationTT 
(TT 
)TT 
;TT 
appVV 
.VV 
UseAuthorizationVV 
(VV 
)VV 
;VV 
appXX 
.XX 
MapControllerRouteXX 
(XX 
nameYY 
:YY 	
$strYY
 
,YY 
patternZZ 
:ZZ 
$strZZ 5
)ZZ5 6
;ZZ6 7
app\\ 
.\\ 
Run\\ 
(\\ 
)\\ 	
;\\	 
Ê
SE:\visual\ricardo\Backend-C#\CalendarBackend\CalendarBackend\services\SSendEmail.cs
	namespace 	
CalendarBackend
 
{ 
public 

class 

SSendEmail 
: 

ISendEmail (
{ 
public 
bool 
sendEmailUsers "
(" #
string# )
email* /
)/ 0
{		 	
try

 
{ 
string 
fromMail 
=  !
$str" >
;> ?
string 
fromPassword #
=$ %
$str& 8
;8 9
MailMessage 
message #
=$ %
new& )
() *
)* +
{ 
From 
= 
new 
MailAddress *
(* +
fromMail+ 3
)3 4
,4 5
Subject 
= 
$str ,
} 
; 
message 
. 
To 
. 
Add 
( 
new "
MailAddress# .
(. /
email/ 4
)4 5
)5 6
;6 7
message 
. 
Body 
= 
$" !
$str! '
"' (
+) *
$" 
$str 
" 
+  
$" 
$str !
{! "
email" '
}' (
$str( w
"w x
+y z
$" 
$str p
"p q
+r s
$" 
$str 
" 
; 
message 
. 

IsBodyHtml "
=# $
true% )
;) *
var 

smtpClient 
=  
new! $

SmtpClient% /
(/ 0
$str0 @
)@ A
{ 
Port   
=   
$num   
,   
Credentials!! 
=!!  !
new!!" %
NetworkCredential!!& 7
(!!7 8
fromMail!!8 @
,!!@ A
fromPassword!!B N
)!!N O
,!!O P
	EnableSsl"" 
="" 
true""  $
}## 
;## 

smtpClient%% 
.%% 
Send%% 
(%%  
message%%  '
)%%' (
;%%( )
return'' 
true'' 
;'' 
}(( 
catch)) 
()) 
	Exception)) 
))) 
{** 
return++ 
false++ 
;++ 
},, 
}-- 	
}.. 
}// 